!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=211)}([function(e,t,i){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,i){"use strict";t.__esModule=!0;var n,r=(n=i(85))&&n.__esModule?n:{default:n};t.default=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,r.default)(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}()},function(e,t,i){e.exports={default:i(105),__esModule:!0}},function(e,t,i){"use strict";t.__esModule=!0;var n,r=(n=i(35))&&n.__esModule?n:{default:n};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,r.default)(t))&&"function"!=typeof t?e:t}},function(e,t,i){"use strict";t.__esModule=!0;var n=o(i(126)),r=o(i(49)),a=o(i(35));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,a.default)(t)));e.prototype=(0,r.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}},function(e,t){var i=e.exports={version:"2.6.9"};"number"==typeof __e&&(__e=i)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.commonFun=t.H5Common=void 0;var n=i(31);t.H5Common={version:"1.0.21",defaultCfg:{videoType:"vod",ctx:"",poster:"",skin:{controlBar:!0},adConfig:{pos:1}},$:null,isMobile:1,playPath:location.origin+"/playurl/v1/play/playurlh5",recoPath:"/recommend/search/v1/recommend-related-long/",playData:null,callCode:{play:["2000","2001"],video:["3000","3001","3002","3003","3004"]},ow:750,oh:1024,container:null,mobileRegExp:/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|WebOS|Windows Phone)/i,pay:1,clientID:"79acd784-cbbb-4cae-8778-8723e001164b",userData:null,memberData:null,timestamp:0,useTicket:!1,heartDuration:15e3,skinCfg:null,pcClientUrl:"",startBtnVipTip:null,startBtnTip:null,startTip:"",hasClient:!1,playUrl:""},t.commonFun={isPlayAdv:function(){return!!n.advertInfo.urls}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(i(35)),r=u(i(90)),a=u(i(0)),o=u(i(1)),s=u(i(33)),l=i(6);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(){(0,a.default)(this,e)}return(0,o.default)(e,null,[{key:"debug",value:function(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=[].slice.call(i),a=e.trace(r);e.m_log+=a+"***鏃ュ織鍒嗗壊***\r\n","debug"==s.default.getQueryString("player")&&(l.H5Common.isMobile,console.log(a))}},{key:"error",value:function(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=[].slice.call(i),a=e.trace(r);e.m_log+=a+"***鏃ュ織鍒嗗壊***\r\n",console.error(i)}},{key:"trace",value:function(t){var i="",a=null,o=!0,l=!1,u=void 0;try{for(var d,f=(0,r.default)(t);!(o=(d=f.next()).done);o=!0){var c=d.value;"object"==(void 0===c?"undefined":(0,n.default)(c))?a=c:i+=c}}catch(e){l=!0,u=e}finally{try{!o&&f.return&&f.return()}finally{if(l)throw u}}return i=s.default.getLocalTime((new Date).valueOf())+"  ===>>>  "+i,a&&(i+=e.mix(a)),i}},{key:"mix",value:function(t){var i,r="";for(var a in t)try{"object"==(0,n.default)(t[a])?r+='"'+a+'":'+(i=(null!=t[a].length?"[,]":"{,}").split(","))[0]+e.mix(t[a])+i[1]+",\r":r+='"'+a+'":'+t[a]+","}catch(e){continue}return r}}]),e}();d.m_log="",t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(63),r=i(86),a=i(87),o=i(139),s=i(140),l=i(88),u=i(141),d=i(64),f=i(89),c=i(42),h=i(142),p={View:n.View,Model:r.Model,Controller:a.Controller,SimpleCommand:o.SimpleCommand,MacroCommand:s.MacroCommand,Facade:l.Facade,Mediator:u.Mediator,Observer:d.Observer,Notification:f.Notification,Notifier:c.Notifier,Proxy:h.Proxy};t.default=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.enableLogs=void 0;var n,r=(n=i(35))&&n.__esModule?n:{default:n},a=i(99);function o(){}var s={trace:o,debug:o,log:o,warn:o,info:o,error:o},l=s,u=(0,a.getSelfScope)();t.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":(0,r.default)(e))){!function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];i.forEach(function(t){l[t]=e[t]?e[t].bind(e):function(e){var t=u.console[e];return t?function(){for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];n[0]&&(n[0]=function(e,t){return"["+e+"] > "+t}(e,n[0])),t.apply(u.console,n)}:o}(t)})}(e,"debug","log","info","warn","error");try{l.log()}catch(e){l=s}}else l=s},t.logger=l},function(e,t){var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(e,t,i){var n=i(52)("wks"),r=i(44),a=i(10).Symbol,o="function"==typeof a;(e.exports=function(e){return n[e]||(n[e]=o&&a[e]||(o?a:r)("Symbol."+e))}).store=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.playStatus={PLAYING:"playing",PAUSE:"pause",STOP:"stop",END:"end",SEEK:"seek"},r=t.playType={VOD:"vod",LIVE:"live",HUIKAN:"huikan"};t.rateTypeList={1:{txt1:"鏍囨竻",txt2:"270p"},2:{txt1:"楂樻竻",txt2:"480p"},3:{txt1:"瓒呮竻",txt2:"720p"},4:{txt1:"钃濆厜",txt2:"1080p"}},t.playerInfo={cid:"",posi:0,duration:2597,start:!1,end:!1,isFullScreen:!1,status:n.PAUSE,volume:50,url:"",rateType:"0",timestamp:0,playType:r.VOD,realDuration:0,rateTypeList:"2,1,3,4",poster:"",next:!1,errorObj:{cid:"",errorID:-1},shikantime:360,shikan:!1,sTime:0,eTime:0,playName:"",buffered:0,loop:!1,playbackRate:1,shieldStatus:0,autoplay:!0,switchVideo:!1,programType:"OTHER",urlType:"normal",el:".m-player"}},function(e,t,i){var n=i(10),r=i(5),a=i(38),o=i(26),s=i(25),l=function(e,t,i){var u,d,f,c=e&l.F,h=e&l.G,p=e&l.S,v=e&l.P,y=e&l.B,g=e&l.W,m=h?r:r[t]||(r[t]={}),E=m.prototype,_=h?n:p?n[t]:(n[t]||{}).prototype;for(u in h&&(i=t),i)(d=!c&&_&&void 0!==_[u])&&s(m,u)||(f=d?_[u]:i[u],m[u]=h&&"function"!=typeof _[u]?i[u]:y&&d?a(f,n):g&&_[u]==f?function(e){var t=function(t,i,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,i)}return new e(t,i,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(f):v&&"function"==typeof f?a(Function.call,f):f,v&&((m.virtual||(m.virtual={}))[u]=f,e&l.R&&E&&!E[u]&&o(E,u,f)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},function(e,t,i){var n=i(24);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.H5Notification={START_UP:"start_up",WEB_PLAY:"web_play",PLAY_SUCCESS:"play_success",ADV_EVENT:"adv_event",ADS_STATUS:"ads_status",SKIN_START_PLAY:"start_play",VIDEO_SHOW_START_PLAY_BTN:"start_playbtn",EXTERNAL_NOTICATION:"external_notification",SKIN_CHANGE_PLAY_STATUS:"change_play_status",VIDEO_STATE:"video_state",SKIN_SEEK:"skin_seek",VIDEO_UPDATE:"video_update",VIDEO_WAITING:"video_waiting",SKIN_FULLSCREEN:"skin_fullscreen",PLAY_FAILED:"play_failed",VIDEO_NEXT:"video_next",PLAY_ERROR:"play_error",VIDEO_ERROR:"video_error",VIDEO_HIDE_UI:"video_hide_ui",SKIN_CHANGE_RATETYPE:"skin_change_ratetype",SKIN_CHANGE_SPEED:"skin_change_speed",SKIN_CHANGE_VOLUME:"skin_change_volume",VIDEO_SHOW_SPEED_UI:"video_show_spped_ui",VIDEO_SET_MUTE:"video_set_mute",RECO_SUCCESS:"reco_success",VIDEO_SHOW_RECO:"vide_show_reco",SKIN_REPLAY:"skin_replay",SKIN_MUTED:"skin_muted"},t.ExternalApiType={VIDEO_PLAY:"video_play",VIDEO_PAUSE:"video_pause",VIDEO_STOP:"video_stop",VIDEO_SEEK:"video_seek",VIDEO_SWITCH:"video_switch",VIDEO_VOLUME:"video_volume",VIDEO_USERINFO:"user_info",VIDEO_FULLSCREEN:"video_fullscreen",VIDEO_ERROR:"video_error",VIDEO_SHIELD_STATUS:"video_shieldStatus",VIDEO_AUTO_PLAY:"video_autoplay",VIDEO_PAGE_ZOOM:"video_page_zoom",VIDEO_MINI_PLAYER:"video_mini_player",SKIN_SHOW_ERROR_UI:"skin_show_error_ui",ADVERT_STATUS:"adv_status",ADV_DATA_SUCCESS:"adv_data_success",ADV_NEXT:"adv_next",ADV_END:"adv_end",ADV_ERROR:"adv_error"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(i(68)),r=s(i(0)),a=s(i(1)),o=i(6);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){(0,r.default)(this,e)}return(0,a.default)(e,null,[{key:"postMessage",value:function(e,t){window.parent.postMessage((0,n.default)({type:e,data:t,contonairId:o.H5Common.container}),"*")}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.playerStatusType=t.ExternalEvent=void 0;var n,r,a=(n=i(101))&&n.__esModule?n:{default:n};t.ExternalEvent=(r={VIDEO_STATUS:"video_status",VIDEO_FULLSCREEN:"video_screen",VIDEO_BIP:"video_bip",VIDEO_ERROR:"video_error",VIDEO_NEXT:"video_next",VIDEO_PAGE_ZOOM:"video_page_zoom",VIDEO_LOOP:"video_loop"},(0,a.default)(r,"VIDEO_LOOP","video_loop"),(0,a.default)(r,"VIDEO_OPEN_VIP","video_open_vip"),(0,a.default)(r,"VIDEO_WATCH_WHOLE","video_watch_whole"),(0,a.default)(r,"VIDEO_BUY_VIP","video_buy_vip"),(0,a.default)(r,"VIDEO_LOGIN","video_login"),(0,a.default)(r,"VIDEO_PLAYURL_CODE","video_playurl_code"),r),t.playerStatusType={READY:"ready",VIDEO_READY:"video_ready",VIDEO_PLAYING:"playing",VIDEO_PAUSE:"paused",VIDEO_STOP:"stop",VIDEO_SEEK:"seek",VIDEO_END:"end",VIDEO_SHIKAN_END:"shikan_end"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.H5ComponentEvent={WEB_PLAY:"web_play",ADS_STATUS:"ads_status",ADS_EVENT:"ads_event",CHANGE_PLAY_STATUS:"change_play_status",START_PLAY:"start_play",VIDEO_STATE:"video_state",SEEK:"seek",VIDEO_WAITING:"video_waiting",FULLSCREEN:"screen",PLAY_ERROR:"play_error",VIDEO_ERROR:"video_error",HIDE_UI:"hide_ui",VIDEO_BIP:"video_bip",PAGE_ZOOM:"page_zoom",BARRAGE:"barrage",NEXT:"next",LOOP:"loop",CHANGE_RATETYPE:"change_ratetype",CHANGE_SPEED:"change_speed",CHANGE_VOLUME:"change_volume",SHOW_SPEED_UI:"show_speed_ui",OPEN_VIP:"open_vip",SET_MUTE:"set_mute",VIDEO_SHOW_RECO:"show_reo",REPLAY:"replay",MUTED:"muted",HLS_READY:"hls_ready",VIDEO_READY:"video_ready",VIDEO_UPDATE:"video_update"}},function(e,t,i){e.exports=!i(30)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},t.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(e,t,i){e.exports={default:i(214),__esModule:!0}},function(e,t,i){var n=i(15),r=i(75),a=i(54),o=Object.defineProperty;t.f=i(20)?Object.defineProperty:function(e,t,i){if(n(e),t=a(t,!0),n(i),r)try{return o(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var i={}.hasOwnProperty;e.exports=function(e,t){return i.call(e,t)}},function(e,t,i){var n=i(23),r=i(46);e.exports=i(20)?function(e,t,i){return n.f(e,t,r(1,i))}:function(e,t,i){return e[t]=i,e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userInfo={name:"",isVip:!1,token:"",userId:"",clientId:""}},function(e,t,i){var n=i(79),r=i(50);e.exports=function(e){return n(r(e))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(i(35)),r=u(i(0)),a=u(i(1)),o=i(9),s=i(21),l=u(i(11));function u(e){return e&&e.__esModule?e:{default:e}}var d={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},f=function(){function e(t){(0,r.default)(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var i=arguments.length,n=Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}return(0,a.default)(e,[{key:"destroy",value:function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()}},{key:"onHandlerDestroying",value:function(){}},{key:"onHandlerDestroyed",value:function(){}},{key:"isEventHandler",value:function(){return"object"===(0,n.default)(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(d[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){try{(function(e,t){var i="on"+e.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,t)}).call(this,e,t).call()}catch(t){o.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();t.default=f},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.advertInfo={status:"none",data:null,urls:null},t.advertStatus={NONE:"none",REQUEST_DATA:"advert_request_data",READY:"advert_ready",START:"advert_start",END:"advert_end",ERROR:"advert_error",TIME_OUT:"time_out",OVER:"advert_over"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$=window.$||window.jQuery||window.Zepto,t.set$=function(){t.$=window.$||window.jQuery||window.Zepto}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(i(68)),r=l(i(43)),a=l(i(49)),o=l(i(0)),s=l(i(1));function l(e){return e&&e.__esModule?e:{default:e}}i(6);var u=function(){function e(){(0,o.default)(this,e)}return(0,s.default)(e,null,[{key:"isMobile",value:function(){return 1}},{key:"getLocalTime",value:function(e){return new Date(parseInt(e)).toLocaleString().replace(/骞磡鏈�/g,"-").replace(/鏃�/g," ")}},{key:"getQueryString",value:function(e){var t=void 0,i=new RegExp("(^|\\?|&|#)"+e+"=([^&#]*)(&|#|$)","i");try{t=top.location.href.match(i)}catch(e){t=window.location.href.match(i)}return null!=t?decodeURIComponent(t[2]):null}},{key:"throttle",value:function(e,t,i){var n=void 0,r=void 0;return i||(i=this),t||(t=500),function(){var a=arguments,o=+new Date;n&&o<n+t?(clearTimeout(r),r=setTimeout(function(){n=o,e.apply(i,a)},t)):(n=o,e.apply(i,a))}}},{key:"formatDate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY骞碝M鏈圖D鏃� hh:mm:ss";try{e||(e=(new Date).getT);var i=function(e,t){return(e/Math.pow(10,t)).toFixed(t).substr(2)},n=Math.floor(e.getTime()/1e3),r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","鏃�","涓€","浜�","涓�","鍥�","浜�","鍏�"];return"mm:ss"==t||"mm鏃秙s鍒�"==t?t.replace(/mm|ss/g,function(e){switch(e){case"mm":return(t=Math.floor(n/60)+"").length<2?"0"+t:t;case"ss":return i(n%60,2);default:return"00"}var t}):t.replace(/YYYY|YY|MM|DD|hh|mm|ss|鏄熸湡|鍛▅www|week/g,function(t){switch(t){case"YYYY":return e.getFullYear().toString();case"YY":return(e.getFullYear()+"").slice(2);case"MM":return i(e.getMonth()+1,2);case"DD":return i(e.getDate(),2);case"hh":return i(e.getHours(),2);case"mm":return i(e.getMinutes(),2);case"ss":return i(e.getSeconds(),2);case"鏄熸湡":return"鏄熸湡"+r[e.getDay()+7];case"鍛�":return"鍛�"+r[e.getDay()+7];case"week":return r[e.getDay()];case"www":return r[e.getDay()].slice(0,3);default:return"00"}})}catch(e){return"00"}}},{key:"execEvent",value:function(e,t){var i=void 0;if("mouseover"==t.type?i=t.fromElement||t.relatedTarget:"mouseout"==t.type&&(i=t.toElement||t.relatedTarget),!i||!e)return!1;if(document.all){if(!e.contains(i))return!0}else{var n=e.compareDocumentPosition(i);if(0!=n&&20!=n)return!0}return!1}},{key:"isMyChildren",value:function(e,t){if(document.all){if(e.contains(t))return!0}else{var i=e.compareDocumentPosition(t);if(0==i||20==i)return!0}return!1}},{key:"remeberPosi",value:function(e,t){var i=window.localStorage;if(!i)return 0;var o=i.getItem("playerPosi"),s=(0,a.default)(null);if(o)try{s=JSON.parse(o)}catch(e){}if(void 0===t)return s&&s[e]?s[e]:0;if(t>0){if(s){if((0,r.default)(s).length>30){var l=(new Date).getTime(),u=-1;for(var d in s)l<=s[d].time&&(l=s[d].time,u=d);s[u]=null,delete s[u]}s[e]={posi:t,time:(new Date).getTime()}}else(s={})[e]={posi:t,time:(new Date).getTime()};i.setItem("playerPosi",(0,n.default)(s))}else s&&s[e]&&(s[e]=null,delete s[e],i.setItem("playerPosi",(0,n.default)(s)));return t}},{key:"remeberItem",value:function(e,t){var i=window.localStorage;if(!i)return null;var n=i.getItem(e);return void 0===t?n||null:(i.setItem(e,t),t)}},{key:"remeberRT",value:function(e){return d("playerRT",e)}},{key:"remeberSpeed",value:function(e){return d("playerSpeed",e)}}]),e}();function d(e,t){var i=window.localStorage;if(!i)return null;var n=i.getItem(e);return void 0===t?n||null:(i.setItem(e,t),t)}t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(i(2)),r=l(i(0)),a=l(i(1)),o=l(i(3)),s=l(i(4));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){(0,r.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return i.target=e,i}return(0,s.default)(t,e),(0,a.default)(t,[{key:"dispatchEvent",value:function(e){this.trigger(e,arguments.length<=1?void 0:arguments[1])}},{key:"addEventListener",value:function(e,t,i){this.on(e,t,i)}},{key:"removeEventListener",value:function(e,t,i){this.off(e,t,i)}}]),t}(i(171).Events);t.default=u},function(e,t,i){"use strict";t.__esModule=!0;var n=o(i(107)),r=o(i(117)),a="function"==typeof r.default&&"symbol"==typeof n.default?function(e){return typeof e}:function(e){return e&&"function"==typeof r.default&&e.constructor===r.default&&e!==r.default.prototype?"symbol":typeof e};function o(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof r.default&&"symbol"===a(n.default)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof r.default&&e.constructor===r.default&&e!==r.default.prototype?"symbol":void 0===e?"undefined":a(e)}},function(e,t,i){var n=i(50);e.exports=function(e){return Object(n(e))}},function(e,t){e.exports=!0},function(e,t,i){var n=i(45);e.exports=function(e,t,i){if(n(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,n){return e.call(t,i,n)};case 3:return function(i,n,r){return e.call(t,i,n,r)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports={}},function(e,t,i){var n=i(78),r=i(58);e.exports=Object.keys||function(e){return n(e,r)}},function(e,t){var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Notifier=void 0;var n=o(i(0)),r=o(i(1)),a=i(88);function o(e){return e&&e.__esModule?e:{default:e}}(t.Notifier=function(){function e(){(0,n.default)(this,e),this.multitonKey=null}return(0,r.default)(e,[{key:"sendNotification",value:function(e,t,i){this.facade&&this.facade.sendNotification(e,t,i)}},{key:"initializeNotifier",value:function(e){this.multitonKey=String(e)}},{key:"facade",get:function(){if(null==this.multitonKey)throw new Error(e.MULTITON_MSG);return a.Facade.getInstance(this.multitonKey)}}]),e}()).MULTITON_MSG="multitonKey for this Notifier not yet initialized!"},function(e,t,i){e.exports={default:i(149),__esModule:!0}},function(e,t){var i=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+n).toString(36))}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,i){var n=i(23).f,r=i(25),a=i(12)("toStringTag");e.exports=function(e,t,i){e&&!r(e=i?e:e.prototype,a)&&n(e,a,{configurable:!0,value:t})}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,i){e.exports={default:i(130),__esModule:!0}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,i){var n=i(52)("keys"),r=i(44);e.exports=function(e){return n[e]||(n[e]=r(e))}},function(e,t,i){var n=i(5),r=i(10),a=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:i(37)?"pure":"global",copyright:"漏 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t,i){var n=i(24),r=i(10).document,a=n(r)&&n(r.createElement);e.exports=function(e){return a?r.createElement(e):{}}},function(e,t,i){var n=i(24);e.exports=function(e,t){if(!n(e))return e;var i,r;if(t&&"function"==typeof(i=e.toString)&&!n(r=i.call(e)))return r;if("function"==typeof(i=e.valueOf)&&!n(r=i.call(e)))return r;if(!t&&"function"==typeof(i=e.toString)&&!n(r=i.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t,i){"use strict";var n=i(109)(!0);i(76)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=n(t,i),this._i+=e.length,{value:e,done:!1})})},function(e,t){var i=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:i)(e)}},function(e,t,i){var n=i(15),r=i(111),a=i(58),o=i(51)("IE_PROTO"),s=function(){},l=function(){var e,t=i(53)("iframe"),n=a.length;for(t.style.display="none",i(81).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;n--;)delete l.prototype[a[n]];return l()};e.exports=Object.create||function(e,t){var i;return null!==e?(s.prototype=n(e),i=new s,s.prototype=null,i[o]=e):i=l(),void 0===t?i:r(i,t)}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,i){i(114);for(var n=i(10),r=i(26),a=i(39),o=i(12)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),l=0;l<s.length;l++){var u=s[l],d=n[u],f=d&&d.prototype;f&&!f[o]&&r(f,o,u),a[u]=a.Array}},function(e,t,i){t.f=i(12)},function(e,t,i){var n=i(10),r=i(5),a=i(37),o=i(60),s=i(23).f;e.exports=function(e){var t=r.Symbol||(r.Symbol=a?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0;var n=o(i(0)),r=o(i(1)),a=i(64);function o(e){return e&&e.__esModule?e:{default:e}}var s=t.View=function(){function e(t){if((0,n.default)(this,e),this.mediatorMap=null,this.observerMap=null,this.multitonKey=null,null!=e.instanceMap[t])throw new Error(e.MULTITON_MSG);this.multitonKey=t,e.instanceMap[this.multitonKey]=this,this.mediatorMap=[],this.observerMap=[],this.initializeView()}return(0,r.default)(e,null,[{key:"removeView",value:function(t){delete e.instanceMap[t]}},{key:"getInstance",value:function(t){return null==t?null:(null==e.instanceMap[t]&&(e.instanceMap[t]=new e(t)),e.instanceMap[t])}}]),(0,r.default)(e,[{key:"initializeView",value:function(){}},{key:"registerObserver",value:function(e,t){null!=this.observerMap[e]?this.observerMap[e].push(t):this.observerMap[e]=[t]}},{key:"notifyObservers",value:function(e){if(null!=this.observerMap[e.getName()]){for(var t=this.observerMap[e.getName()],i=[],n=void 0,r=0,a=t.length;r<a;r++)n=t[r],i.push(n);for(var o=0,s=i.length;o<s;o++)(n=i[o]).notifyObserver(e)}}},{key:"removeObserver",value:function(e,t){for(var i=this.observerMap[e],n=0,r=i.length;n<r;n++)if(1==i[n].compareNotifyContext(t)){i.splice(n,1);break}0==i.length&&delete this.observerMap[e]}},{key:"registerMediator",value:function(e){if(null==this.mediatorMap[e.getMediatorName()]){e.initializeNotifier(this.multitonKey),this.mediatorMap[e.getMediatorName()]=e;var t=e.listNotificationInterests();if(t.length>0)for(var i=new a.Observer(e.handleNotification,e),n=0,r=t.length;n<r;n++)this.registerObserver(t[n],i);e.onRegister()}}},{key:"retrieveMediator",value:function(e){return this.mediatorMap[e]}},{key:"removeMediator",value:function(e){var t=this.mediatorMap[e];if(t){for(var i=t.listNotificationInterests(),n=0,r=i.length;n<r;n++)this.removeObserver(i[n],t);delete this.mediatorMap[e],t.onRemove()}return t}},{key:"hasMediator",value:function(e){return null!=this.mediatorMap[e]}}]),e}();s.instanceMap=[],s.MULTITON_MSG="View instance for this Multiton key already constructed!"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Observer=void 0;var n=a(i(0)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}t.Observer=function(){function e(t,i){(0,n.default)(this,e),this.notify=null,this.context=null,this.setNotifyMethod(t),this.setNotifyContext(i)}return(0,r.default)(e,[{key:"setNotifyMethod",value:function(e){this.notify=e}},{key:"setNotifyContext",value:function(e){this.context=e}},{key:"getNotifyMethod",value:function(){return this.notify}},{key:"getNotifyContext",value:function(){return this.context}},{key:"notifyObserver",value:function(e){this.getNotifyMethod().apply(this.getNotifyContext(),[e])}},{key:"compareNotifyContext",value:function(e){return e===this.context}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=S(i(90)),r=S(i(43)),a=S(i(84)),o=S(i(2)),s=S(i(0)),l=S(i(1)),u=S(i(3)),d=S(i(4)),f=S(i(8)),c=i(66),h=i(6),p=S(i(7)),v=i(16),y=i(13),g=i(27),m=S(i(33)),E=S(i(17)),_=i(18),T=i(31);function S(e){return e&&e.__esModule?e:{default:e}}var I=function(e){function t(e){return(0,s.default)(this,t),(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e))}return(0,d.default)(t,e),(0,l.default)(t,[{key:"loadData",value:function(){var e=this,t="";if(t=h.H5Common.isMobile?h.H5Common.playUrl?h.H5Common.playUrl:"/playurl/v1/play/playurlh5":"/playurl/v3/play/playurl",t=location.host.indexOf("117.131.17.174")>-1?"http://117.131.17.174:8083/gatewayPre"+t:"/gateway"+t,y.playerInfo.shieldStatus)e.sendNotification(v.H5Notification.PLAY_FAILED,{code:"1001",msg:"鐢变簬鐗堟潈鍘熷洜锛屾殏鏃舵棤娉曡鐪嬶紒"});else{var i={url:t,data:{contId:y.playerInfo.cid,rateType:y.playerInfo.rateTypeList,clientId:h.H5Common.clientID},headers:{userId:g.userInfo.userId,clientId:h.H5Common.clientID,SDKCEId:g.userInfo.clientId,userToken:g.userInfo.token},jsonpCallback:"play_request",cb:"callback"};try{if(window.General){var n=window.General.getChannelId();n&&(i.data.channelId=n,i.headers["X-UP-CLIENT-CHANNEL-ID"]=n)}}catch(e){}var r=this.getExtFromUrl();r&&r.contId==i.data.contId&&(0,a.default)(i.data,r),c.h5Net.jsonp(i,function(t){var i=-1,n=null;if(t){try{t.body.content.drm&&(n=501)}catch(e){}i=t.errorId?t.errorId:n||t.code}if(T.advertInfo.status=T.advertStatus.NONE,E.default.postMessage(_.ExternalEvent.VIDEO_PLAYURL_CODE,{code:i}),"10001"==t.errorId){p.default.debug("瑙ｆ瀽playconfig鍑洪敊");var r={code:h.H5Common.callCode.play[0],msg:"playurl璇锋眰瓒呮椂鎴栬€呭け璐�"};e.sendNotification(v.H5Notification.PLAY_FAILED,r)}else e.setData(t)})}}},{key:"setData",value:function(e){var t=this;try{if(p.default.debug("璇锋眰play鐨勮繑鍥炴暟鎹�>>>>>>>",e),200==e.code){if(h.H5Common.timestamp=e.timeStamp,e.body.content.drm)return void this.sendNotification(v.H5Notification.PLAY_FAILED,{code:501});h.H5Common.playData=this.parseData(e),E.default.postMessage(_.ExternalEvent.VIDEO_WATCH_WHOLE,{watchWhole:!h.H5Common.pay});var i=e.body.urlInfo;if(y.playerInfo.playType==y.playType.LIVE||Number(e.body.content.duration)<y.playerInfo.shikantime||h.H5Common.useTicket){if(h.H5Common.useTicket&&h.H5Common.pay)return void this.sendNotification(v.H5Notification.PLAY_FAILED,{code:h.H5Common.callCode.play[1]});if(h.H5Common.pay&&!g.userInfo.isVip)return y.playerInfo.status=y.playStatus.PAUSE,void this.sendNotification(v.H5Notification.PLAY_FAILED,{code:"409"})}if(h.H5Common.isMobile&&window.MiguPlayer)var n=setTimeout(function(){T.advertInfo.status===T.advertStatus.NONE&&(T.advertInfo.status=T.advertStatus.TIME_OUT,t.sendNotification(v.H5Notification.PLAY_SUCCESS,i)),clearTimeout(n)},3e3);else this.sendNotification(v.H5Notification.PLAY_SUCCESS,i)}else{if(h.H5Common.useTicket)return void this.sendNotification(v.H5Notification.PLAY_FAILED,{code:h.H5Common.callCode.play[1]});var r={};r.code=e.code||"2000",r.msg=e.message||"瑙嗛鎾斁鍑洪敊",this.sendNotification(v.H5Notification.PLAY_FAILED,r),p.default.debug(r)}}catch(e){p.default.debug("瑙ｆ瀽playconfig鍑洪敊",e)}}},{key:"parseData",value:function(e){var t=e.body,i=this.getPlayData(t);if(y.playerInfo.realDuration=Number(t.content.duration),y.playerInfo.duration=y.playerInfo.realDuration,y.playerInfo.rateType=i.rateType,h.H5Common.pay="trial"==i.urlType?1:0,y.playerInfo.urlType=i.urlType,t.urlInfos&&t.mediaFiles){t.urlInfos&&t.urlInfos.length&&i&&t.urlInfos.push(i);var n=t.urlInfos=this.filterArrayReturnObject(t.urlInfos),a=t.mediaFiles=this.filterArrayReturnObject(t.mediaFiles),o={};for(var s in n)a[s]&&(o[s]=a[s]);t.mediaFiles=o,y.playerInfo.rateTypeList=(0,r.default)(n).join(","),p.default.debug("<<<<褰撳墠鐮佹祦锛�"+t.urlInfo.rateType+"<<褰撳墠瑙嗛鐨勬墍鏈夋敮鎸佺爜娴�<<<"+y.playerInfo.rateTypeList)}return t.playBill?(y.playerInfo.playType=y.playType.LIVE,y.playerInfo.sTime=t.playBill.sTime||0,y.playerInfo.eTime=t.playBill.eTime||y.playerInfo.duration,y.playerInfo.playName=t.playBill.playName,y.playerInfo.sTime&&y.playerInfo.eTime&&e.timeStamp&&e.timeStamp>y.playerInfo.sTime&&e.timeStamp>y.playerInfo.eTime&&(y.playerInfo.playType=y.playType.HUIKAN,p.default.debug("<<<<鍥炵湅锛�"+y.playerInfo.sTime+"<<褰撳墠瑙嗛鐨勬墍鏈夋敮鎸佺爜娴�<<<"+y.playerInfo.eTime))):y.playerInfo.playType==y.playType.VOD&&(!t.urlInfo||"8"!=t.urlInfo.mediaType&&"12"!=t.urlInfo.mediaType||(y.playerInfo.playType=y.playType.LIVE)),t}},{key:"filterArrayReturnObject",value:function(e){var t={};if(e&&e.length>0){var i=!0,r=!1,a=void 0;try{for(var o,s=(0,n.default)(e);!(i=(o=s.next()).done);i=!0){var l=o.value,u=l.rateType;u&&!t[u]&&(t[u]=l)}}catch(e){r=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}return t}return null}},{key:"getPlayData",value:function(e){var t=e.urlInfo,i=e.urlInfos;try{!t&&i&&i.length&&(t=i[0],e.urlInfo=t)}catch(e){p.default.debug("<<<<<<<<play閰嶇疆鏂囦欢瑙ｆ瀽鍑洪敊",e)}return t}},{key:"getExtFromUrl",value:function(){var e={},t=m.default.getQueryString("cid")||m.default.getQueryString("cId"),i=m.default.getQueryString("tcbegin"),n=m.default.getQueryString("tcend"),r=m.default.getQueryString("uc"),a=m.default.getQueryString("mt");return t&&(e.contId=t),i&&(e.tcbegin=i),n&&(e.tcend=n),r&&(e.uc=r),a&&(e.mt=a),e}}]),t}(f.default.Proxy);I.NAME="h5_play_proxy",t.default=I},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.h5Net=void 0;var n=s(i(0)),r=s(i(1)),a=s(i(151)),o=(i(6),i(32));function s(e){return e&&e.__esModule?e:{default:e}}var l=void 0!==a.default&&"function"==typeof a.default&&/native code/.test(a.default.toString()),u=function(){function e(){(0,n.default)(this,e),this.count=0,this.retry=2,this.retryDelay=1e3}return(0,r.default)(e,[{key:"jsonp",value:function(e,t){l?new a.default(function(i,n){this.load(e,t,i,n)}).then(function(e){t&&t(e)}).catch(function(e){t&&t(e)}):this.load(e,t)}},{key:"load",value:function(e,t,i,n){var r=this;try{o.$.ajax({type:e.type||"GET",url:e.url,data:e.data,dataType:e.dataType||"json",cache:!0,headers:e.headers,success:function(e){l?i(e):t&&t(e)},error:function(a,o,s){r.count<r.retry?(r.count++,r.load(e,t,i,n)):l?n({error:s,type:o,errorId:"10001"}):t&&t({error:s,type:o,errorId:"10001"})}})}catch(e){throw"璋冪敤$鎶ラ敊"}}}]),e}();t.h5Net=new u},function(e,t,i){"use strict";var n=i(45);e.exports.f=function(e){return new function(e){var t,i;this.promise=new e(function(e,n){if(void 0!==t||void 0!==i)throw TypeError("Bad Promise constructor");t=e,i=n}),this.resolve=n(t),this.reject=n(i)}(e)}},function(e,t,i){e.exports={default:i(166),__esModule:!0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createVVID=r,t.createClientID=function(){if(window.localStorage){var e=window.localStorage.getItem("clientId");e&&window.localStorage.removeItem("clientId"),e=r(),n.H5Common.clientID=e,window.localStorage.setItem("clientId",e)}};var n=i(6);function r(){var e=function(e){for(var t="",i=0;i<e;i++)t+="0123456789abcdef".charAt(Math.random()*("0123456789abcdef".length-1)>>0);return t},t=[];t.push(e(8));for(var i=0;i<3;i++)t.push(e(4));var n=(new Date).getTime();return t.push(("0000000"+n.toString(16)).substr(-8)+e(4)),t.join("")}},function(e,t,i){var n=i(14),r=i(5),a=i(30);e.exports=function(e,t){var i=(r.Object||{})[e]||Object[e],o={};o[e]=t(i),n(n.S+n.F*a(function(){i(1)}),"Object",o)}},function(e,t,i){var n=i(48),r=i(46),a=i(28),o=i(54),s=i(25),l=i(75),u=Object.getOwnPropertyDescriptor;t.f=i(20)?u:function(e,t){if(e=a(e),t=o(t,!0),l)try{return u(e,t)}catch(e){}if(s(e,t))return r(!n.f.call(e,t),e[t])}},function(e,t,i){"use strict";t.__esModule=!0;var n=a(i(2)),r=a(i(216));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function e(t,i,a){null===t&&(t=Function.prototype);var o=(0,r.default)(t,i);if(void 0===o){var s=(0,n.default)(t);return null===s?void 0:e(s,i,a)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(a):void 0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferHelper=void 0;var n=a(i(0)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}t.BufferHelper=function(){function e(){(0,n.default)(this,e)}return(0,r.default)(e,null,[{key:"isBuffered",value:function(e,t){try{if(e)for(var i=e.buffered,n=0;n<i.length;n++)if(t>=i.start(n)&&t<=i.end(n))return!0}catch(e){}return!1}},{key:"bufferInfo",value:function(e,t,i){try{if(e){var n=e.buffered,r=[],a=void 0;for(a=0;a<n.length;a++)r.push({start:n.start(a),end:n.end(a)});return this.bufferedInfo(r,t,i)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,i){var n=[],r=void 0,a=void 0,o=void 0,s=void 0,l=void 0;for(e.sort(function(e,t){return e.start-t.start||t.end-e.end}),l=0;l<e.length;l++){var u=n.length;if(u){var d=n[u-1].end;e[l].start-d<i?e[l].end>d&&(n[u-1].end=e[l].end):n.push(e[l])}else n.push(e[l])}for(l=0,r=0,a=o=t;l<n.length;l++){var f=n[l].start,c=n[l].end;if(t+i>=f&&t<c)a=f,r=(o=c)-t;else if(t+i<f){s=f;break}}return{len:r,start:a,end:o,nextStart:s}}}]),e}()},function(e,t,i){var n=i(25),r=i(36),a=i(51)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=r(e),n(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,i){e.exports=!i(20)&&!i(30)(function(){return 7!=Object.defineProperty(i(53)("div"),"a",{get:function(){return 7}}).a})},function(e,t,i){"use strict";var n=i(37),r=i(14),a=i(77),o=i(26),s=i(39),l=i(110),u=i(47),d=i(74),f=i(12)("iterator"),c=!([].keys&&"next"in[].keys()),h=function(){return this};e.exports=function(e,t,i,p,v,y,g){l(i,t,p);var m,E,_,T=function(e){if(!c&&e in b)return b[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},S=t+" Iterator",I="values"==v,k=!1,b=e.prototype,A=b[f]||b["@@iterator"]||v&&b[v],w=A||T(v),D=v?I?T("entries"):w:void 0,C="Array"==t&&b.entries||A;if(C&&(_=d(C.call(new e)))!==Object.prototype&&_.next&&(u(_,S,!0),n||"function"==typeof _[f]||o(_,f,h)),I&&A&&"values"!==A.name&&(k=!0,w=function(){return A.call(this)}),n&&!g||!c&&!k&&b[f]||o(b,f,w),s[t]=w,s[S]=h,v)if(m={values:I?w:T("values"),keys:y?w:T("keys"),entries:D},g)for(E in m)E in b||a(b,E,m[E]);else r(r.P+r.F*(c||k),t,m);return m}},function(e,t,i){e.exports=i(26)},function(e,t,i){var n=i(25),r=i(28),a=i(112)(!1),o=i(51)("IE_PROTO");e.exports=function(e,t){var i,s=r(e),l=0,u=[];for(i in s)i!=o&&n(s,i)&&u.push(i);for(;t.length>l;)n(s,i=t[l++])&&(~a(u,i)||u.push(i));return u}},function(e,t,i){var n=i(41);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,i){var n=i(56),r=Math.min;e.exports=function(e){return e>0?r(n(e),9007199254740991):0}},function(e,t,i){var n=i(10).document;e.exports=n&&n.documentElement},function(e,t,i){var n=i(78),r=i(58).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,r)}},function(e,t){},function(e,t,i){e.exports={default:i(133),__esModule:!0}},function(e,t,i){e.exports={default:i(136),__esModule:!0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Model=void 0;var n=a(i(0)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var o=t.Model=function(){function e(t){if((0,n.default)(this,e),this.proxyMap=null,this.multitonKey=null,e.instanceMap[t])throw new Error(e.MULTITON_MSG);this.multitonKey=t,e.instanceMap[t]=this,this.proxyMap=[],this.initializeModel()}return(0,r.default)(e,null,[{key:"removeModel",value:function(t){delete e.instanceMap[t]}},{key:"getInstance",value:function(t){return null==e.instanceMap[t]&&(e.instanceMap[t]=new e(t)),e.instanceMap[t]}}]),(0,r.default)(e,[{key:"initializeModel",value:function(){}},{key:"registerProxy",value:function(e){e.initializeNotifier(this.multitonKey),this.proxyMap[e.getProxyName()]=e,e.onRegister()}},{key:"retrieveProxy",value:function(e){return this.proxyMap[e]}},{key:"hasProxy",value:function(e){return null!=this.proxyMap[e]}},{key:"removeProxy",value:function(e){var t=this.proxyMap[e];return t&&(this.proxyMap[e]=null,t.onRemove()),t}}]),e}();o.instanceMap=[],o.MULTITON_MSG="Model instance for this Multiton key already constructed!"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0;var n=s(i(0)),r=s(i(1)),a=i(64),o=i(63);function s(e){return e&&e.__esModule?e:{default:e}}var l=t.Controller=function(){function e(t){if((0,n.default)(this,e),this.view=null,this.commandMap=null,this.multitonKey=null,null!=e.instanceMap[t])throw new Error(e.MULTITON_MSG);this.multitonKey=t,e.instanceMap[this.multitonKey]=this,this.commandMap=new Array,this.initializeController()}return(0,r.default)(e,null,[{key:"getInstance",value:function(t){return null==e.instanceMap[t]&&(e.instanceMap[t]=new e(t)),e.instanceMap[t]}}]),(0,r.default)(e,[{key:"initializeController",value:function(){this.view=o.View.getInstance(this.multitonKey)}},{key:"executeCommand",value:function(e){var t=this.commandMap[e.getName()];if(null!=t){var i=new t;i.initializeNotifier(this.multitonKey),i.execute(e)}}},{key:"registerCommand",value:function(e,t){null==this.commandMap[e]&&this.view.registerObserver(e,new a.Observer(this.executeCommand,this)),this.commandMap[e]=t}},{key:"hasCommand",value:function(e){return null!=this.commandMap[e]}},{key:"removeCommand",value:function(e){this.hasCommand(e)&&(this.view.removeObserver(e,this),this.commandMap[e]=null)}}],[{key:"removeController",value:function(t){delete e.instanceMap[t]}}]),e}();l.instanceMap=[],l.MULTITON_MSG="controller key for this Multiton key already constructed"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Facade=void 0;var n=u(i(0)),r=u(i(1)),a=i(87),o=i(86),s=i(63),l=i(89);function u(e){return e&&e.__esModule?e:{default:e}}var d=t.Facade=function(){function e(t){if((0,n.default)(this,e),this.controller=null,this.model=null,this.view=null,this.multitonKey=null,null!=e.instanceMap[t])throw new Error(e.MULTITON_MSG);this.initializeNotifier(t),e.instanceMap[t]=this,this.initializeFacade()}return(0,r.default)(e,null,[{key:"hasCore",value:function(t){return null!=e.instanceMap[t]}},{key:"removeCore",value:function(t){null!=e.instanceMap[t]&&(o.Model.removeModel(t),s.View.removeView(t),a.Controller.removeController(t),delete e.instanceMap[t])}},{key:"getInstance",value:function(t){return null==e.instanceMap[t]&&(e.instanceMap[t]=new e(t)),e.instanceMap[t]}}]),(0,r.default)(e,[{key:"initializeFacade",value:function(){this.initializeModel(),this.initializeController(),this.initializeView()}},{key:"initializeController",value:function(){null==this.controller&&(this.controller=a.Controller.getInstance(this.multitonKey))}},{key:"initializeModel",value:function(){null==this.model&&(this.model=o.Model.getInstance(this.multitonKey))}},{key:"initializeView",value:function(){null==this.view&&(this.view=s.View.getInstance(this.multitonKey))}},{key:"registerCommand",value:function(e,t){this.controller.registerCommand(e,t)}},{key:"removeCommand",value:function(e){this.controller.removeCommand(e)}},{key:"hasCommand",value:function(e){return this.controller.hasCommand(e)}},{key:"registerProxy",value:function(e){this.model.registerProxy(e)}},{key:"retrieveProxy",value:function(e){return this.model.retrieveProxy(e)}},{key:"removeProxy",value:function(e){var t=null;return null!=this.model&&(t=this.model.removeProxy(e)),t}},{key:"hasProxy",value:function(e){return this.model.hasProxy(e)}},{key:"registerMediator",value:function(e){null!=this.view&&this.view.registerMediator(e)}},{key:"retrieveMediator",value:function(e){return this.view.retrieveMediator(e)}},{key:"removeMediator",value:function(e){var t=null;return null!=this.view&&(t=this.view.removeMediator(e)),t}},{key:"hasMediator",value:function(e){return this.view.hasMediator(e)}},{key:"sendNotification",value:function(e,t,i){this.notifyObservers(new l.Notification(e,t,i))}},{key:"notifyObservers",value:function(e){null!=this.view&&this.view.notifyObservers(e)}},{key:"initializeNotifier",value:function(e){this.multitonKey=e}}]),e}();d.instanceMap=[],d.MULTITON_MSG="Facade instance for this Multiton key already constructed!"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Notification=void 0;var n=a(i(0)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}t.Notification=function(){function e(t,i,r){(0,n.default)(this,e),this.name=null,this.type=null,this.body=null,this.name=t,this.body=i,this.type=r}return(0,r.default)(e,[{key:"getName",value:function(){return this.name}},{key:"setBody",value:function(e){this.body=e}},{key:"getBody",value:function(){return this.body}},{key:"setType",value:function(e){this.type=e}},{key:"getType",value:function(){return this.type}},{key:"toString",value:function(){var e="Notification Name: "+this.getName();return(e+="\nBody:"+(null==this.body?"null":this.body.toString()))+"\nType:"+(null==this.type?"null":this.type)}}]),e}()},function(e,t,i){e.exports={default:i(147),__esModule:!0}},function(e,t,i){var n=i(92),r=i(12)("iterator"),a=i(39);e.exports=i(5).getIteratorMethod=function(e){if(null!=e)return e[r]||e["@@iterator"]||a[n(e)]}},function(e,t,i){var n=i(41),r=i(12)("toStringTag"),a="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,i,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),r))?i:a?n(t):"Object"==(o=n(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,i){var n=i(15),r=i(45),a=i(12)("species");e.exports=function(e,t){var i,o=n(e).constructor;return void 0===o||null==(i=n(o)[a])?t:r(i)}},function(e,t,i){var n,r,a,o=i(38),s=i(158),l=i(81),u=i(53),d=i(10),f=d.process,c=d.setImmediate,h=d.clearImmediate,p=d.MessageChannel,v=d.Dispatch,y=0,g={},m=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},E=function(e){m.call(e.data)};c&&h||(c=function(e){for(var t=[],i=1;arguments.length>i;)t.push(arguments[i++]);return g[++y]=function(){s("function"==typeof e?e:Function(e),t)},n(y),y},h=function(e){delete g[e]},"process"==i(41)(f)?n=function(e){f.nextTick(o(m,e,1))}:v&&v.now?n=function(e){v.now(o(m,e,1))}:p?(a=(r=new p).port2,r.port1.onmessage=E,n=o(a.postMessage,a,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(n=function(e){d.postMessage(e+"","*")},d.addEventListener("message",E,!1)):n="onreadystatechange"in u("script")?function(e){l.appendChild(u("script")).onreadystatechange=function(){l.removeChild(this),m.call(e)}}:function(e){setTimeout(o(m,e,1),0)}),e.exports={set:c,clear:h}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,i){var n=i(15),r=i(24),a=i(67);e.exports=function(e,t){if(n(e),r(t)&&t.constructor===e)return t;var i=a.f(e);return(0,i.resolve)(t),i.promise}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=v(i(2)),r=v(i(0)),a=v(i(1)),o=v(i(3)),s=v(i(4)),l=v(i(8)),u=i(66),d=i(6),f=v(i(7)),c=i(16),h=i(13),p=i(27);function v(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(e){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"loadData",value:function(){var e=this,t={url:"/gateway"+(d.H5Common.recoPath+h.playerInfo.cid),data:{programType:h.playerInfo.programType?h.playerInfo.programType:"OTHER"},headers:{userId:p.userInfo.userId,clientId:d.H5Common.clientID,SDKCEId:p.userInfo.clientId,userToken:p.userInfo.token},jsonpCallback:"recom_request",cb:"callback"};u.h5Net.jsonp(t,function(t){"10001"==t.errorId?(f.default.debug("鎺ㄨ崘鎺ュ彛璇锋眰鍑洪敊"),this.sendNotification(c.H5Notification.RECO_SUCCESS,null)):e.setData(t)})}},{key:"setData",value:function(e){try{200==e.code?e.body&&e.body.data&&e.body.data.length&&this.sendNotification(c.H5Notification.RECO_SUCCESS,e.body.data):this.sendNotification(c.H5Notification.RECO_SUCCESS,null)}catch(e){f.default.debug("瑙ｆ瀽鎺ㄨ崘鎺ュ彛鍑洪敊",e)}}}]),t}(l.default.Proxy);y.NAME="recom_proxy",t.default=y},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(i(2)),r=f(i(0)),a=f(i(1)),o=f(i(3)),s=f(i(4)),l=f(i(8)),u=i(66),d=i(6);function f(e){return e&&e.__esModule?e:{default:e}}f(i(7));var c=function(e){function t(e){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"loadData",value:function(){u.h5Net.jsonp({url:"//127.0.0.1:5000",dataType:"text"},function(e){e.errorId||e&&(d.H5Common.hasClient=!0)})}}]),t}(l.default.Proxy);c.NAME="pc_client_proxy",t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FragmentTracker=t.FragmentState=void 0;var n=p(i(22)),r=p(i(43)),a=p(i(49)),o=p(i(2)),s=p(i(0)),l=p(i(1)),u=p(i(3)),d=p(i(72)),f=p(i(4)),c=p(i(29)),h=p(i(11));function p(e){return e&&e.__esModule?e:{default:e}}var v=t.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};t.FragmentTracker=function(e){function t(e){(0,s.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e,h.default.BUFFER_APPENDED,h.default.FRAG_BUFFERED,h.default.FRAG_LOADED));return i.bufferPadding=.2,i.fragments=(0,a.default)(null),i.timeRanges=(0,a.default)(null),i.config=e.config,i}return(0,f.default)(t,e),(0,l.default)(t,[{key:"destroy",value:function(){this.fragments=null,this.timeRanges=null,this.config=null,c.default.prototype.destroy.call(this),(0,d.default)(t.prototype.__proto__||(0,o.default)(t.prototype),"destroy",this).call(this)}},{key:"getBufferedFrag",value:function(e,t){var i=this.fragments,n=(0,r.default)(i).filter(function(n){var r=i[n];if(r.body.type!==t)return!1;if(!r.buffered)return!1;var a=r.body;return a.startPTS<=e&&e<=a.endPTS});if(0===n.length)return null;var a=n.pop();return i[a].body}},{key:"detectEvictedFragments",value:function(e,t){var i=this,n=void 0,a=void 0;(0,r.default)(this.fragments).forEach(function(r){var o=i.fragments[r];if(!0===o.buffered){var s=o.range[e];if(s){n=s.time;for(var l=0;l<n.length;l++)if(a=n[l],!1===i.isTimeBuffered(a.startPTS,a.endPTS,t)){i.removeFragment(o.body);break}}}})}},{key:"detectPartialFragments",value:function(e){var t=this,i=this.getFragmentKey(e),n=this.fragments[i];n&&(n.buffered=!0,(0,r.default)(this.timeRanges).forEach(function(i){if(e.hasElementaryStream(i)){var r=t.timeRanges[i];n.range[i]=t.getBufferedTimes(e.startPTS,e.endPTS,r)}}))}},{key:"getBufferedTimes",value:function(e,t,i){for(var n=[],r=void 0,a=void 0,o=!1,s=0;s<i.length;s++){if(r=i.start(s)-this.bufferPadding,a=i.end(s)+this.bufferPadding,e>=r&&t<=a){n.push({startPTS:Math.max(e,i.start(s)),endPTS:Math.min(t,i.end(s))});break}if(e<a&&t>r)n.push({startPTS:Math.max(e,i.start(s)),endPTS:Math.min(t,i.end(s))}),o=!0;else if(t<=r)break}return{time:n,partial:o}}},{key:"getFragmentKey",value:function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}},{key:"getPartialFragment",value:function(e){var t=this,i=void 0,n=void 0,a=void 0,o=null,s=0;return(0,r.default)(this.fragments).forEach(function(r){var l=t.fragments[r];t.isPartial(l)&&(n=l.body.startPTS-t.bufferPadding,a=l.body.endPTS+t.bufferPadding,e>=n&&e<=a&&(i=Math.min(e-n,a-e),s<=i&&(o=l.body,s=i)))}),o}},{key:"getState",value:function(e){var t=this.getFragmentKey(e),i=this.fragments[t],n=v.NOT_LOADED;return void 0!==i&&(n=i.buffered?!0===this.isPartial(i)?v.PARTIAL:v.OK:v.APPENDING),n}},{key:"isPartial",value:function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)}},{key:"isTimeBuffered",value:function(e,t,i){for(var n=void 0,r=void 0,a=0;a<i.length;a++){if(n=i.start(a)-this.bufferPadding,r=i.end(a)+this.bufferPadding,e>=n&&t<=r)return!0;if(t<=n)return!1}return!1}},{key:"onFragLoaded",value:function(e){var t=e.frag;(0,n.default)(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:(0,a.default)(null),buffered:!1})}},{key:"onBufferAppended",value:function(e){var t=this;this.timeRanges=e.timeRanges,(0,r.default)(this.timeRanges).forEach(function(e){var i=t.timeRanges[e];t.detectEvictedFragments(e,i)})}},{key:"onFragBuffered",value:function(e){this.detectPartialFragments(e.frag)}},{key:"hasFragment",value:function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]}},{key:"removeFragment",value:function(e){var t=this.getFragmentKey(e);delete this.fragments[t]}},{key:"removeAllFragments",value:function(){this.fragments=(0,a.default)(null)}}]),t}(c.default)},function(e,t,i){"use strict";t.__esModule=!0;var n,r=(n=i(85))&&n.__esModule?n:{default:n};t.default=function(e,t,i){return t in e?(0,r.default)(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}},function(e,t,i){var n,r,a,o,s;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,r=/^([^\/?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var n=s.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=s.normalizePath(n.path),s.buildURLFromParts(n)}var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=r.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var d=o.path,f=d.substring(0,d.lastIndexOf("/")+1)+a.path;u.path=s.normalizePath(f)}else u.path=o.path,a.params||(u.params=o.params,a.query||(u.query=o.query));return null===u.path&&(u.path=i.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(u)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(o,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={search:function(e,t){for(var i=0,n=e.length-1,r=null,a=null;i<=n;){var o=t(a=e[r=(i+n)/2|0]);if(o>0)i=r+1;else{if(!(o<0))return a;n=r-1}}return null}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.utf8ArrayToStr=void 0;var n=a(i(0)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,n.default)(this,e)}return(0,r.default)(e,null,[{key:"isHeader",value:function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}},{key:"isFooter",value:function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}},{key:"getID3Data",value:function(t,i){for(var n=i,r=0;e.isHeader(t,i);)r+=10,r+=e._readSize(t,i+6),e.isFooter(t,i+10)&&(r+=10),i+=r;if(r>0)return t.subarray(n,n+r)}},{key:"_readSize",value:function(e,t){var i=0;return i=(127&e[t])<<21,i|=(127&e[t+1])<<14,(i|=(127&e[t+2])<<7)|127&e[t+3]}},{key:"getTimeStamp",value:function(t){for(var i=e.getID3Frames(t),n=0;n<i.length;n++){var r=i[n];if(e.isTimeStampFrame(r))return e._readTimeStamp(r)}}},{key:"isTimeStampFrame",value:function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}},{key:"_getFrameData",value:function(t){var i=String.fromCharCode(t[0],t[1],t[2],t[3]),n=e._readSize(t,4);return{type:i,size:n,data:t.subarray(10,10+n)}}},{key:"getID3Frames",value:function(t){for(var i=0,n=[];e.isHeader(t,i);){for(var r=e._readSize(t,i+6),a=(i+=10)+r;i+8<a;){var o=e._getFrameData(t.subarray(i)),s=e._decodeFrame(o);s&&n.push(s),i+=o.size+10}e.isFooter(t,i)&&(i+=10)}return n}},{key:"_decodeFrame",value:function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0}},{key:"_readTimeStamp",value:function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),i=1&t[3],n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,i&&(n+=47721858.84),Math.round(n)}}},{key:"_decodePrivFrame",value:function(t){if(!(t.size<2)){var i=e._utf8ArrayToStr(t.data,!0),n=new Uint8Array(t.data.subarray(i.length+1));return{key:t.type,info:i,data:n.buffer}}}},{key:"_decodeTextFrame",value:function(t){if(!(t.size<2)){if("TXXX"===t.type){var i=1,n=e._utf8ArrayToStr(t.data.subarray(i));i+=n.length+1;var r=e._utf8ArrayToStr(t.data.subarray(i));return{key:t.type,info:n,data:r}}var a=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:a}}}},{key:"_decodeURLFrame",value:function(t){if("WXXX"===t.type){if(t.size<2)return;var i=1,n=e._utf8ArrayToStr(t.data.subarray(i));i+=n.length+1;var r=e._utf8ArrayToStr(t.data.subarray(i));return{key:t.type,info:n,data:r}}var a=e._utf8ArrayToStr(t.data);return{key:t.type,data:a}}},{key:"_utf8ArrayToStr",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.length,n=void 0,r=void 0,a=void 0,o="",s=0;s<i;){if(0===(n=e[s++])&&t)return o;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:r=e[s++],o+=String.fromCharCode((31&n)<<6|63&r);break;case 14:r=e[s++],a=e[s++],o+=String.fromCharCode((15&n)<<12|(63&r)<<6|(63&a)<<0)}}return o}}]),e}(),s=o._utf8ArrayToStr;t.default=o,t.utf8ArrayToStr=s},function(e,t,i){i(106),e.exports=i(5).Object.getPrototypeOf},function(e,t,i){var n=i(36),r=i(74);i(70)("getPrototypeOf",function(){return function(e){return r(n(e))}})},function(e,t,i){e.exports={default:i(108),__esModule:!0}},function(e,t,i){i(55),i(59),e.exports=i(60).f("iterator")},function(e,t,i){var n=i(56),r=i(50);e.exports=function(e){return function(t,i){var a,o,s=String(r(t)),l=n(i),u=s.length;return l<0||l>=u?e?"":void 0:(a=s.charCodeAt(l))<55296||a>56319||l+1===u||(o=s.charCodeAt(l+1))<56320||o>57343?e?s.charAt(l):a:e?s.slice(l,l+2):o-56320+(a-55296<<10)+65536}}},function(e,t,i){"use strict";var n=i(57),r=i(46),a=i(47),o={};i(26)(o,i(12)("iterator"),function(){return this}),e.exports=function(e,t,i){e.prototype=n(o,{next:r(1,i)}),a(e,t+" Iterator")}},function(e,t,i){var n=i(23),r=i(15),a=i(40);e.exports=i(20)?Object.defineProperties:function(e,t){r(e);for(var i,o=a(t),s=o.length,l=0;s>l;)n.f(e,i=o[l++],t[i]);return e}},function(e,t,i){var n=i(28),r=i(80),a=i(113);e.exports=function(e){return function(t,i,o){var s,l=n(t),u=r(l.length),d=a(o,u);if(e&&i!=i){for(;u>d;)if((s=l[d++])!=s)return!0}else for(;u>d;d++)if((e||d in l)&&l[d]===i)return e||d||0;return!e&&-1}}},function(e,t,i){var n=i(56),r=Math.max,a=Math.min;e.exports=function(e,t){return(e=n(e))<0?r(e+t,0):a(e,t)}},function(e,t,i){"use strict";var n=i(115),r=i(116),a=i(39),o=i(28);e.exports=i(76)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,r(1)):r(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])},"values"),a.Arguments=a.Array,n("keys"),n("values"),n("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,i){e.exports={default:i(118),__esModule:!0}},function(e,t,i){i(119),i(83),i(124),i(125),e.exports=i(5).Symbol},function(e,t,i){"use strict";var n=i(10),r=i(25),a=i(20),o=i(14),s=i(77),l=i(120).KEY,u=i(30),d=i(52),f=i(47),c=i(44),h=i(12),p=i(60),v=i(61),y=i(121),g=i(122),m=i(15),E=i(24),_=i(36),T=i(28),S=i(54),I=i(46),k=i(57),b=i(123),A=i(71),w=i(62),D=i(23),C=i(40),R=A.f,O=D.f,L=b.f,P=n.Symbol,M=n.JSON,N=M&&M.stringify,x=h("_hidden"),U=h("toPrimitive"),H={}.propertyIsEnumerable,F=d("symbol-registry"),B=d("symbols"),V=d("op-symbols"),G=Object.prototype,K="function"==typeof P&&!!w.f,j=n.QObject,Y=!j||!j.prototype||!j.prototype.findChild,W=a&&u(function(){return 7!=k(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a})?function(e,t,i){var n=R(G,t);n&&delete G[t],O(e,t,i),n&&e!==G&&O(G,t,n)}:O,z=function(e){var t=B[e]=k(P.prototype);return t._k=e,t},q=K&&"symbol"==typeof P.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof P},X=function(e,t,i){return e===G&&X(V,t,i),m(e),t=S(t,!0),m(i),r(B,t)?(i.enumerable?(r(e,x)&&e[x][t]&&(e[x][t]=!1),i=k(i,{enumerable:I(0,!1)})):(r(e,x)||O(e,x,I(1,{})),e[x][t]=!0),W(e,t,i)):O(e,t,i)},$=function(e,t){m(e);for(var i,n=y(t=T(t)),r=0,a=n.length;a>r;)X(e,i=n[r++],t[i]);return e},Q=function(e){var t=H.call(this,e=S(e,!0));return!(this===G&&r(B,e)&&!r(V,e))&&(!(t||!r(this,e)||!r(B,e)||r(this,x)&&this[x][e])||t)},Z=function(e,t){if(e=T(e),t=S(t,!0),e!==G||!r(B,t)||r(V,t)){var i=R(e,t);return!i||!r(B,t)||r(e,x)&&e[x][t]||(i.enumerable=!0),i}},J=function(e){for(var t,i=L(T(e)),n=[],a=0;i.length>a;)r(B,t=i[a++])||t==x||t==l||n.push(t);return n},ee=function(e){for(var t,i=e===G,n=L(i?V:T(e)),a=[],o=0;n.length>o;)!r(B,t=n[o++])||i&&!r(G,t)||a.push(B[t]);return a};K||(s((P=function(){if(this instanceof P)throw TypeError("Symbol is not a constructor!");var e=c(arguments.length>0?arguments[0]:void 0),t=function(i){this===G&&t.call(V,i),r(this,x)&&r(this[x],e)&&(this[x][e]=!1),W(this,e,I(1,i))};return a&&Y&&W(G,e,{configurable:!0,set:t}),z(e)}).prototype,"toString",function(){return this._k}),A.f=Z,D.f=X,i(82).f=b.f=J,i(48).f=Q,w.f=ee,a&&!i(37)&&s(G,"propertyIsEnumerable",Q,!0),p.f=function(e){return z(h(e))}),o(o.G+o.W+o.F*!K,{Symbol:P});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ie=0;te.length>ie;)h(te[ie++]);for(var ne=C(h.store),re=0;ne.length>re;)v(ne[re++]);o(o.S+o.F*!K,"Symbol",{for:function(e){return r(F,e+="")?F[e]:F[e]=P(e)},keyFor:function(e){if(!q(e))throw TypeError(e+" is not a symbol!");for(var t in F)if(F[t]===e)return t},useSetter:function(){Y=!0},useSimple:function(){Y=!1}}),o(o.S+o.F*!K,"Object",{create:function(e,t){return void 0===t?k(e):$(k(e),t)},defineProperty:X,defineProperties:$,getOwnPropertyDescriptor:Z,getOwnPropertyNames:J,getOwnPropertySymbols:ee});var ae=u(function(){w.f(1)});o(o.S+o.F*ae,"Object",{getOwnPropertySymbols:function(e){return w.f(_(e))}}),M&&o(o.S+o.F*(!K||u(function(){var e=P();return"[null]"!=N([e])||"{}"!=N({a:e})||"{}"!=N(Object(e))})),"JSON",{stringify:function(e){for(var t,i,n=[e],r=1;arguments.length>r;)n.push(arguments[r++]);if(i=t=n[1],(E(t)||void 0!==e)&&!q(e))return g(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!q(t))return t}),n[1]=t,N.apply(M,n)}}),P.prototype[U]||i(26)(P.prototype,U,P.prototype.valueOf),f(P,"Symbol"),f(Math,"Math",!0),f(n.JSON,"JSON",!0)},function(e,t,i){var n=i(44)("meta"),r=i(24),a=i(25),o=i(23).f,s=0,l=Object.isExtensible||function(){return!0},u=!i(30)(function(){return l(Object.preventExtensions({}))}),d=function(e){o(e,n,{value:{i:"O"+ ++s,w:{}}})},f=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!r(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,n)){if(!l(e))return"F";if(!t)return"E";d(e)}return e[n].i},getWeak:function(e,t){if(!a(e,n)){if(!l(e))return!0;if(!t)return!1;d(e)}return e[n].w},onFreeze:function(e){return u&&f.NEED&&l(e)&&!a(e,n)&&d(e),e}}},function(e,t,i){var n=i(40),r=i(62),a=i(48);e.exports=function(e){var t=n(e),i=r.f;if(i)for(var o,s=i(e),l=a.f,u=0;s.length>u;)l.call(e,o=s[u++])&&t.push(o);return t}},function(e,t,i){var n=i(41);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,i){var n=i(28),r=i(82).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==a.call(e)?function(e){try{return r(e)}catch(e){return o.slice()}}(e):r(n(e))}},function(e,t,i){i(61)("asyncIterator")},function(e,t,i){i(61)("observable")},function(e,t,i){e.exports={default:i(127),__esModule:!0}},function(e,t,i){i(128),e.exports=i(5).Object.setPrototypeOf},function(e,t,i){var n=i(14);n(n.S,"Object",{setPrototypeOf:i(129).set})},function(e,t,i){var n=i(24),r=i(15),a=function(e,t){if(r(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{(n=i(38)(Function.call,i(71).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,i){return a(e,i),t?e.__proto__=i:n(e,i),e}}({},!1):void 0),check:a}},function(e,t,i){i(131);var n=i(5).Object;e.exports=function(e,t){return n.create(e,t)}},function(e,t,i){var n=i(14);n(n.S,"Object",{create:i(57)})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(i(84)),r=c(i(0)),a=c(i(1)),o=c(i(138)),s=i(6),l=i(32),u=c(i(7)),d=c(i(17)),f=i(18);function c(e){return e&&e.__esModule?e:{default:e}}i(13);try{document.domain="miguvideo.com"}catch(e){}var h=function(){function e(t){(0,r.default)(this,e);var i=(0,n.default)({},{cid:"",width:"100%",height:"100%",container:"#site-player"},t);try{this.init()}catch(e){}try{this.app=o.default.getInstance(o.default.NAME),this.app.startUp(i),d.default.postMessage(f.ExternalEvent.VIDEO_STATUS,f.playerStatusType.READY)}catch(e){u.default.debug(e.message)}}return(0,a.default)(e,[{key:"init",value:function(){u.default.debug("鎾斁鍣ㄧ増鏈彿: "+s.H5Common.version),(s.H5Common.isMobile=s.H5Common.mobileRegExp.test(navigator.userAgent))&&window.General&&window.General.rem(),l.$||(0,l.set$)(),s.H5Common.ow=(0,l.$)(window).width(),s.H5Common.oh=(0,l.$)(window).height()}},{key:"setCTX",value:function(e){this.app.setCTX(e)}},{key:"setUserInfo",value:function(e){this.app.setUserInfo(e)}},{key:"playVideo",value:function(e){this.app.playVideo(e)}},{key:"pauseVideo",value:function(){this.app.pauseVideo()}},{key:"stopVideo",value:function(){this.app.stopVideo()}},{key:"seekVideo",value:function(e){this.app.seekVideo(e)}},{key:"switchVideo",value:function(e){this.app.switchVideo(e)}},{key:"fullScreen",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0],this.app.fullScreen()}},{key:"setAutoPlay",value:function(e){this.app.setAutoPlay(e)}},{key:"setPageZoom",value:function(e){this.app.setPageZoom(e)}},{key:"setMiniPlayer",value:function(e){this.app.setMiniPlayer(e)}},{key:"showErrorUI",value:function(e){this.app.showErrorUI(e)}},{key:"advertStatus",value:function(e){e&&this.app.advertStatus(e)}},{key:"duration",get:function(){return console.log("璁剧疆"),this.app.duration}},{key:"playStatus",get:function(){return this.app.playStatus}},{key:"volume",set:function(e){this.app.volume=e},get:function(){return this.app.volume}},{key:"currentTime",get:function(){return this.app.currentTime}},{key:"rateTypeList",get:function(){return s.H5Common.playData?s.H5Common.playData.mediaFiles:(u.default.debug("<<<<<<<<鎾斁鏁版嵁鏈姹傚埌鎴栬€呮病鏈夌爜娴佷俊鎭�"),null)}},{key:"rateType",get:function(){return this.app.rateType}},{key:"heartDuration",set:function(e){s.H5Common.heartDuration=e}},{key:"shieldStatus",set:function(e){this.app.setShieldStatus(e)}},{key:"videoEl",get:function(){return this.app.videoEl}}]),e}();t.default=h},function(e,t,i){i(134),e.exports=i(5).Object.assign},function(e,t,i){var n=i(14);n(n.S+n.F,"Object",{assign:i(135)})},function(e,t,i){"use strict";var n=i(20),r=i(40),a=i(62),o=i(48),s=i(36),l=i(79),u=Object.assign;e.exports=!u||i(30)(function(){var e={},t={},i=Symbol(),n="abcdefghijklmnopqrst";return e[i]=7,n.split("").forEach(function(e){t[e]=e}),7!=u({},e)[i]||Object.keys(u({},t)).join("")!=n})?function(e,t){for(var i=s(e),u=arguments.length,d=1,f=a.f,c=o.f;u>d;)for(var h,p=l(arguments[d++]),v=f?r(p).concat(f(p)):r(p),y=v.length,g=0;y>g;)h=v[g++],n&&!c.call(p,h)||(i[h]=p[h]);return i}:u},function(e,t,i){i(137);var n=i(5).Object;e.exports=function(e,t,i){return n.defineProperty(e,t,i)}},function(e,t,i){var n=i(14);n(n.S+n.F*!i(20),"Object",{defineProperty:i(23).f})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=y(i(2)),r=y(i(0)),a=y(i(1)),o=y(i(3)),s=y(i(4)),l=y(i(8)),u=i(6),d=i(16),f=y(i(143)),c=i(13),h=i(27),p=i(69),v=y(i(7));function y(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"startUp",value:function(e){v.default.debug("鎾斁鍣ㄥ紑濮嬪垵濮嬪寲"),this.initPlayInfo(e),e.ctx&&this.setCTX(e.ctx),this.registerCommand(d.H5Notification.START_UP,f.default),this.sendNotification(d.H5Notification.START_UP)}},{key:"initPlayInfo",value:function(e){u.H5Common.container=e.container,c.playerInfo.cid=e.cid||"",(0,p.createClientID)()}},{key:"setCTX",value:function(e){e.rateType&&(c.playerInfo.rateTypeList=e.rateType),e.h5pic&&(c.playerInfo.poster=e.h5pic),e.userInfo&&(u.H5Common.userData=e.userInfo,this.setUserInfo(e.userInfo)),e.memberInfo&&(u.H5Common.userData=e.userInfo),void 0!==e.isVip&&(h.userInfo.isVip=!!e.isVip),e.playType&&(c.playerInfo.playType=e.playType),e.isUseTicket&&(u.H5Common.useTicket=!0),e.shikanTime&&(c.playerInfo.shikanTime=e.shikanTime),e.heartDuration&&(u.H5Common.heartDuration=e.heartDuration),e.skin&&(u.H5Common.skinCfg=e.skin),e.shieldStatus&&(c.playerInfo.shieldStatus=e.shieldStatus),e.programType&&(c.playerInfo.programType=e.programType),e.pcClientUrl&&(u.H5Common.pcClientUrl=e.pcClientUrl),e.startPay&&(e.startPay.btnVipTip&&(u.H5Common.startBtnVipTip=e.startPay.btnVipTip),e.startPay.startTip&&(u.H5Common.startBtnTip=e.startPay.btnTip),e.startPay.tip&&(u.H5Common.startTip=e.startPay.tip)),e.playUrl&&(u.H5Common.playUrl=e.playUrl)}},{key:"playVideo",value:function(e,t){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,{id:e,ext:t},d.ExternalApiType.VIDEO_PLAY)}},{key:"pauseVideo",value:function(){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,null,d.ExternalApiType.VIDEO_PAUSE)}},{key:"stopVideo",value:function(){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,null,d.ExternalApiType.VIDEO_STOP)}},{key:"seekVideo",value:function(e){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,{posi:e},d.ExternalApiType.VIDEO_SEEK)}},{key:"switchVideo",value:function(e){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,{rateType:e},d.ExternalApiType.VIDEO_SWITCH)}},{key:"setUserInfo",value:function(e){e&&(e.userId&&(h.userInfo.userId=e.userId),e.userToken&&(h.userInfo.token=e.userToken),e.sname&&(h.userInfo.name=e.sname),e.clientId&&(h.userInfo.clientId=e.clientId))}},{key:"fullScreen",value:function(e){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,{fullscreen:e},d.ExternalApiType.VIDEO_FULLSCREEN)}},{key:"setShieldStatus",value:function(e){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,{shieldStatus:e},d.ExternalApiType.VIDEO_SHIELD_STATUS)}},{key:"setAutoPlay",value:function(e){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,{autoPlay:e},d.ExternalApiType.VIDEO_AUTO_PLAY)}},{key:"setPageZoom",value:function(e){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,{pageZoom:e},d.ExternalApiType.VIDEO_PAGE_ZOOM)}},{key:"setMiniPlayer",value:function(e){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,{mini:e},d.ExternalApiType.VIDEO_MINI_PLAYER)}},{key:"showErrorUI",value:function(e){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,{params:e},d.ExternalApiType.SKIN_SHOW_ERROR_UI)}},{key:"advertStatus",value:function(e){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,{params:e},d.ExternalApiType.ADVERT_STATUS)}},{key:"duration",get:function(){return c.playerInfo.duration}},{key:"playStatus",get:function(){return c.playerInfo.status}},{key:"volume",set:function(e){this.sendNotification(d.H5Notification.EXTERNAL_NOTICATION,{volume:e},d.ExternalApiType.VIDEO_VOLUME)},get:function(){return c.playerInfo.volume}},{key:"currentTime",get:function(){return c.playerInfo.posi}},{key:"rateType",get:function(){return c.playerInfo.rateType}},{key:"videoEl",get:function(){return c.playerInfo.el}}],[{key:"getInstance",value:function(e){var i=l.default.Facade.instanceMap;return i[e]||(i[e]=new t(e))}}]),t}(l.default.Facade);g.NAME="app_facade",t.default=g},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleCommand=void 0;var n=u(i(2)),r=u(i(0)),a=u(i(1)),o=u(i(3)),s=u(i(4)),l=i(42);function u(e){return e&&e.__esModule?e:{default:e}}t.SimpleCommand=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"execute",value:function(e){}}]),t}(l.Notifier)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MacroCommand=void 0;var n=u(i(2)),r=u(i(0)),a=u(i(1)),o=u(i(3)),s=u(i(4)),l=i(42);function u(e){return e&&e.__esModule?e:{default:e}}t.MacroCommand=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return e.subCommands=null,e.subCommands=[],e.initializeMacroCommand(),e}return(0,s.default)(t,e),(0,a.default)(t,[{key:"initializeMacroCommand",value:function(){}},{key:"addSubCommand",value:function(e){this.subCommands.push(e)}},{key:"execute",value:function(e){for(;this.subCommands.length>0;){var t=new(this.subCommands.shift());t.initializeNotifier(this.multitonKey),t.execute(e)}}}]),t}(l.Notifier)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mediator=void 0;var n=u(i(2)),r=u(i(0)),a=u(i(1)),o=u(i(3)),s=u(i(4)),l=i(42);function u(e){return e&&e.__esModule?e:{default:e}}(t.Mediator=function(e){function t(e,i){(0,r.default)(this,t);var a=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return a.mediatorName=null,a.viewComponent=null,a.mediatorName=e||a.constructor.NAME,a.viewComponent=i,a}return(0,s.default)(t,e),(0,a.default)(t,[{key:"getMediatorName",value:function(){return this.mediatorName}},{key:"setViewComponent",value:function(e){this.viewComponent=e}},{key:"getViewComponent",value:function(){return this.viewComponent}},{key:"listNotificationInterests",value:function(){return[]}},{key:"handleNotification",value:function(e){}},{key:"onRegister",value:function(){}},{key:"onRemove",value:function(){}}]),t}(l.Notifier)).NAME="Mediator"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Proxy=void 0;var n=u(i(2)),r=u(i(0)),a=u(i(1)),o=u(i(3)),s=u(i(4)),l=i(42);function u(e){return e&&e.__esModule?e:{default:e}}(t.Proxy=function(e){function t(e,i){(0,r.default)(this,t);var a=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return a.proxyName=null,a.data=null,a.proxyName=e||a.constructor.NAME,null!=i&&a.setData(i),a}return(0,s.default)(t,e),(0,a.default)(t,[{key:"getProxyName",value:function(){return this.proxyName}},{key:"setData",value:function(e){this.data=e}},{key:"getData",value:function(){return this.data}},{key:"onRegister",value:function(){}},{key:"onRemove",value:function(){}}]),t}(l.Notifier)).NAME="Proxy"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=h(i(2)),r=h(i(0)),a=h(i(1)),o=h(i(3)),s=h(i(4)),l=h(i(8)),u=h(i(144)),d=h(i(146)),f=h(i(167)),c=h(i(7));function h(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"initializeMacroCommand",value:function(){c.default.debug("1娉ㄥ唽H5ControllerCommand || H5ModelCommand || H5ViewCommand 寮€濮�"),this.addSubCommand(d.default),this.addSubCommand(u.default),this.addSubCommand(f.default)}}]),t}(l.default.MacroCommand);t.default=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(i(2)),r=f(i(0)),a=f(i(1)),o=f(i(3)),s=f(i(4)),l=f(i(8)),u=i(16),d=f(i(145));function f(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"execute",value:function(e){this.facade.registerCommand(u.H5Notification.PLAY_SUCCESS,d.default)}}]),t}(l.default.SimpleCommand);c.NAME="h5_controller_command",t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(i(2)),r=l(i(0)),a=l(i(1)),o=l(i(3)),s=l(i(4));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"execute",value:function(e){e.getBody()}}]),t}(l(i(8)).default.SimpleCommand);t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(i(2)),r=c(i(0)),a=c(i(1)),o=c(i(3)),s=c(i(4)),l=c(i(8)),u=c(i(65)),d=c(i(97)),f=c(i(98));function c(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"execute",value:function(e){this.facade.registerProxy(new u.default(u.default.NAME)),this.facade.registerProxy(new d.default(d.default.NAME)),this.facade.registerProxy(new f.default(f.default.NAME))}}]),t}(l.default.SimpleCommand);h.NAME="h5_proxy_command",t.default=h},function(e,t,i){i(59),i(55),e.exports=i(148)},function(e,t,i){var n=i(15),r=i(91);e.exports=i(5).getIterator=function(e){var t=r(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},function(e,t,i){i(150),e.exports=i(5).Object.keys},function(e,t,i){var n=i(36),r=i(40);i(70)("keys",function(){return function(e){return r(n(e))}})},function(e,t,i){e.exports={default:i(152),__esModule:!0}},function(e,t,i){i(83),i(55),i(59),i(153),i(164),i(165),e.exports=i(5).Promise},function(e,t,i){"use strict";var n,r,a,o,s=i(37),l=i(10),u=i(38),d=i(92),f=i(14),c=i(24),h=i(45),p=i(154),v=i(155),y=i(93),g=i(94).set,m=i(159)(),E=i(67),_=i(95),T=i(160),S=i(96),I=l.TypeError,k=l.process,b=k&&k.versions,A=b&&b.v8||"",w=l.Promise,D="process"==d(k),C=function(){},R=r=E.f,O=!!function(){try{var e=w.resolve(1),t=(e.constructor={})[i(12)("species")]=function(e){e(C,C)};return(D||"function"==typeof PromiseRejectionEvent)&&e.then(C)instanceof t&&0!==A.indexOf("6.6")&&-1===T.indexOf("Chrome/66")}catch(e){}}(),L=function(e){var t;return!(!c(e)||"function"!=typeof(t=e.then))&&t},P=function(e,t){if(!e._n){e._n=!0;var i=e._c;m(function(){for(var n=e._v,r=1==e._s,a=0,o=function(t){var i,a,o,s=r?t.ok:t.fail,l=t.resolve,u=t.reject,d=t.domain;try{s?(r||(2==e._h&&x(e),e._h=1),!0===s?i=n:(d&&d.enter(),i=s(n),d&&(d.exit(),o=!0)),i===t.promise?u(I("Promise-chain cycle")):(a=L(i))?a.call(i,l,u):l(i)):u(n)}catch(e){d&&!o&&d.exit(),u(e)}};i.length>a;)o(i[a++]);e._c=[],e._n=!1,t&&!e._h&&M(e)})}},M=function(e){g.call(l,function(){var t,i,n,r=e._v,a=N(e);if(a&&(t=_(function(){D?k.emit("unhandledRejection",r,e):(i=l.onunhandledrejection)?i({promise:e,reason:r}):(n=l.console)&&n.error&&n.error("Unhandled promise rejection",r)}),e._h=D||N(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},N=function(e){return 1!==e._h&&0===(e._a||e._c).length},x=function(e){g.call(l,function(){var t;D?k.emit("rejectionHandled",e):(t=l.onrejectionhandled)&&t({promise:e,reason:e._v})})},U=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),P(t,!0))},H=function(e){var t,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===e)throw I("Promise can't be resolved itself");(t=L(e))?m(function(){var n={_w:i,_d:!1};try{t.call(e,u(H,n,1),u(U,n,1))}catch(e){U.call(n,e)}}):(i._v=e,i._s=1,P(i,!1))}catch(e){U.call({_w:i,_d:!1},e)}}};O||(w=function(e){p(this,w,"Promise","_h"),h(e),n.call(this);try{e(u(H,this,1),u(U,this,1))}catch(e){U.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=i(161)(w.prototype,{then:function(e,t){var i=R(y(this,w));return i.ok="function"!=typeof e||e,i.fail="function"==typeof t&&t,i.domain=D?k.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&P(this,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new n;this.promise=e,this.resolve=u(H,e,1),this.reject=u(U,e,1)},E.f=R=function(e){return e===w||e===o?new a(e):r(e)}),f(f.G+f.W+f.F*!O,{Promise:w}),i(47)(w,"Promise"),i(162)("Promise"),o=i(5).Promise,f(f.S+f.F*!O,"Promise",{reject:function(e){var t=R(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(s||!O),"Promise",{resolve:function(e){return S(s&&this===o?w:this,e)}}),f(f.S+f.F*!(O&&i(163)(function(e){w.all(e).catch(C)})),"Promise",{all:function(e){var t=this,i=R(t),n=i.resolve,r=i.reject,a=_(function(){var i=[],a=0,o=1;v(e,!1,function(e){var s=a++,l=!1;i.push(void 0),o++,t.resolve(e).then(function(e){l||(l=!0,i[s]=e,--o||n(i))},r)}),--o||n(i)});return a.e&&r(a.v),i.promise},race:function(e){var t=this,i=R(t),n=i.reject,r=_(function(){v(e,!1,function(e){t.resolve(e).then(i.resolve,n)})});return r.e&&n(r.v),i.promise}})},function(e,t){e.exports=function(e,t,i,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(i+": incorrect invocation!");return e}},function(e,t,i){var n=i(38),r=i(156),a=i(157),o=i(15),s=i(80),l=i(91),u={},d={};(t=e.exports=function(e,t,i,f,c){var h,p,v,y,g=c?function(){return e}:l(e),m=n(i,f,t?2:1),E=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(a(g)){for(h=s(e.length);h>E;E++)if((y=t?m(o(p=e[E])[0],p[1]):m(e[E]))===u||y===d)return y}else for(v=g.call(e);!(p=v.next()).done;)if((y=r(v,m,p.value,t))===u||y===d)return y}).BREAK=u,t.RETURN=d},function(e,t,i){var n=i(15);e.exports=function(e,t,i,r){try{return r?t(n(i)[0],i[1]):t(i)}catch(t){var a=e.return;throw void 0!==a&&n(a.call(e)),t}}},function(e,t,i){var n=i(39),r=i(12)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||a[r]===e)}},function(e,t){e.exports=function(e,t,i){var n=void 0===i;switch(t.length){case 0:return n?e():e.call(i);case 1:return n?e(t[0]):e.call(i,t[0]);case 2:return n?e(t[0],t[1]):e.call(i,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(i,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(i,t[0],t[1],t[2],t[3])}return e.apply(i,t)}},function(e,t,i){var n=i(10),r=i(94).set,a=n.MutationObserver||n.WebKitMutationObserver,o=n.process,s=n.Promise,l="process"==i(41)(o);e.exports=function(){var e,t,i,u=function(){var n,r;for(l&&(n=o.domain)&&n.exit();e;){r=e.fn,e=e.next;try{r()}catch(n){throw e?i():t=void 0,n}}t=void 0,n&&n.enter()};if(l)i=function(){o.nextTick(u)};else if(!a||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var d=s.resolve(void 0);i=function(){d.then(u)}}else i=function(){r.call(n,u)};else{var f=!0,c=document.createTextNode("");new a(u).observe(c,{characterData:!0}),i=function(){c.data=f=!f}}return function(n){var r={fn:n,next:void 0};t&&(t.next=r),e||(e=r,i()),t=r}}},function(e,t,i){var n=i(10).navigator;e.exports=n&&n.userAgent||""},function(e,t,i){var n=i(26);e.exports=function(e,t,i){for(var r in t)i&&e[r]?e[r]=t[r]:n(e,r,t[r]);return e}},function(e,t,i){"use strict";var n=i(10),r=i(5),a=i(23),o=i(20),s=i(12)("species");e.exports=function(e){var t="function"==typeof r[e]?r[e]:n[e];o&&t&&!t[s]&&a.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,i){var n=i(12)("iterator"),r=!1;try{var a=[7][n]();a.return=function(){r=!0},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var i=!1;try{var a=[7],o=a[n]();o.next=function(){return{done:i=!0}},a[n]=function(){return o},e(a)}catch(e){}return i}},function(e,t,i){"use strict";var n=i(14),r=i(5),a=i(10),o=i(93),s=i(96);n(n.P+n.R,"Promise",{finally:function(e){var t=o(this,r.Promise||a.Promise),i="function"==typeof e;return this.then(i?function(i){return s(t,e()).then(function(){return i})}:e,i?function(i){return s(t,e()).then(function(){throw i})}:e)}})},function(e,t,i){"use strict";var n=i(14),r=i(67),a=i(95);n(n.S,"Promise",{try:function(e){var t=r.f(this),i=a(e);return(i.e?t.reject:t.resolve)(i.v),t.promise}})},function(e,t,i){var n=i(5),r=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return r.stringify.apply(r,arguments)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(i(2)),r=f(i(0)),a=f(i(1)),o=f(i(3)),s=f(i(4)),l=f(i(8)),u=f(i(168)),d=f(i(7));function f(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"execute",value:function(e){d.default.debug("寮€濮嬫敞鍐� H5ViewMediator"),this.facade.registerMediator(new u.default(u.default.NAME))}}]),t}(l.default.SimpleCommand);c.NAME="h5_mediator_command",t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=g(i(2)),r=g(i(0)),a=g(i(1)),o=g(i(3)),s=g(i(4)),l=g(i(8)),u=i(6),d=g(i(169)),f=g(i(174)),c=g(i(176)),h=g(i(178)),p=g(i(182)),v=g(i(185)),y=g(i(7));function g(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(e){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"onRegister",value:function(){y.default.debug("寮€濮嬫敞鍐� MobileSkinMediator || MobileVideoMediator || MobileAdvMediator"),u.H5Common.isMobile?(this.facade.registerMediator(new d.default(d.default.NAME)),this.facade.registerMediator(new f.default(f.default.NAME)),this.facade.registerMediator(new c.default(c.default.NAME))):(this.facade.registerMediator(new h.default(h.default.NAME)),this.facade.registerMediator(new p.default(p.default.NAME)),this.facade.registerMediator(new v.default(v.default.NAME)))}}]),t}(l.default.Mediator);m.NAME="h5_view_mediator",t.default=m},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=g(i(2)),r=g(i(0)),a=g(i(1)),o=g(i(3)),s=g(i(4)),l=g(i(8)),u=g(i(170)),d=i(19),f=i(16),c=g(i(17)),h=i(18),p=i(13),v=(i(31),i(6)),y=g(i(7));function g(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(e){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"onRegister",value:function(){y.default.debug("娉ㄥ唽MobileSkinComponent"),this.setViewComponent(new u.default),this.viewComponent.addEventListener(d.H5ComponentEvent.START_PLAY,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.CHANGE_PLAY_STATUS,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.SEEK,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.FULLSCREEN,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.SKIN_ERROR,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_BIP,this.onSkinHandler,this),this.viewComponent.init()}},{key:"listNotificationInterests",value:function(){return[f.H5Notification.VIDEO_SHOW_START_PLAY_BTN,f.H5Notification.EXTERNAL_NOTICATION,f.H5Notification.VIDEO_STATE,f.H5Notification.VIDEO_UPDATE,f.H5Notification.VIDEO_WAITING,f.H5Notification.PLAY_FAILED,f.H5Notification.VIDEO_NEXT,f.H5Notification.PLAY_ERROR,f.H5Notification.VIDEO_ERROR,f.H5Notification.VIDEO_HIDE_UI,f.H5Notification.PLAY_SUCCESS,f.ExternalApiType.ADV_DATA_SUCCESS,f.ExternalApiType.ADV_NEXT,f.ExternalApiType.ADV_END,f.ExternalApiType.ADV_ERROR]}},{key:"handleNotification",value:function(e){var t=e.getBody();switch(e.getName()){case f.H5Notification.EXTERNAL_NOTICATION:var i=e.getType();this.externalHandler(i,t);break;case f.H5Notification.VIDEO_UPDATE:this.viewComponent.updateProgress(t);break;case f.H5Notification.VIDEO_STATE:this.viewComponent.togglePlayBtn(t.status);break;case f.H5Notification.VIDEO_SHOW_START_PLAY_BTN:this.viewComponent.showStartBtn();break;case f.H5Notification.VIDEO_WAITING:this.viewComponent.showLoading();break;case f.H5Notification.PLAY_FAILED:case f.H5Notification.PLAY_ERROR:case f.H5Notification.VIDEO_ERROR:this.viewComponent.showError(t);break;case f.H5Notification.VIDEO_NEXT:case f.ExternalApiType.ADV_NEXT:case f.ExternalApiType.ADV_END:this.viewComponent.nextVideo();break;case f.H5Notification.VIDEO_HIDE_UI:this.viewComponent.startbtnHandler();break;case f.H5Notification.PLAY_SUCCESS:this.viewComponent.initUIByResult(!0);break;case f.ExternalApiType.ADV_ERROR:}}},{key:"onSkinHandler",value:function(e){y.default.debug(e);var t=e.data;switch(e.type){case d.H5ComponentEvent.START_PLAY:this.sendNotification(f.H5Notification.SKIN_START_PLAY);break;case d.H5ComponentEvent.CHANGE_PLAY_STATUS:this.sendNotification(f.H5Notification.SKIN_CHANGE_PLAY_STATUS,t);break;case d.H5ComponentEvent.SEEK:this.sendNotification(f.H5Notification.SKIN_SEEK,t);break;case d.H5ComponentEvent.FULLSCREEN:this.sendNotification(f.H5Notification.SKIN_FULLSCREEN,t);break;case d.H5ComponentEvent.VIDEO_BIP:c.default.postMessage(h.ExternalEvent.VIDEO_BIP,t)}}},{key:"externalHandler",value:function(e,t){switch(y.default.debug("澶栭儴璋冪敤鎺ュ彛skin"+e+","+t),e){case f.ExternalApiType.VIDEO_PAUSE:this.viewComponent.playBtnHandler(p.playStatus.PAUSE),v.commonFun.isPlayAdv()&&this.viewComponent.changeBigBtn();break;case f.ExternalApiType.VIDEO_SEEK:this.viewComponent.seekProgress(t.posi);break;case f.ExternalApiType.SKIN_SHOW_ERROR_UI:if(t&&t.params){var i={code:"NOT_RELEASED"==t.params.code?"601":"",msg:t.params.errorMsg||""};i.code&&this.viewComponent.showError(i)}}}},{key:"onRemove",value:function(){this.setViewComponent(null)}}]),t}(l.default.Mediator);m.NAME="mobile_skin_mediator",t.default=m},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=_(i(2)),r=_(i(0)),a=_(i(1)),o=_(i(3)),s=_(i(4)),l=i(32),u=_(i(34)),d=i(13),f=i(19),c=i(6),h=i(172),p=_(i(33)),v=i(27),y=_(i(17)),g=_(i(7)),m=i(18),E=_(i(173));function _(e){return e&&e.__esModule?e:{default:e}}var T=function(e){function t(e){(0,r.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));i.createView(c.H5Common.container),i.container=(0,l.$)(c.H5Common.container).find(".mod-player");var a=i.container;return i.startUI=a.children(".start-wraper"),i.posterUI=i.startUI.children(".player-poster"),i.startLoadingUI=i.startUI.children(".player-loading"),i.startFreeUI=i.startUI.children(".start-free"),i.bigPlayerBtn=i.startFreeUI.children(".player-start-btn"),i.startPayUI=i.startUI.children(".start-pay"),i.startPayPlayBtn=i.startPayUI.find(".shikan-btn"),i.startOpenVipBtn=i.startPayUI.find(".open-vip-btn"),i.tipsUI=a.children(".player-tips"),i.loadingUI=i.tipsUI.children(".player-tips-loading"),i.tipOpenVipBtn=i.tipsUI.children(".tip-open-vip-btn"),i.controlMiniUI=a.children(".control-mini-wrapper"),i.miniProgressLoadUI=i.controlMiniUI.find(".progress-control-load"),i.miniProgressPlayUI=i.controlMiniUI.find(".progress-control-play"),i.controlUI=a.children(".control-wrapper"),i.leftUI=i.controlUI.children(".left-control"),i.playerBtn=i.leftUI.children(".player-btn"),i.rightUI=i.controlUI.children(".right-control"),i.fullScreenBtn=i.rightUI.children(".fullscreen-btn"),i.progressUI=i.controlUI.children(".progress-control"),i.progressListUI=i.progressUI.children(".progress-control-list"),i.progressBtn=i.progressListUI.find(".progress-control-btn"),i.progressLoadUI=i.progressListUI.find(".progress-control-load"),i.progressPlayUI=i.progressListUI.find(".progress-control-play"),i.startTimeUI=i.progressUI.children(".cur-time"),i.endTimeUI=i.progressUI.children(".end-time"),i.liveProgressUI=i.controlUI.children(".live-progress-control"),i.liveTimeUI=i.liveProgressUI.children(".live-time"),i.endUI=a.children(".end-wrapper"),i.errorUI=i.endUI.children(".error-wrapper"),i.errorCodeUI=i.errorUI.children(".error-id"),i.recoUI=i.endUI.children(".reco-wrapper"),i.playBtnStatus=d.playStatus.PLAYING,i.hideInter=-1,i}return(0,s.default)(t,e),(0,a.default)(t,[{key:"init",value:function(){this.bindAction();var e=d.playerInfo.poster;e&&this.posterUI.children("img").attr("src",e),g.default.debug("imgSrc="+e),this.posterUI.show(),this.startLoadingUI.show(),this.startFreeUI.hide(),this.startPayUI.hide(),this.tipsUI.hide(),this.tipOpenVipBtn.hide(),this.controlVisible(!1),this.controlMiniUI.css("visibility","hidden"),this.endUI.hide(),this.startOpenVipBtn.show(),d.playerInfo.playType==d.playType.LIVE?(this.liveProgressUI.show(),this.progressUI.hide()):(this.progressUI.show(),this.liveProgressUI.hide());var t=c.H5Common.skinCfg;t&&(0==t.fullScreenBtn&&(this.fullScreenBtn.hide(),this.progressUI.addClass("width-more"),this.progressListUI.addClass("width-more")),!1===t.rightVipTip&&this.tipOpenVipBtn.css("visibility","hidden")),c.H5Common.startBtnVipTip&&c.H5Common.startBtnVipTip.text&&(!1===c.H5Common.startBtnVipTip.show?this.startOpenVipBtn.hide():this.startOpenVipBtn.find("span").html(c.H5Common.startBtnVipTip.text)),c.H5Common.startBtnTip&&this.startPayPlayBtn.find("span").html(c.H5Common.startBtnTip),c.H5Common.startTip&&this.startPayUI.find(".pay-inner .text").html(c.H5Common.startTip)}},{key:"createView",value:function(e){(0,l.$)(e).append('<section class="mod-player"></section>'),this.container=(0,l.$)(e).find(".mod-player"),this.container.append(h.startHtml),this.container.append(h.controlHtml),this.container.append(h.controlMiniHtml),this.container.append(h.tipsHtml),this.container.append(h.videoHtml),this.container.append(h.endHtml)}},{key:"bindAction",value:function(){var e=this;this.container.on("click",function(t){return e.showControl(t)}),this.bigPlayerBtn.on("click",function(t){return e.startbtnHandler(t)}),this.startPayPlayBtn.on("click",function(t){return e.startbtnHandler(t)}),this.startOpenVipBtn.on("click",function(t){y.default.postMessage(m.ExternalEvent.VIDEO_BUY_VIP),c.H5Common.startBtnVipTip&&c.H5Common.startBtnVipTip.link?e.openVip(t,c.H5Common.startBtnVipTip.link):e.openVip(t)}),this.playerBtn.on("click",function(t){return e.playBtnHandler()}),this.progressUI.on("click",".progress-control-list",function(t){return e.progressClickHandler(t)}),this.progressBtn.on("touchstart",function(t){return e.progressDragHandler(t)}),this.progressBtn.on("touchmove",function(t){return e.progressDragHandler(t)}),this.progressBtn.on("touchend",function(t){return e.progressDragHandler(t)}),this.rightUI.on("click",".fullscreen-btn",function(t){return e.fullBtnHandler(t)}),this.errorUI.on("click",".btns",function(t){return e.errorBtnHandler(t)}),this.tipOpenVipBtn.on("click",function(t){return e.openVip(t)}),this.controlUI.on("webkitAnimationStart animationstart webkitAnimationEnd animationend",function(t){return e.onFadeHandler(t)})}},{key:"showStartBtn",value:function(){this.startLoadingUI.hide(),c.H5Common.pay&&!v.userInfo.isVip?this.startPayUI.show():(this.startFreeUI.show(),this.tipOpenVipBtn.hide())}},{key:"showLoading",value:function(){d.playerInfo.start&&(!("none"==this.tipsUI.css("display"))||this.tipsUI.show(),this.loadingUI.show())}},{key:"startbtnHandler",value:function(e){if(e&&e.stopPropagation(),d.playerInfo.start)this.hideInter=-1,this.showControl(),this.startFreeUI.hide(),this.bigPlayerBtn.hide(),this.dispatchEvent(f.H5ComponentEvent.CHANGE_PLAY_STATUS,{status:d.playStatus.PLAYING});else{this.posterUI.hide(),c.H5Common.pay?this.startPayUI.hide():(this.startFreeUI.hide(),this.bigPlayerBtn.hide()),this.endUI.hide(),this.startLoadingUI.show(),this.dispatchEvent(f.H5ComponentEvent.START_PLAY);var t={dt:"act",data:{type:"startBtn",cid:d.playerInfo.cid}};this.sendBip(t)}}},{key:"hideUI",value:function(){this.startUI.show(),this.posterUI.hide(),this.startPayUI.hide(),this.startFreeUI.hide(),this.bigPlayerBtn.hide(),this.tipsUI.hide(),this.controlVisible(!1),this.endUI.hide()}},{key:"playBtnHandler",value:function(e){g.default.debug("<<<<鍒囨崲鎾斁鐘舵€�<<<<"+e),this.togglePlayBtn(e),console.log(this.playBtnStatus,"this.playBtnStatus"),this.dispatchEvent(f.H5ComponentEvent.CHANGE_PLAY_STATUS,{status:this.playBtnStatus})}},{key:"togglePlayBtn",value:function(e){if(e!=d.playStatus.END){var t=this.playerBtn,i=t.find(".btn-play"),n=t.find(".btn-pause");if(this.loadingUI.hide(),e){if(this.playBtnStatus=e,e==d.playStatus.PAUSE&&i.length)return;if(e==d.playStatus.PLAYING&&n.length)return}else this.playBtnStatus=i.length?d.playStatus.PLAYING:d.playStatus.PAUSE;var r=t.find("i");g.default.debug("this.togglePlayBtn="+this.playBtnStatus),this.playBtnStatus==d.playStatus.PAUSE?r.removeClass("btn-pause").addClass("btn-play"):this.playBtnStatus==d.playStatus.PLAYING&&r.removeClass("btn-play").addClass("btn-pause"),this.changeBigBtn()}else this.showEnd()}},{key:"changeBigBtn",value:function(){this.playBtnStatus==d.playStatus.PLAYING?(this.startLoadingUI.hide(),this.posterUI.hide(),this.startFreeUI.hide(),this.bigPlayerBtn.hide(),c.H5Common.pay&&!v.userInfo.isVip&&(this.tipsUI.show(),this.tipOpenVipBtn.show())):(this.startUI.show(),this.startFreeUI.show(),this.bigPlayerBtn.show())}},{key:"progressClickHandler",value:function(e){e&&e.stopPropagation();var t=e.offsetX;this.progressBtn.css("left",t),this.seekTime(t)}},{key:"seekTime",value:function(e){console.log(e);var t=this.progressListUI.width(),i=d.playerInfo.duration,n=e/t,r=Math.floor(i*n);this.dispatchEvent(f.H5ComponentEvent.SEEK,{time:r})}},{key:"seekProgress",value:function(e){var t=this.progressListUI.width(),i=e/d.playerInfo.duration*t;this.seekTime(i)}},{key:"progressDragHandler",value:function(e){e&&e.stopPropagation();var t=this.progressBtn.position().left,i=this.progressListUI.width();"touchstart"==e.type||("touchmove"==e.type?((t=e.touches[0].clientX-this.progressListUI.offset().left)>i?t=i:t<0&&(t=0),this.progressBtn.css("left",t)):"touchend"==e.type&&(t>i?t=i:t<0&&(t=0),this.seekTime(t)))}},{key:"fullBtnHandler",value:function(e){this.dispatchEvent(f.H5ComponentEvent.FULLSCREEN,!0)}},{key:"errorBtnHandler",value:function(e){e&&e.stopPropagation();var t=(0,l.$)(e.currentTarget),i=t.children(".refresh-btn"),n=t.children(".open-vip-btn"),r=t.children(".open-app"),a=t.children(".other-btn"),o=t.children(".login");i.length>0&&window.location.reload(),n.length>0&&this.openVip(),r.length>0&&this.openApp(),a.length>0&&this.openMzhan(),o.length>0&&y.default.postMessage(m.ExternalEvent.VIDEO_LOGIN)}},{key:"updateProgress",value:function(e){if(this.startLoadingUI.hide(),this.loadingUI.hide(),!c.commonFun.isPlayAdv()&&d.playerInfo.status!=d.playStatus.END)if(d.playerInfo.playType==d.playType.VOD||d.playerInfo.playType==d.playType.HUIKAN){var t=p.default.formatDate(new Date(Math.floor(1e3*e.start)),"mm:ss"),i=p.default.formatDate(new Date(Math.floor(1e3*e.end)),"mm:ss"),n=e.posi,r=p.default.formatDate(new Date(Math.floor(1e3*n)),"mm:ss");!this.initProgress&&e.posi>0?(this.initProgress=!0,this.startTimeUI.text(t),this.endTimeUI.text(i),c.H5Common.pay&&!v.userInfo.isVip&&this.tipOpenVipBtn.show(),this.showControl()):(this.startTimeUI.text(r),this.endTimeUI.text(i));var a=100*e.posi/(e.end-e.start);this.progressPlayUI.css("width",a+"%"),this.miniProgressPlayUI.css("width",a+"%");var o=this.progressListUI.width()*a/100;if(this.progressBtn.css("left",o),e.buffered>0){var s=100*e.buffered/(e.end-e.start);this.progressLoadUI.css("width",s+"%"),this.miniProgressLoadUI.css("width",s+"%")}}else if(d.playerInfo.playType==d.playType.LIVE){var l=p.default.formatDate(new Date(Math.floor(e.live)),"hh:mm:ss");this.initProgress||(this.initProgress=!0,this.showControl()),this.liveTimeUI.text(l)}}},{key:"showControl",value:function(e){this.initProgress&&d.playerInfo.status!=d.playStatus.END&&"none"==this.endUI.css("display")&&("0px"==this.controlUI.css("bottom")?this.hideInter<0&&this.showControlAnimation():(this.controlVisible(!0),this.showControlAnimation()))}},{key:"controlVisible",value:function(e){var t="0px"==this.controlUI.css("bottom"),i="none"!=this.tipOpenVipBtn.css("display");e?t||(this.controlUI.removeClass("fadehide").addClass("fadeshow"),i&&this.tipOpenVipBtn.removeClass("vip-movedown").addClass("vip-moveup")):t&&(this.controlUI.removeClass("fadeshow").addClass("fadehide"),i&&this.tipOpenVipBtn.removeClass("vip-moveup").addClass("vip-movedown"))}},{key:"showControlAnimation",value:function(){var e=this;this.hideInter=setTimeout(function(){e.hideInter=-1,e.playBtnStatus!==d.playStatus.PAUSE&&e.controlVisible(!1)},5e3)}},{key:"openApp",value:function(){try{var e=d.playerInfo.playType==d.playType.VOD?{cId:d.playerInfo.cid}:{contId:d.playerInfo.cid};window.MGBridge&&window.MGBridge.pwInit&&window.MGBridge.pwInit(e),window.MGBridge.pwSDK&&E.default.copy(window.MGBridge.pwSDK.getClipboardJSON(window.MGBridge.schemaLink))}catch(e){g.default.debug("<<<<鍚姩app鍑洪敊")}}},{key:"openVip",value:function(e,t){e&&e.stopPropagation();var i=t||"//m.miguvideo.com/mgs/msite/prd/memberCenter.html";window.open(i,"_top"),this.sendBip({dt:"act",data:{type:"openVip"}})}},{key:"openMzhan",value:function(){window.open("//www.miguvideo.com/mgs/website/prd/index.html","_top")}},{key:"onFadeHandler",value:function(e){if(this.initProgress&&d.playerInfo.playType!=d.playType.LIVE&&!c.commonFun.isPlayAdv()){var t="0px"==this.controlUI.css("bottom"),i=e.type;"fadeout"!=e.animationName||"animationend"!=i&&"webkitAnimationEnd"!=i?"fadein"!=e.animationName||"animationstart"!=i&&"webkitAnimationStart"!=i||t||this.controlMiniUI.css("visibility","hidden"):t||this.controlMiniUI.css("visibility","visible")}}},{key:"initUIByResult",value:function(e){e&&(d.playerInfo.playType==d.playType.LIVE?(this.liveProgressUI.show(),this.progressUI.hide()):(this.progressUI.show(),this.liveProgressUI.hide()))}},{key:"nextVideo",value:function(){d.playerInfo.start||(this.startLoadingUI.show(),this.bigPlayerBtn.hide(),this.startFreeUI.hide(),this.endUI.hide(),this.posterUI.hide(),this.initProgress=!1)}},{key:"showEnd",value:function(){this.startUI.hide(),this.tipsUI.hide(),this.controlVisible(!1),this.recoUI.hide(),this.startUI.show(),this.posterUI.show(),this.bigPlayerBtn.show(),this.initProgress=!1,this.controlMiniUI.css("visibility","hidden")}},{key:"showError",value:function(e){var t=0,i="";if(e){if(t=parseInt(e.code),d.playerInfo.errorObj.cid==d.playerInfo.cid&&601==d.playerInfo.errorObj.errorID)return;d.playerInfo.errorObj={cid:d.playerInfo.cid,errorID:t},i=e.msg||""}var n="refresh-btn",r=i||"鑺傜洰鍑洪敊浜唦",a="鍒锋柊鑺傜洰",o=null,s=!0;switch(t){case 401:window.mgUserInfo?(n="login",r="褰撳墠鎾斁鍐呭璇风櫥褰曞悗鍐嶈鐪�",a="绔嬪嵆鐧诲綍",s=!1):(n="open-app",r="鍥犵増鏉冮檺鍒讹紝璇峰墠寰€APP瑙傜湅瀹屾暣鍐呭",a="鍓嶅線鍜挄瑙嗛",s=!1);break;case 411:case 501:n="open-app",r="鍥犵増鏉冮檺鍒讹紝璇峰墠寰€APP瑙傜湅瀹屾暣鍐呭",a="鍓嶅線鍜挄瑙嗛",s=!1;break;case 409:n="open-vip-btn",r="璇ュ唴瀹逛负浠樿垂鍐呭锛岃寮€閫氫細鍛樿鐪�",a="寮€閫氫細鍛�",o="vip-icon",s=!1;break;case 400:case 410:n="other-btn",r="鐪熸姳姝夛紝鎮ㄨ鎵剧殑鑺傜洰濂藉儚澶辫釜浜�",a="鐪嬬湅鍏朵粬鑺傜洰";break;case 404:n="open-app",r="鐪熸姳姝夛紝鎮ㄨ鎵剧殑鑺傜洰濂藉儚澶辫釜浜嗭紝鍓嶅線APP瑙傜湅鍚�",a="鍓嶅線鍜挄瑙嗛",s=!1;break;case 412:n="open-vip-btn",r=d.playerInfo.playType==d.playType.VOD?"璇曠湅宸茬粡缁撴潫浜嗗摝锛屽紑閫氫細鍛樿鐪嬪畬鏁村唴瀹�":"寮€閫氫細鍛樿鐪嬪畬鏁村唴瀹�",a="浠樿垂鐪嬪畬鏁寸増",o="vip-icon",s=!1;break;case 2e3:n="refresh-btn",r="鐪熷按灏紝濂藉儚鍑轰簡鐐归棶棰橈紝鍒锋柊鍚庡啀璇曡瘯鐪嬪摝锝�",a="绔嬪嵆鍒锋柊";break;case 2001:n="open-app",r="褰撳墠鍐呭闇€瑕佺敤鍒告挱鏀撅紝璇峰墠寰€APP瑙傜湅瀹屾暣鍐呭",a="鍓嶅線鍜挄瑙嗛",s=!1;break;case 601:n="open-app",a="鐪嬬湅鍏朵粬鑺傜洰",s=!1}this.setErrorUI({id:t,className:n,des:r,btnText:a,iconClass:o,showErrorID:s}),y.default.postMessage(m.ExternalEvent.VIDEO_ERROR,e)}},{key:"setErrorUI",value:function(e){if(e.id){this.startUI.hide(),this.tipsUI.hide(),this.controlVisible(!1),this.endUI.show(),this.recoUI.hide();var t=e.id,i=e.className,n=e.des,r=e.btnText,a=e.iconClass,o=this.errorUI.find(".text"),s=this.errorUI.find(".btns").children("div");o.text(n),s.removeClass().addClass(i),a&&s.find("i").removeClass().addClass("vip-icon"),s.children("span").text(r),e.showErrorID?(this.errorCodeUI.show(),this.errorCodeUI.children("span").text(t)):this.errorCodeUI.hide()}}},{key:"sendBip",value:function(e){this.dispatchEvent(f.H5ComponentEvent.VIDEO_BIP,e)}}]),t}(u.default);t.default=T},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Events=void 0;var n=s(i(35)),r=s(i(43)),a=s(i(0)),o=s(i(1));function s(e){return e&&e.__esModule?e:{default:e}}(t.Events=function(){function e(){(0,a.default)(this,e),this.initEvent()}return(0,o.default)(e,[{key:"on",value:function(t,i,n){return e.eventsApi(this,"on",t,[i,n])&&i?(this._events||(this._events={}),(this._events[t]||(this._events[t]=[])).push({callback:i,context:n,ctx:n||this}),this):this}},{key:"once",value:function(t,i,n){if(!e.eventsApi(this,"once",t,[i,n])||!i)return this;var r=this,a=undercore_once(function(){r.off(t,a),i.apply(this,arguments)});return a._callback=i,this.on(t,a,n)}},{key:"off",value:function(t,i,n){var a,o,s,l,u,d,f,c;if(!this._events||!e.eventsApi(this,"off",t,[i,n]))return this;if(!t&&!i&&!n)return this._events={},this;for(u=0,d=(l=t?[t]:(0,r.default)(this._events)).length;u<d;u++)if(t=l[u],s=this._events[t]){if(this._events[t]=a=[],i||n)for(f=0,c=s.length;f<c;f++)o=s[f],(i&&i!==o.callback&&i!==o.callback._callback||n&&n!==o.context)&&a.push(o);a.length||delete this._events[t]}return this}},{key:"trigger",value:function(t){if(!this._events)return this;var i={type:t,data:arguments.length<=1?void 0:arguments[1]};if(!e.eventsApi(this,"trigger",t,i))return this;var n=this._events[t],r=this._events.all;return n&&e.triggerEvents(n,i),r&&e.triggerEvents(r,i),this}},{key:"stopListening",value:function(t,i,r){var a=this._listeningTo;if(!a)return this;var o=!i&&!r;for(var s in r||"object"!==(void 0===i?"undefined":(0,n.default)(i))||(r=this),t&&((a={})[t._listenId]=t),a)(t=a[s]).off(i,r,this),(o||e.isEmpty(t._events))&&delete this._listeningTo[s];return this}},{key:"undercore_once",value:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];var r,a=!1;return function(){return a?r:(a=!0,r=e.apply(this,i),e=null,r)}}},{key:"isEmpty",value:function(e){if(null==e)return!0;if(Array.isArray(e)||this.isString(e))return 0===e.length;for(var t in e)if(this.hasKey(e,t))return!1;return!0}},{key:"hasKey",value:function(e){return null!=e&&Object.prototype.hasOwnProperty.call(e,key)}},{key:"isString",value:function(e){return"string"==typeof e}},{key:"initEvent",value:function(){var t={listenTo:"on",listenToOnce:"once"},i=function(i){var r=t[i];e[i]=function(t,i,a){return(this._listeningTo||(this._listeningTo={}))[t._listenId||(t._listenId=e.ID++)]=t,a||"object"!==(void 0===i?"undefined":(0,n.default)(i))||(a=this),t[r](i,a,this),this}};for(var r in t)i(r)}}],[{key:"eventsApi",value:function(e,t,i,r){var a=/\s+/;if(!i)return!0;if("object"===(void 0===i?"undefined":(0,n.default)(i))){for(var o in i)e[t].apply(e,[o,i[o]].concat(r));return!1}if(a.test(i)){for(var s=i.split(a),l=0,u=s.length;l<u;l++)e[t].apply(e,[s[l]].concat(r));return!1}return!0}},{key:"triggerEvents",value:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];var r,a=-1,o=e.length,s=i[0],l=i[1],u=i[2];switch(i.length){case 0:for(;++a<o;)(r=e[a]).callback.call(r.ctx);return;case 1:for(;++a<o;)(r=e[a]).callback.call(r.ctx,s);return;case 2:for(;++a<o;)(r=e[a]).callback.call(r.ctx,s,l);return;case 3:for(;++a<o;)(r=e[a]).callback.call(r.ctx,s,l,u);return;default:for(;++a<o;)(r=e[a]).callback.apply(r.ctx,i)}}}]),e}()).ID=0},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.startHtml='<div class="start-wraper"><div class="start-free"><div class="player-start-btn"><div class="btn-bg"><div class="start-btn"></div></div></div></div><div class="start-pay"><div class="pay-inner"><div class="text">浼氬憳涓撲韩鍐呭,寮€閫氫細鍛樺厤璐硅鐪嬪摝~</div><div class="btns"><div class="shikan-btn"><i class="play-icon"></i><span>璇曠湅6鍒嗛挓</span></div><div class="open-vip-btn"><i class="vip-icon"></i><span>寮€閫氫細鍛�</span></div></div></div></div><div class="player-loading"><i class="start-loading"></i><div class="text">鍏ㄥ姏鍔犺浇涓�</div></div><div class="player-poster"><img></div></div>',t.videoHtml='<div class="video-wrapper"><video id="m-player" class="m-player" x5-playsinline="" playsinline="" webkit-playsinline="" x-webkit-airplay="allow" preload="true">鎮ㄧ殑娴忚鍣ㄤ笉鏀寔HTML5锛屾棤娉曡鐪嬫垜浠彁渚涚殑瑙嗛锛佸缓璁娇鐢ㄩ珮鐗堟湰娴忚鍣ㄨ鐪嬶紝璋㈣阿锛�</video></div>',t.controlHtml='<div class="control-wrapper"><div class="left-control"><div class="player-btn"><i class="player-bg btn-play"></i></div></div><div class="right-control"><div class="fullscreen-btn"><i class="btn-bg"></i></div></div><div class="progress-control"><div class="cur-time">00:00</div><div class="progress-control-list"><div class="progress-control-load"></div><div class="progress-control-play"></div><div class="progress-control-btn"></div></div><div class="end-time">11:00</div></div><div class="live-progress-control"><div class="icon">鐩存挱</div><div class="live-time">11:00</div></div></div>',t.tipsHtml='<div class="player-tips"><div class="player-tips-loading"><div class="loading"><i class="icon"></i></div></div><div class="tip-open-vip-btn"><i class="vip-icon"></i><span>寮€閫氫細鍛�</span></div></div>',t.endHtml='<div class="end-wrapper"><div class="error-wrapper"><div class="error-content"><div class="text">鐪熷按灏紝濂藉儚鍑轰簡鐐归棶棰橈紝鍒锋柊璇曡瘯鐪媬</div><div class="btns openClient"><div class="refresh-btn"><i class="vip-icon"></i><span class="">绔嬪嵆鍒锋柊</span></div></div></div><div class="error-id">鎻愮ず:<span>1032</span></div></div><div class="reco-wrapper"><div class="reco-list"><div class="reco-item"><img src><span></span></div><div class="reco-item"><img src><span></span></div></div></div></div> ',t.controlMiniHtml='<div class="control-mini-wrapper"><div class="progress-control-load"></div><div class="progress-control-play"></div></div> '},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,i){var n;function r(){var r,a;i.userAgent.match(/ipad|iphone/i)?((r=t.createRange()).selectNodeContents(n),(a=e.getSelection()).removeAllRanges(),a.addRange(r),n.setSelectionRange(0,999999)):n.select()}return{copy:function(i){!function(i){(n=t.createElement("textArea")).value=i,n.style.position="absolute",n.style.fontSize="12pt",n.style.border="0",n.style.padding="0",n.style.margin="0",n.style.position="absolute",n.style.left="-9999px";var r=e.pageYOffset||t.documentElement.scrollTop;n.style.top=r+"px",n.setAttribute("readonly",""),t.body.appendChild(n)}(i),r(),function(){try{t.execCommand("Copy")}catch(e){}t.body.removeChild(n)}()}}}(window,document,navigator);t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=E(i(2)),r=E(i(0)),a=E(i(1)),o=E(i(3)),s=E(i(4)),l=E(i(8)),u=E(i(175)),d=i(19),f=i(16),c=E(i(65)),h=E(i(17)),p=i(18),v=E(i(7)),y=i(13),g=i(6),m=i(31);function E(e){return e&&e.__esModule?e:{default:e}}var _=function(e){function t(e){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"onRegister",value:function(){v.default.debug("娉ㄥ唽 MobileVideoComponent"),this.setViewComponent(new u.default),this.viewComponent.addEventListener(d.H5ComponentEvent.WEB_PLAY,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_UPDATE,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_STATE,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_WAITING,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.PLAY_ERROR,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_ERROR,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.HIDE_UI,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_BIP,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.HLS_READY,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_READY,this.onVideoHandler,this),this.viewComponent.init()}},{key:"handleEvent",value:function(e,t){this.viewComponent}},{key:"listNotificationInterests",value:function(){return[f.H5Notification.PLAY_SUCCESS,f.H5Notification.SKIN_START_PLAY,f.H5Notification.EXTERNAL_NOTICATION,f.H5Notification.SKIN_CHANGE_PLAY_STATUS,f.H5Notification.SKIN_SEEK,f.H5Notification.SKIN_FULLSCREEN,f.ExternalApiType.ADV_DATA_SUCCESS,f.ExternalApiType.ADV_NEXT,f.ExternalApiType.ADV_END,f.ExternalApiType.ADV_ERROR]}},{key:"handleNotification",value:function(e){var t=e.getBody();switch(v.default.debug("<<<<"+e.getName()+",<<<<<"+t),e.getName()){case f.H5Notification.PLAY_SUCCESS:this.viewComponent.setPlayData(t),h.default.postMessage(p.ExternalEvent.VIDEO_STATUS,p.playerStatusType.VIDEO_READY);break;case f.H5Notification.SKIN_START_PLAY:y.playerInfo.next=!0,this.viewComponent.playVideo();break;case f.H5Notification.EXTERNAL_NOTICATION:var i=e.getType();this.externalHandler(i,t);break;case f.H5Notification.SKIN_CHANGE_PLAY_STATUS:this.viewComponent.changePlayStatus(t.status);break;case f.H5Notification.SKIN_SEEK:console.log(t.time,"data.time"),this.viewComponent.seekVideo(t.time);break;case f.H5Notification.SKIN_FULLSCREEN:this.viewComponent.fullscreen({type:"webkitbeginfullscreen"});break;case f.ExternalApiType.ADV_DATA_SUCCESS:this.viewComponent.setVideoAdvData(),y.playerInfo.next?(this.viewComponent.playVideo(),this.sendNotification(f.H5Notification.VIDEO_NEXT)):this.sendNotification(f.H5Notification.VIDEO_SHOW_START_PLAY_BTN);break;case f.ExternalApiType.ADV_NEXT:this.viewComponent.setVideoAdvData()||(m.advertInfo.status=m.advertStatus.OVER,this.viewComponent.setPlayData(g.H5Common.playData.urlInfo));break;case f.ExternalApiType.ADV_END:case f.ExternalApiType.ADV_ERROR:m.advertInfo.data=null,m.advertInfo.urls=null,m.advertInfo.status=m.advertStatus.NONE,this.viewComponent.setPlayData(g.H5Common.playData.urlInfo)}}},{key:"onVideoHandler",value:function(e){var t=e.data;switch(e.type){case d.H5ComponentEvent.WEB_PLAY:this.facade.retrieveProxy(c.default.NAME).loadData();break;case d.H5ComponentEvent.VIDEO_UPDATE:this.sendNotification(f.H5Notification.VIDEO_UPDATE,t);break;case d.H5ComponentEvent.VIDEO_STATE:this.sendNotification(f.H5Notification.VIDEO_STATE,t);break;case d.H5ComponentEvent.VIDEO_WAITING:this.sendNotification(f.H5Notification.VIDEO_WAITING,t);break;case d.H5ComponentEvent.PLAY_ERROR:this.sendNotification(f.H5Notification.PLAY_ERROR,t);break;case d.H5ComponentEvent.VIDEO_ERROR:this.sendNotification(f.H5Notification.VIDEO_ERROR,t);break;case d.H5ComponentEvent.HIDE_UI:this.sendNotification(f.H5Notification.VIDEO_HIDE_UI,t);break;case d.H5ComponentEvent.VIDEO_BIP:h.default.postMessage(p.ExternalEvent.VIDEO_BIP,t);break;case d.H5ComponentEvent.HLS_READY:case d.H5ComponentEvent.VIDEO_READY:y.playerInfo.next||y.playerInfo.autoplay?(this.viewComponent.playVideo(),this.sendNotification(f.H5Notification.VIDEO_NEXT)):this.sendNotification(f.H5Notification.VIDEO_SHOW_START_PLAY_BTN)}}},{key:"externalHandler",value:function(e,t){switch(v.default.debug("澶栭儴璋冪敤鎺ュ彛video"+e+","+t),e){case f.ExternalApiType.VIDEO_VOLUME:this.viewComponent.volume=t.volume||.5;break;case f.ExternalApiType.VIDEO_SWITCH:this.viewComponent.switchVideo(t.rateType);break;case f.ExternalApiType.VIDEO_FULLSCREEN:this.viewComponent.appleFullScreen();break;case f.ExternalApiType.VIDEO_PLAY:this.viewComponent.playVideo(t.id,t.ext);break;case f.ExternalApiType.VIDEO_STOP:this.viewComponent.stopVideo();break;case f.ExternalApiType.VIDEO_SHIELD_STATUS:t.shieldStatus&&(this.viewComponent.stopVideo(),this.sendNotification(f.H5Notification.VIDEO_ERROR,{code:"1001",msg:"鐢变簬鐗堟潈鍘熷洜锛屾殏鏃舵棤娉曡鐪嬶紒"}));break;case f.ExternalApiType.VIDEO_AUTO_PLAY:this.viewComponent.setAutoPlay(t.autoPlay)}}},{key:"onRemove",value:function(){this.setViewComponent(null)}}]),t}(l.default.Mediator);_.NAME="mobile_video_mediator",t.default=_},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=_(i(2)),r=_(i(0)),a=_(i(1)),o=_(i(3)),s=_(i(4)),l=_(i(34)),u=i(19),d=i(6),f=i(32),c=i(13),h=i(27),p=_(i(7)),v=_(i(33)),y=_(i(17)),g=i(18),m=i(69),E=i(31);function _(e){return e&&e.__esModule?e:{default:e}}var T=/android/i.test(navigator.userAgent.toLocaleLowerCase()),S=function(e){function t(e){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"init",value:function(){this.player=(0,f.$)(d.H5Common.container).find(".m-player"),this.modPlayer=(0,f.$)(d.H5Common.container).find(".mod-player"),d.H5Common.isMobile&&(c.playerInfo.autoplay=!1),this.initError=!1,this.player.length||(p.default.debug("video鏍囩涓嶅瓨鍦�"),this.initError=!0),this.scale=160/90,this.initError||(d.H5Common.useTicket?this.dispatchEvent(u.H5ComponentEvent.PLAY_ERROR,{code:d.H5Common.callCode.play[1]}):c.playerInfo.cid&&this.dispatchEvent(u.H5ComponentEvent.WEB_PLAY),this.video=this.player[0],this.video.removeAttribute("controls"),window.General&&window.General.isInlinePlay()?(p.default.debug("鍘婚櫎鍐呰仈鎾斁鐨勫睘鎬�"),this.video.removeAttribute("webkit-playsinline"),this.video.removeAttribute("playsinline"),this.video.removeAttribute("x5-playsinline"),this.video.removeAttribute("x-webkit-airplay")):p.default.debug("鍐呰仈鎾斁鐨勫睘鎬ф湭鍘婚櫎,"+!!window.General),this.videoWH={ow:d.H5Common.ow,oh:Math.round(9*d.H5Common.ow/16)},this.resize(),this.initObserver(),this.preWatchTime=0)}},{key:"setPlayData",value:function(e){if(e&&e.url){this.showPay=!1,this.playData=e,this.canplay=!1,this.watchTime=0,this.watchInter=-1,(0,f.$)(this.video).show(),this.video.pause(),this.video.src=c.playerInfo.url=e.url,c.playerInfo.rateType=e.rateType,c.playerInfo.status=c.playStatus.PAUSE,p.default.debug("鑾峰彇鎾斁鍦板潃this.video.src=",e.url);var t=this;if(c.playerInfo.url.indexOf(".m3u8")>0&&window.location.href.indexOf("fangdao")>-1&&window.Hls)if(Hls.isSupported()){var i="debug"===v.default.getQueryString("player"),n=new Hls({debug:i});window.location.href.indexOf("fangdao")>-1&&(c.playerInfo.url="http://testvod.migucloud.com/live/zjrtest0508/index.m3u8"),n.loadSource(c.playerInfo.url),n.attachMedia(this.video),n.on(Hls.Events.MANIFEST_PARSED,function(){t.dispatchEvent(u.H5ComponentEvent.HLS_READY)})}else this.dispatchEvent(u.H5ComponentEvent.VIDEO_ERROR,{code:3005,msg:"涓嬭浇app瑙傜湅"});else this.dispatchEvent(u.H5ComponentEvent.VIDEO_READY)}else p.default.debug("鑾峰彇鎾斁鍦板潃涓虹┖")}},{key:"setVideoAdvData",value:function(){if(this.video.pause(),d.commonFun.isPlayAdv()){if(!E.advertInfo.urls||!E.advertInfo.urls.length)return E.advertInfo.data=null,E.advertInfo.urls=null,E.advertInfo.status=E.advertStatus.NONE,!1;var e=E.advertInfo.urls.shift();if(e)return this.video.src=e,c.playerInfo.status==c.playStatus.PLAYING&&this.video.play(),p.default.debug("鑾峰彇骞垮憡鐨勬挱鏀惧湴鍧€ this.video.src=",e),!0}return!1}},{key:"initPlayerInfo",value:function(){c.playerInfo.posi=0,c.playerInfo.buffered=0,c.playerInfo.start=!1,c.playerInfo.end=!1}},{key:"playVideo",value:function(e,t){e?(this.video.pause(),this.initPlayerInfo(),c.playerInfo.cid=e,t&&t.shieldStatus?c.playerInfo.shieldStatus=t.shieldStatus:c.playerInfo.shieldStatus=0,(0,m.createClientID)(),this.dispatchEvent(u.H5ComponentEvent.WEB_PLAY)):c.playerInfo.status==c.playStatus.PAUSE?this.video.play():c.playerInfo.status==c.playStatus.END&&((0,m.createClientID)(),this.video.currentTime=0,this.showPay=!1,this.video.play())}},{key:"setAutoPlay",value:function(){c.playerInfo.autoplay=!0,this.video.src="",this.video.play()}},{key:"stopVideo",value:function(){console.log("杩涘叆stop"),this.video.pause(),c.playerInfo.status=c.playStatus.END,c.playerInfo.end=!0,c.playerInfo.posi=0,c.playerInfo.buffered=0,this.preWatchTime=0,c.playerInfo.start=!1,this.watchTime=0,this.watchInter>-1&&(window.clearInterval(this.watchInter),this.watchInter=-1),this.dispatchEvent(u.H5ComponentEvent.VIDEO_STATE,{status:c.playerInfo.status})}},{key:"changePlayStatus",value:function(e){e==c.playStatus.PAUSE?this.video.pause():this.video.play()}},{key:"switchVideo",value:function(e){p.default.debug("褰撳墠鐮佹祦<<<"+c.playerInfo.rateType+",闇€鍒囨崲鐨勭爜娴�<<"+e);var t=d.H5Common.playData.urlInfos[e];if(e!=c.playerInfo.rateType){var i=0;c.playerInfo.status!=c.playStatus.END&&(i=this.video.currentTime),t?(this.stopVideo(),(0,m.createClientID)(),this.setPlayData(t),this.preWatchTime=i,this.playVideo(),this.dispatchEvent(u.H5ComponentEvent.HIDE_UI)):p.default.debug("<<<<<<闇€鍒囨崲鐨勭爜娴佹棤瀵瑰簲鐨勫湴鍧€淇℃伅")}else c.playerInfo.status==c.playStatus.END&&((0,m.createClientID)(),this.playVideo(),this.dispatchEvent(u.H5ComponentEvent.HIDE_UI))}},{key:"resize",value:function(){this.scale=this.videoWH.oh/this.videoWH.ow}},{key:"initObserver",value:function(){var e=this;this.player.on("loadstart",function(t){d.commonFun.isPlayAdv()||e.loadStart(t)}),this.player.on("loadedmetadata loadeddata durationchange",function(t){d.commonFun.isPlayAdv()||e.loadData(t)}),this.player.on("canplaythrough",function(t){d.commonFun.isPlayAdv()||e.canplaythrough(t)}),this.player.on("seeking waiting  stalled",function(t){d.commonFun.isPlayAdv()||e.waiting(t)}),this.player.on("timeupdate",v.default.throttle(function(t){e.timeupdate(t)},1e3)),this.player.on("ended",function(t){d.commonFun.isPlayAdv()||e.ended(t)}),this.player.on("pause",function(t){c.playerInfo.status=c.playStatus.PAUSE,d.commonFun.isPlayAdv()||e.pause(t)}),this.player.on("stop",function(t){d.commonFun.isPlayAdv()||e.stopVideo(t)}),this.player.on("playing",function(t){c.playerInfo.status=c.playStatus.PLAYING,d.commonFun.isPlayAdv()||e.playing(t)}),this.player.on("abort error",function(t){d.commonFun.isPlayAdv()||e.error(t)}),this.player.on("webkitbeginfullscreen webkitendfullscreen",function(t){d.commonFun.isPlayAdv()||e.fullscreen(t)})}},{key:"loadStart",value:function(e){p.default.debug("褰撳墠鎺ユ敹浜嬩欢 ==>> ",e.type)}},{key:"loadData",value:function(e){p.default.debug("褰撳墠鎺ユ敹浜嬩欢 ==>> ",e.type),"loadedmetadata"==e.type&&(this.videoWH={width:this.video.videoWidth,height:this.video.videoHeight},this.resize()),this.getDuration()}},{key:"getDuration",value:function(){var e=this.video.duration;isNaN(e)||e==Number.POSITIVE_INFINITY?p.default.debug("褰撳墠duration ==>> "+e+",閰嶇疆鏂囦欢鐨刣uration="+c.playerInfo.duration):(this.video.duration&&(c.playerInfo.duration=this.video.duration),p.default.debug("褰撳墠duration ==>> "+e+",閰嶇疆鏂囦欢鐨刣uration="+c.playerInfo.duration))}},{key:"canplaythrough",value:function(e){p.default.debug("褰撳墠鎺ユ敹浜嬩欢canplaythrough ==>> ",e.type),this.volume=1,this.canplay||(this.canplay=!0,this.preWatchTime>0&&(this.video.currentTime=this.preWatchTime,p.default.debug("this.video.currentTime ==>> ",this.preWatchTime)))}},{key:"waiting",value:function(e){p.default.debug("褰撳墠鎺ユ敹浜嬩欢 ==>> ",e.type),"seeking"!=e.type&&"waiting"!=e.type||this.dispatchEvent(u.H5ComponentEvent.VIDEO_WAITING)}},{key:"timeupdate",value:function(e){var t=this;if(c.playerInfo.status!=c.playStatus.END||0==this.video.currentTime)if(d.commonFun.isPlayAdv())this.dispatchEvent(u.H5ComponentEvent.VIDEO_UPDATE,null);else{c.playerInfo.posi=this.video.currentTime;var i=-1,n=0;try{n=this.video.buffered.end(0)}catch(e){}if(c.playerInfo.buffered!==n&&(i=n,c.playerInfo.buffered=n),this.video.currentTime>0&&this.watchInter<0&&(this.sendSDBip(),this.watchInter=setInterval(function(){var e=c.playerInfo.status==c.playStatus.PLAYING?d.H5Common.heartDuration:0,i={dt:"online",data:{wt:{watchTime:1e3*t.watchTime,duration:Math.floor(1e3*c.playerInfo.duration),curTime:Math.floor(1e3*c.playerInfo.posi),heartDuration:e,urlType:c.playerInfo.urlType}}};t.sendBip(i)},d.H5Common.heartDuration)),this.watchTime++,d.H5Common.pay&&!h.userInfo.isVip&&(c.playerInfo.posi>c.playerInfo.shikantime||c.playerInfo.posi+1>c.playerInfo.shikantime)){if(this.showPay)return;return this.video.pause(),this.stopVideo(),this.showPay=!0,y.default.postMessage(g.ExternalEvent.VIDEO_STATUS,g.playerStatusType.VIDEO_SHIKAN_END),void this.dispatchEvent(u.H5ComponentEvent.VIDEO_ERROR,{code:412,msg:"寮€閫氫細鍛�"})}var r={};if(c.playerInfo.playType==c.playType.VOD)r.start=0,r.end=c.playerInfo.duration||0,r.posi=c.playerInfo.posi,c.playerInfo.duration-c.playerInfo.posi<15&&(this.abnormal=!0);else if(c.playerInfo.playType==c.playType.HUIKAN)r.start=0,r.end=c.playerInfo.duration||0,r.posi=c.playerInfo.posi,c.playerInfo.duration-c.playerInfo.posi<15&&(this.abnormal=!0);else{var a=d.H5Common.timestamp;r.live=a+1e3*c.playerInfo.posi}r.buffered=i,this.dispatchEvent(u.H5ComponentEvent.VIDEO_UPDATE,r)}}},{key:"ended",value:function(e){p.default.debug("褰撳墠鎺ユ敹浜嬩欢 ==>> ",e.type),this.stopVideo(),y.default.postMessage(g.ExternalEvent.VIDEO_STATUS,g.playerStatusType.VIDEO_END)}},{key:"pause",value:function(e){if(p.default.debug("褰撳墠鎺ユ敹浜嬩欢 ==>> ",e.type),c.playerInfo.status!==c.playStatus.END){if(c.playerInfo.status=c.playStatus.PAUSE,!c.playerInfo.start)return;this.dispatchEvent(u.H5ComponentEvent.VIDEO_STATE,{status:c.playerInfo.status}),y.default.postMessage(g.ExternalEvent.VIDEO_STATUS,g.playerStatusType.VIDEO_PAUSE)}}},{key:"playing",value:function(e){c.playerInfo.start||(c.playerInfo.start=!0),p.default.debug("褰撳墠鎺ユ敹浜嬩欢 ==>> ",e.type),c.playerInfo.status=c.playStatus.PLAYING,this.dispatchEvent(u.H5ComponentEvent.VIDEO_STATE,{status:c.playerInfo.status}),y.default.postMessage(g.ExternalEvent.VIDEO_STATUS,g.playerStatusType.VIDEO_PLAYING)}},{key:"error",value:function(e){if(p.default.debug("video璇锋眰鍑洪敊 >>>>>>",e.type),"error"==e.type){if(this.stopVideo(),""==this.video.src||c.playerInfo.autoplay)return;if(this.video.error&&this.video.error.code){var t={};switch(t.code=this.video.error.code,t.msg="video鎾斁鍑洪敊",t.code){case 1:t.msg="鍙栧洖杩囩▼琚敤鎴蜂腑姝�";break;case 2:t.msg="涓嬭浇鍑洪敊";break;case 3:t.msg="瑙ｇ爜閿欒";break;case 4:t.msg="涓嶆敮鎸侀煶棰�/瑙嗛"}t.code=d.H5Common.callCode.video[Number(t.code)],this.dispatchEvent(u.H5ComponentEvent.VIDEO_ERROR,t)}}}},{key:"fullscreen",value:function(e){p.default.debug("<<<<<<<<<<",e.type);var t=this.player.attr("data-player-fullscreen");if("webkitbeginfullscreen"==e.type){if(Number(t)>0)return;T?(y.default.postMessage(g.ExternalEvent.VIDEO_FULLSCREEN,!0),this.appleFullScreen(this.video)):this.appleFullScreen(this.video),this.sendBip({dt:"act",data:{type:"fullscreen"}})}else this.player.attr("data-player-fullscreen",0)}},{key:"exitFullscreen",value:function(){var e=this.player.attr("data-player-fullscreen");Number(e)>0&&this.player.attr("data-player-fullscreen",0);var t=document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen&&t.webkitCancelFullScreen()}},{key:"appleFullScreen",value:function(e){var t=e||this.video;T||this.player.attr("data-player-fullscreen",1),console.log("appleFullScreen"),f.$.isFunction(t.requestFullscreen)?t.requestFullscreen():f.$.isFunction(t.webkitEnterFullscreen)?t.webkitEnterFullscreen():f.$.isFunction(t.mozRequestFullScreen)?t.mozRequestFullScreen():alert("Your browsers doesn't support fullscreen")}},{key:"seekVideo",value:function(e){if(d.H5Common.pay&&!h.userInfo.isVip&&e>=c.playerInfo.shikantime){if(this.showPay)return;return this.video.pause(),this.stopVideo(),this.showPay=!0,y.default.postMessage(g.ExternalEvent.VIDEO_STATUS,g.playerStatusType.VIDEO_SHIKAN_END),void this.dispatchEvent(u.H5ComponentEvent.VIDEO_ERROR,{code:412,msg:"寮€閫氫細鍛�"})}e<=c.playerInfo.duration&&(this.video.currentTime=e,this.sendBip({dt:"act",data:{type:"seek"}}))}},{key:"sendSDBip",value:function(){var e={dt:"sd",data:{cid:c.playerInfo.cid,sessionID:d.H5Common.clientID,rateType:c.playerInfo.rateType,urlType:c.playerInfo.urlType}};p.default.debug("鎶ユ枃sd<<<<",e),this.sendBip(e)}},{key:"sendBip",value:function(e){this.dispatchEvent(u.H5ComponentEvent.VIDEO_BIP,e)}},{key:"volume",set:function(e){e>1?e=1:e<0&&(e=0),c.playerInfo.volume=e,this.video.volume=e}}]),t}(l.default);t.default=S},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=h(i(2)),r=h(i(0)),a=h(i(1)),o=h(i(3)),s=h(i(4)),l=h(i(8)),u=h(i(177)),d=(i(19),i(16)),f=i(31),c=(i(6),h(i(7)));function h(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"onRegister",value:function(){this.setViewComponent(new u.default)}},{key:"handleEvent",value:function(e,t){this.viewComponent}},{key:"listNotificationInterests",value:function(){return[d.H5Notification.EXTERNAL_NOTICATION]}},{key:"handleNotification",value:function(e){var t=e.getBody();switch(e.getName()){case d.H5Notification.EXTERNAL_NOTICATION:var i=e.getType();this.externalHandler(i,t)}}},{key:"externalHandler",value:function(e,t){switch(c.default.debug("澶栭儴璋冪敤鎺ュ彛skin"+e+","+t),e){case d.ExternalApiType.ADVERT_STATUS:if(console.log("<<<<<骞垮憡鐨勬秷鎭�",t),c.default.debug("<<<<<骞垮憡鐨勬秷鎭細"+t),t&&t.params){var i=t.params.type,n=t.params.data;if(i)switch(f.advertInfo.status=i,f.advertInfo.data=n,i){case f.advertStatus.READY:n&&n.urls&&n.urls.length&&(f.advertInfo.urls=n.urls,this.sendNotification(d.ExternalApiType.ADV_DATA_SUCCESS));break;case f.advertStatus.START:break;case f.advertStatus.END:f.advertInfo.urls&&f.advertInfo.urls.length?this.sendNotification(d.ExternalApiType.ADV_NEXT):this.sendNotification(d.ExternalApiType.ADV_END);break;case f.advertStatus.ERROR:this.sendNotification(d.ExternalApiType.ADV_ERROR);break;case f.advertStatus.OVER:this.sendNotification(d.ExternalApiType.ADV_END)}}}}},{key:"onRemove",value:function(){this.setViewComponent(null)}}]),t}(l.default.Mediator);p.NAME="mobile_adv_mediator",t.default=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(i(2)),r=s(i(0)),a=s(i(3)),o=s(i(4));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){return(0,r.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,o.default)(t,e),t}(s(i(34)).default);t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=E(i(2)),r=E(i(0)),a=E(i(1)),o=E(i(3)),s=E(i(4)),l=E(i(8)),u=E(i(179)),d=i(19),f=i(16),c=E(i(17)),h=i(18),p=i(13),v=E(i(97)),y=E(i(7)),g=i(13),m=E(i(98));function E(e){return e&&e.__esModule?e:{default:e}}var _=function(e){function t(e){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"onRegister",value:function(){y.default.debug("娉ㄥ唽PcSkinComponent"),this.setViewComponent(new u.default),this.viewComponent.addEventListener(d.H5ComponentEvent.START_PLAY,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.CHANGE_PLAY_STATUS,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.SEEK,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.FULLSCREEN,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.SKIN_ERROR,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_BIP,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.NEXT,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.PAGE_ZOOM,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.CHANGE_RATETYPE,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.CHANGE_SPEED,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.CHANGE_VOLUME,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.LOOP,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.OPEN_VIP,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.REPLAY,this.onSkinHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.MUTED,this.onSkinHandler,this),this.viewComponent.init(),this.facade.retrieveProxy(m.default.NAME).loadData()}},{key:"listNotificationInterests",value:function(){return[f.H5Notification.VIDEO_SHOW_START_PLAY_BTN,f.H5Notification.EXTERNAL_NOTICATION,f.H5Notification.VIDEO_STATE,f.H5Notification.VIDEO_UPDATE,f.H5Notification.VIDEO_WAITING,f.H5Notification.PLAY_FAILED,f.H5Notification.VIDEO_NEXT,f.H5Notification.PLAY_ERROR,f.H5Notification.VIDEO_ERROR,f.H5Notification.VIDEO_HIDE_UI,f.H5Notification.PLAY_SUCCESS,f.H5Notification.VIDEO_SHOW_SPEED_UI,f.H5Notification.VIDEO_SET_MUTE,f.H5Notification.VIDEO_SHOW_RECO,f.H5Notification.RECO_SUCCESS]}},{key:"handleNotification",value:function(e){var t=this,i=e.getBody();switch(e.getName()){case f.H5Notification.EXTERNAL_NOTICATION:var n=e.getType();this.externalHandler(n,i);break;case f.H5Notification.VIDEO_UPDATE:this.viewComponent.updateProgress(i);break;case f.H5Notification.VIDEO_STATE:this.viewComponent.togglePlayBtn(i.status);break;case f.H5Notification.VIDEO_SHOW_START_PLAY_BTN:this.viewComponent.showStart();break;case f.H5Notification.VIDEO_WAITING:this.viewComponent.showLoading();break;case f.H5Notification.PLAY_FAILED:case f.H5Notification.PLAY_ERROR:case f.H5Notification.VIDEO_ERROR:this.viewComponent.showError(i);break;case f.H5Notification.VIDEO_NEXT:this.viewComponent.nextVideo();break;case f.H5Notification.VIDEO_HIDE_UI:break;case f.H5Notification.PLAY_SUCCESS:this.viewComponent.initUIByResult(!0);break;case f.H5Notification.VIDEO_SHOW_SPEED_UI:this.viewComponent.showSpeedUI(i);break;case f.H5Notification.VIDEO_SET_MUTE:this.viewComponent.setMute(i.bl);break;case f.H5Notification.RECO_SUCCESS:this.viewComponent.setReco(i);break;case f.H5Notification.VIDEO_SHOW_RECO:var r=setTimeout(function(){g.playerInfo.status==p.playStatus.END&&t.facade.retrieveProxy(v.default.NAME).loadData(),clearTimeout(r),r=-1},2e3)}}},{key:"onSkinHandler",value:function(e){y.default.debug(e);var t=e.data;switch(e.type){case d.H5ComponentEvent.START_PLAY:this.sendNotification(f.H5Notification.SKIN_START_PLAY);break;case d.H5ComponentEvent.CHANGE_PLAY_STATUS:this.sendNotification(f.H5Notification.SKIN_CHANGE_PLAY_STATUS,t);break;case d.H5ComponentEvent.SEEK:this.sendNotification(f.H5Notification.SKIN_SEEK,t);break;case d.H5ComponentEvent.FULLSCREEN:this.sendNotification(f.H5Notification.SKIN_FULLSCREEN,t);break;case d.H5ComponentEvent.VIDEO_BIP:c.default.postMessage(h.ExternalEvent.VIDEO_BIP,t);break;case d.H5ComponentEvent.NEXT:c.default.postMessage(h.ExternalEvent.VIDEO_NEXT);break;case d.H5ComponentEvent.PAGE_ZOOM:c.default.postMessage(h.ExternalEvent.VIDEO_PAGE_ZOOM,t);break;case d.H5ComponentEvent.CHANGE_RATETYPE:this.sendNotification(f.H5Notification.SKIN_CHANGE_RATETYPE,t);break;case d.H5ComponentEvent.CHANGE_SPEED:this.sendNotification(f.H5Notification.SKIN_CHANGE_SPEED,t);break;case d.H5ComponentEvent.CHANGE_VOLUME:this.sendNotification(f.H5Notification.SKIN_CHANGE_VOLUME,t);break;case d.H5ComponentEvent.LOOP:c.default.postMessage(h.ExternalEvent.VIDEO_LOOP,t);break;case d.H5ComponentEvent.OPEN_VIP:console.log("open_vip"),c.default.postMessage(h.ExternalEvent.VIDEO_OPEN_VIP);break;case d.H5ComponentEvent.REPLAY:console.log("replay"),this.sendNotification(f.H5Notification.SKIN_REPLAY);break;case d.H5ComponentEvent.MUTED:console.log("muted"),this.sendNotification(f.H5Notification.SKIN_MUTED,t)}}},{key:"externalHandler",value:function(e,t){switch(y.default.debug("澶栭儴璋冪敤鎺ュ彛"+e+","+t),e){case f.ExternalApiType.VIDEO_PAUSE:this.viewComponent.playBtnHandler(p.playStatus.PAUSE);break;case f.ExternalApiType.VIDEO_PAGE_ZOOM:this.viewComponent.togglePageZoom(t.pageZoom);break;case f.ExternalApiType.VIDEO_MINI_PLAYER:this.viewComponent.showMiniControl(t.mini);break;case f.ExternalApiType.SKIN_SHOW_ERROR_UI:if(t&&t.params){var i={code:"NOT_RELEASED"==t.params.code?"601":"",msg:t.params.errorMsg||""};i.code&&this.viewComponent.showError(i)}}}},{key:"onRemove",value:function(){this.setViewComponent(null)}}]),t}(l.default.Mediator);_.NAME="pc_skin_mediator",t.default=_},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=_(i(2)),r=_(i(0)),a=_(i(1)),o=_(i(3)),s=_(i(4)),l=i(32),u=_(i(34)),d=i(13),f=i(19),c=i(6),h=i(180),p=_(i(33)),v=_(i(17)),y=_(i(7)),g=i(18),m=i(181),E=i(27);function _(e){return e&&e.__esModule?e:{default:e}}var T=function(e){function t(e){(0,r.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));i.createView(c.H5Common.container),i.container=(0,l.$)(c.H5Common.container).find(".mod-player");var a=i.container;return i.tipsUI=a.children(".player-tips"),i.loadingUI=i.tipsUI.children(".player-tips-loading"),i.loadingStartUI=i.tipsUI.children(".player-start-loading"),i.smallwinBtn=i.tipsUI.children(".smallwindow-btn"),i.kandanBtn=i.tipsUI.children(".kandan-btn"),i.leftTipBtn=i.tipsUI.children(".left-tips"),i.leftTipContent=i.leftTipBtn.children(".tips-content"),i.controlUI=a.children(".control-wrapper"),i.leftUI=i.controlUI.children(".left-control"),i.playerBtn=i.leftUI.children(".play-btn"),i.nextBtn=i.leftUI.children(".next-btn"),i.loopBtn=i.leftUI.children(".loop-btn"),i.startTimeUI=i.leftUI.find(".time-txt .cur-time"),i.endTimeUI=i.leftUI.find(".time-txt .end-time"),i.rightUI=i.controlUI.children(".right-control"),i.zoomBtn=i.rightUI.children(".zoom-btn"),i.pageZoomBtn=i.rightUI.children(".page-zoom-btn"),i.volumeBox=i.rightUI.find(".volume-box"),i.volumeBtn=i.volumeBox.find(".slider-btn"),i.volumeCurrent=i.volumeBox.find(".volume-current"),i.speedBox=i.rightUI.find(".speed-box"),i.ratetypeBox=i.rightUI.find(".ratetype-box"),i.barrageBtn=i.rightUI.children(".barrage-btn"),i.progressUI=i.controlUI.children(".progress-control"),i.progressListUI=i.progressUI.children(".progress-control-list"),i.progressBtn=i.progressListUI.find(".progress-control-btn"),i.progressLoadUI=i.progressListUI.find(".progress-control-load"),i.progressPlayUI=i.progressListUI.find(".progress-control-play"),i.liveProgressUI=i.controlUI.find(".live-btns"),i.liveTimeUI=i.liveProgressUI.children(".live-time"),i.endUI=a.children(".end-wrapper"),i.errorUI=i.endUI.children(".error-wrapper"),i.errorCodeUI=i.errorUI.children(".error-id"),i.recoUI=i.endUI.children(".reco-wrapper"),i.openVipUI=i.endUI.children(".open-vip"),i.player=(0,l.$)(c.H5Common.container).find(".m-player"),i.miniControl=a.children(".mini-control"),i.miniPlayBtn=i.miniControl.find(".play-btn"),i.playBtnStatus=d.playStatus.PLAYING,i.hideInter=-1,i.isSpaceKeyUsed=!1,i.miniWindow=!1,i.show_rate_tips_ok_txt="",i.deeplink="",i}return(0,s.default)(t,e),(0,a.default)(t,[{key:"init",value:function(){this.bindAction(),this.controlUI.css("visibility","hidden"),this.endUI.hide(),c.H5Common.skinCfg,this.tipsUI.show(),this.loadingStartUI.show()}},{key:"createView",value:function(e){(0,l.$)(e).append('<section class="mod-player"></section>'),this.parContainer=(0,l.$)(e),this.container=this.parContainer.find(".mod-player"),this.container.append(h.videoHtml),this.container.append(h.controlHtml),this.container.append(h.miniWindowControl),this.container.append(h.tipsHtml),this.container.append(h.endHtml)}},{key:"bindAction",value:function(){var e=this;this.bindCreate||(this.bindCreate=!0,this.player[0].addEventListener("click",function(t){return e.showControl(t)}),this.player[0].addEventListener("mouseenter",function(t){e.showControl(t),e.isSpaceKeyUsed=!0}),this.player[0].addEventListener("mouseleave",function(t){e.enterControl||(e.isSpaceKeyUsed=!1,e.showControl(t))}),this.player[0].addEventListener("mousemove",p.default.throttle(function(t){e.enterControl||e.showControl(t)},200)),this.controlUI[0].addEventListener("mouseenter",function(t){e.enterControl=!0,e.showControl(t,!0)}),this.controlUI[0].addEventListener("mouseleave",function(t){e.enterControl=!1,e.showControl(t)},!1,!1),this.parContainer[0].addEventListener("contextmenu",function(t){return e.showCXMenu(t)}),this.playerBtn.on("click",function(t){return e.playBtnHandler()}),this.miniPlayBtn.on("click",function(t){return e.playBtnHandler()}),this.nextBtn.on("click",function(t){return e.nextBtnHandler()}),this.loopBtn.on("click",function(t){return e.loopBtnHandler()}),this.recoUI.on("click",".replay",function(t){return e.replayHandler(t)}),this.progressUI.on("click",".progress-control-list",function(t){return e.progressHandler(t)}),(0,m.dragDrop)(this.progressBtn[0],{mouseDownHandler:this.progressDragHandler,mouseMoveHandler:this.progressDragHandler,mouseUpHandler:this.progressDragHandler},this).register(),this.zoomBtn.on("click",function(t){return e.zoomHandler(t)}),this.pageZoomBtn.on("click",function(t){return e.pageZoomHandler(t)}),this.volumeBox[0].addEventListener("click",function(t){return e.volumeBtnHandler(t)}),this.volumeBox[0].addEventListener("mouseenter",function(t){return e.volumeBtnHandler(t)}),this.volumeBox[0].addEventListener("mouseleave",function(t){return e.volumeBtnHandler(t)}),(0,m.dragDrop)(this.volumeBtn[0],{mouseDownHandler:this.volumeDragHandler,mouseMoveHandler:this.volumeDragHandler,mouseUpHandler:this.volumeDragHandler},this).register(),this.speedBox[0].addEventListener("click",function(t){return e.speedHandler(t)}),this.speedBox[0].addEventListener("mouseenter",function(t){return e.speedHandler(t)}),this.speedBox[0].addEventListener("mouseleave",function(t){return e.speedHandler(t)}),this.ratetypeBox[0].addEventListener("click",function(t){return e.ratetypeHandler(t)}),this.ratetypeBox[0].addEventListener("mouseenter",function(t){return e.ratetypeHandler(t)}),this.ratetypeBox[0].addEventListener("mouseleave",function(t){return e.ratetypeHandler(t)}),this.barrageBtn.on("click",function(t){return e.barrageHandler(t)}),this.errorUI.on("click",".btns",function(t){return e.errorBtnHandler(t)}),this.openVipUI.on("click",function(t){return e.openVip(t)}),this.leftTipBtn.on("click",function(t){return e.tipHandler(t)}),document.addEventListener("keydown",function(t){return e.keyDownHandler(t)}),this.addListenerScreenChange(),this.controlUI.on("webkitAnimationStart animationstart webkitAnimationEnd animationend",function(t){return e.onFadeHandler(t)}))}},{key:"showStart",value:function(){}},{key:"showLoading",value:function(){d.playerInfo.start&&(!("none"==this.tipsUI.css("display"))||this.tipsUI.show(),this.loadingStartUI.hide(),this.loadingUI.show())}},{key:"hideUI",value:function(){this.tipsUI.hide(),this.controlVisible(!1),this.endUI.hide()}},{key:"initUIByResult",value:function(e){e&&(d.playerInfo.playType==d.playType.LIVE?(this.liveProgressUI.show(),this.progressUI.hide(),this.nextBtn.hide(),this.loopBtn.hide(),this.leftUI.find(".time-txt").hide()):(this.progressUI.show(),this.liveProgressUI.hide(),this.nextBtn.show(),this.loopBtn.show(),this.leftUI.find(".time-txt").show()),this.seekVolume(d.playerInfo.volume),this.ratetypeBox.hasClass("disabled")&&this.ratetypeBox.removeClass("disabled"),this.createRTUI(),c.H5Common.pay&&!E.userInfo.isVip?(this.tipsUI.show(),this.showTip('<div class="content vip">璇曠湅<i class="shikan-text">6</i>鍒嗛挓,<i class="vip-btn">寮€閫歷ip</i>鍏嶈垂瑙傜湅鏈墖</div>')):(this.showTip(""),this.leftTipBtn.hide()),this.recoUI.hide(),this.errorUI.hide(),this.recoUI.hide())}},{key:"createRTUI",value:function(){var e=d.playerInfo.rateType,t=d.playerInfo.rateTypeList,i=d.rateTypeList[e].txt1;if(this.ratetypeBox.children(".txt-btn").children(".txt").text(i),t){for(var n=t.split(","),r=0;r<n.length;r++)for(var a=0;a<n.length-1-r;a++)n[a]>n[a+1]&&(n[a],n[a]=n[a+1],n[a+1]=n[a]);var o=this.ratetypeBox.children(".ratetype-content").children(".ul-rt");o.html("");for(var s=!1,l="",u=n.length-1;u>-1;u--){var f=n[u],c=d.rateTypeList[f].txt1+" "+d.rateTypeList[f].txt2,h="";f==e&&(h="cur"),4!=f?l='<li class="item-rt '+h+'" data-val="'+f+'">'+c+"</li>":(s=!0,l='<li class="item-rt '+h+'" data-val="'+f+'">'+c+'<i class="vip"></i></li>'),o.append(l)}if(!s){var p=d.playerInfo.playType===d.playType.LIVE?1:0;this.deeplink="miguvideo://"+d.playerInfo.cid+","+p,l='<li class="item-rt" data-val="41"><a data-val="41">瀹㈡埛绔� 1080p<span class="vip" data-val="41">涓撲韩</span></a></li>',o.prepend(l)}}}},{key:"playBtnHandler",value:function(e){y.default.debug("<<<<鍒囨崲鎾斁鐘舵€�<<<<"+e),this.togglePlayBtn(e),this.dispatchEvent(f.H5ComponentEvent.CHANGE_PLAY_STATUS,{status:this.playBtnStatus})}},{key:"nextBtnHandler",value:function(e){y.default.debug("<<<<鎾斁涓嬩竴闆�<<<<"),this.dispatchEvent(f.H5ComponentEvent.NEXT)}},{key:"loopBtnHandler",value:function(e){y.default.debug("<<<<鏄惁寰幆鎾斁<<<<");var t=this.loopBtn.children("i");t.attr("title","寰幆"),t.hasClass("loop")?(d.playerInfo.loop=!1,t.removeClass("loop").addClass("loop-not"),t.attr("title","寮€濮嬪惊鐜挱鏀�")):(d.playerInfo.loop=!0,t.removeClass("loop-not").addClass("loop"),t.attr("title","鍋滄寰幆鎾斁")),this.dispatchEvent(f.H5ComponentEvent.LOOP,{status:d.playerInfo.loop})}},{key:"replayHandler",value:function(e){this.endUI.hide(),this.recoUI.hide(),this.dispatchEvent(f.H5ComponentEvent.REPLAY)}},{key:"togglePlayBtn",value:function(e){if(e!=d.playStatus.END){var t=this.playerBtn;this.miniWindow&&(t=this.miniPlayBtn);var i=t.find(".play"),n=t.find(".pause");if(this.loadingUI.hide(),e){if(this.playBtnStatus=e,e==d.playStatus.PAUSE&&i.length)return;if(e==d.playStatus.PLAYING&&n.length)return}else this.playBtnStatus=i.length?d.playStatus.PLAYING:d.playStatus.PAUSE;var r=t.find("i");y.default.debug("this.togglePlayBtn="+this.playBtnStatus),this.playBtnStatus==d.playStatus.PAUSE?r.removeClass("pause").addClass("play"):this.playBtnStatus==d.playStatus.PLAYING&&r.removeClass("play").addClass("pause")}else this.showEnd()}},{key:"progressHandler",value:function(e){if(e&&e.stopPropagation(),"click"==e.type){var t=this.progressListUI.width(),i=e.clientX-this.progressListUI.offset().left;i>t?i=t:i<0&&(i=0),this.updateProgressBtn(i);var n=i/t;this.progressPlayUI.css("width",100*n+"%"),this.seekTime(n)}else"mouseenter"==e.type?(this.progressUI.addClass("progresschangebig").removeClass("progresschangesmall"),this.progressBtn.show()):"mouseleave"==e.type&&(this.progressUI.addClass("progresschangesmall").removeClass("progresschangebig"),this.progressBtn.hide())}},{key:"updateProgressBtn",value:function(e){var t=this.progressListUI.width(),i=(e-.5*this.progressBtn.children(".btn").width())/t;this.progressBtn.css("left",100*i+"%")}},{key:"seekTime",value:function(e){var t=d.playerInfo.duration,i=Math.floor(t*e);this.dispatchEvent(f.H5ComponentEvent.SEEK,{time:i})}},{key:"progressDragHandler",value:function(e,t,i){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var n=this.progressBtn.position().left,r=this.progressListUI.width();if("mousedown"==e.type)this.pDrag=!0,this.playBtnHandler(d.playStatus.PAUSE);else if("mousemove"==e.type){if(!this.pDrag)return;(n=e.clientX-this.progressListUI.offset().left)>r?n=r:n<0&&(n=0);var a=n/r*100;this.progressPlayUI.css("width",a+"%"),this.updateProgressBtn(n),this.seekTime(n/r)}else if("mouseup"==e.type){if(!this.pDrag)return;this.pDrag=!1,this.playBtnHandler(d.playStatus.PLAYING)}}},{key:"zoomHandler",value:function(e){var t=this.zoomBtn.find("i"),i=!0;t.hasClass("zoom-in")?(t.removeClass("zoom-in").addClass("zoom-out"),t.attr("title","鍏ㄥ睆"),i=!1):(t.removeClass("zoom-out").addClass("zoom-in"),t.attr("title","閫€鍑哄叏灞�"),i=!0),this.fullscreenVideo(i);var n={dt:"act",data:{type:"fullscreen",value:i}};this.sendBip(n)}},{key:"fullscreenVideo",value:function(e){if(e){var t=this.container[0];l.$.isFunction(t.requestFullscreen)?t.requestFullscreen():l.$.isFunction(t.webkitRequestFullScreen)?t.webkitRequestFullScreen():l.$.isFunction(t.mozRequestFullScreen)?t.mozRequestFullScreen():alert("娴忚鍣ㄤ笉鏀寔鍏ㄥ睆")}else l.$.isFunction(document.exitFullscreen)?document.exitFullscreen():l.$.isFunction(document.webkitCancelFullScreen)?document.webkitCancelFullScreen():l.$.isFunction(document.mozCancelFullScreen)?document.mozCancelFullScreen():alert("娴忚鍣ㄤ笉鏀寔鍏ㄥ睆")}},{key:"pageZoomHandler",value:function(e){var t=this.togglePageZoom();this.dispatchEvent(f.H5ComponentEvent.PAGE_ZOOM,t)}},{key:"togglePageZoom",value:function(e){var t=this.pageZoomBtn.find("i"),i=!0;return t.hasClass("page-zoom-in")?(t.removeClass("page-zoom-in").addClass("page-zoom-out"),i=!1,t.attr("title","缃戦〉鍏ㄥ睆")):(t.removeClass("page-zoom-out").addClass("page-zoom-in"),i=!0,t.attr("title","閫€鍑虹綉椤靛叏灞�")),i}},{key:"barrageHandler",value:function(e){var t=this.barrageBtn.find("i"),i=!0;t.hasClass("barrage-off")?(t.removeClass("barrage-off").addClass("barrage-on"),i=!0):(t.removeClass("barrage-on").addClass("barrage-off"),i=!1),this.dispatchEvent(f.H5ComponentEvent.BARRAGE,i)}},{key:"volumeBtnHandler",value:function(e){var t=(0,l.$)(e.target);if("click"==e.type){if(t.hasClass("btn-bg"))(0,l.$)(".volume-content").hasClass("none")?(0,l.$)(".volume-content").removeClass("none"):t.hasClass("volume")?(t.removeClass("volume").addClass("mute"),this.seekVolume(0,!0)):(t.removeClass("mute").addClass("volume"),this.seekVolume(d.playerInfo.volume));else if(!(0,l.$)(".volume-content").hasClass("none")){var i=(0,l.$)(".volume-control").offset().top+(0,l.$)(".volume-control").height()-e.y;console.log(i),i>100?i=100:i<0&&(i=0);var n=this.volumeBox.children(".volume-btn").children(".btn-bg");n.length>0&&n.hasClass("mute")&&n.removeClass("mute").addClass("volume"),this.seekVolume(i)}}else"mouseenter"==e.type||"mouseleave"==e.type&&((0,l.$)(".volume-content").hasClass("none")||(0,l.$)(".volume-content").addClass("none"))}},{key:"setMute",value:function(e){var t=this.volumeBox.children(".volume-btn").children(".btn-bg");e?(t.removeClass("volume").addClass("mute"),this.seekVolume(0,!0)):(t.removeClass("mute").addClass("volume"),this.seekVolume(d.playerInfo.volume))}},{key:"volumeDragHandler",value:function(e,t,i){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1;var n=0,r=(0,l.$)(".volume-slider").height();if("mousedown"==e.type)this.vDrag=!0;else if("mousemove"==e.type){if(!this.vDrag)return;(n=(0,l.$)(".volume-control").offset().top+(0,l.$)(".volume-control").height()-e.y)>r?n=r:n<0&&(n=0),this.seekVolume(n)}else if("mouseup"==e.type){if(!this.vDrag)return;this.vDrag=!1}}},{key:"seekVolume",value:function(e,t){this.volumeBtn.css("bottom",e),this.volumeCurrent.css("height",e),t?this.dispatchEvent(f.H5ComponentEvent.MUTED,{bl:!0}):(this.dispatchEvent(f.H5ComponentEvent.MUTED,{bl:!1}),this.dispatchEvent(f.H5ComponentEvent.CHANGE_VOLUME,e))}},{key:"speedHandler",value:function(e){var t=(0,l.$)(e.target);if("click"==e.type){if(this.speedBox.hasClass("disabled"))return;if(t.hasClass("txt"))(0,l.$)(".speed-content").hasClass("none")&&(0,l.$)(".speed-content").removeClass("none");else if(t.hasClass("item-speed")){var i=t.attr("data-val"),n=this.speedBox.find(".item-speed"),r=this.speedBox.find(".txt");n.removeClass("cur"),t.addClass("cur"),r.text(i+"x"),(0,l.$)(".speed-content").hasClass("none")||(0,l.$)(".speed-content").addClass("none"),this.dispatchEvent(f.H5ComponentEvent.CHANGE_SPEED,i)}}else"mouseenter"==e.type||"mouseleave"==e.type&&((0,l.$)(".speed-content").hasClass("none")||(0,l.$)(".speed-content").addClass("none"))}},{key:"ratetypeHandler",value:function(e){var t=this,i=(0,l.$)(e.target),n=parseInt(i.attr("data-val"));if("click"==e.type){if(this.ratetypeBox.hasClass("disabled"))return;if(i.hasClass("txt"))(0,l.$)(".ratetype-content").hasClass("none")&&(0,l.$)(".ratetype-content").removeClass("none");else if(i.hasClass("item-rt")||41==n){if(41==n){if(window.location.href=this.deeplink,!c.H5Common.hasClient)var r=setTimeout(function(){c.H5Common.pcClientUrl="http://pcdown.miguvideo.com/MiguApi/download/MiguVideo3.5.1.430.exe",c.H5Common.pcClientUrl?location.href=c.H5Common.pcClientUrl:t.openApp(),clearTimeout(r)},3e3);return}var a=this.ratetypeBox.find(".item-rt"),o=this.ratetypeBox.find(".txt");a.removeClass("cur"),i.addClass("cur");var s=d.rateTypeList[n].txt1;o.text(s),this.dispatchEvent(f.H5ComponentEvent.CHANGE_RATETYPE,n);var u='<div class="content rt">姝ｅ湪涓烘偍鍒囨崲鍒�<i class="rt-text">$ratetype</i> 娓呮櫚搴�</div>'.replace("$ratetype",s);this.show_rate_tips_ok_txt='<div class="content rt">宸蹭负鎮ㄥ垏鎹㈠埌<i class="rt-text">$ratetype</i> 娓呮櫚搴�</div>'.replace("$ratetype",s),this.showTip(u),(0,l.$)(".ratetype-content").hasClass("none")||(0,l.$)(".ratetype-content").addClass("none")}}else"mouseenter"==e.type||"mouseleave"==e.type&&((0,l.$)(".ratetype-content").hasClass("none")||(0,l.$)(".ratetype-content").addClass("none"))}},{key:"showTip",value:function(e){this.leftTipContent.html(e),this.leftTipBtn.show(),"0px"==this.controlUI.css("bottom")&&this.leftTipBtn.removeClass("vip-movedown").addClass("vip-moveup")}},{key:"errorBtnHandler",value:function(e){e&&e.stopPropagation();var t=(0,l.$)(e.currentTarget),i=t.children(".refresh-btn"),n=t.children(".open-vip-btn"),r=t.children(".open-app"),a=t.children(".other-btn");i.length>0&&window.location.reload(),n.length>0&&this.openVip(),r.length>0&&this.openApp(),a.length>0&&this.openMzhan()}},{key:"updateProgress",value:function(e){var t=this;if(this.loadingUI.hide(),this.loadingStartUI.hide(),d.playerInfo.switchVideo){this.showTip(this.show_rate_tips_ok_txt);var i=setTimeout(function(){!d.playerInfo.switchVideo&&t.leftTipContent.children(".rt").length&&(t.leftTipContent.html(""),t.leftTipBtn.hide()),clearTimeout(i)},2e3);d.playerInfo.switchVideo=!1}if(d.playerInfo.status!=d.playStatus.END)if(d.playerInfo.playType==d.playType.VOD||d.playerInfo.playType==d.playType.HUIKAN){var n=d.playerInfo.playType==d.playType.HUIKAN?"hh:mm:ss":"mm:ss",r=p.default.formatDate(new Date(Math.floor(1e3*e.start)),n),a=p.default.formatDate(new Date(Math.floor(1e3*e.end)),n),o=d.playerInfo.playType==d.playType.HUIKAN?e.posi+e.start:e.posi,s=p.default.formatDate(new Date(Math.floor(1e3*o)),n);this.initProgress?this.startTimeUI.text(s):(this.initProgress=!0,this.startTimeUI.text(r),this.endTimeUI.text(a),c.H5Common.pay&&!E.userInfo.isVip&&this.leftTipBtn.show(),this.showControl());var l=100*e.posi/(e.end-e.start);this.progressPlayUI.css("width",l+"%");var u=this.progressListUI.width()*l/100;if(this.updateProgressBtn(u),e.buffered>0){var f=100*(e.buffered+e.start)/e.end;this.progressLoadUI.css("width",f+"%")}}else if(d.playerInfo.playType==d.playType.LIVE){var h=p.default.formatDate(new Date(Math.floor(e.live)),"hh:mm:ss");this.initProgress||(this.initProgress=!0,this.showControl()),this.liveTimeUI.text(h)}}},{key:"showControl",value:function(e,t){if(this.initProgress&&d.playerInfo.status!=d.playStatus.END&&"none"==this.endUI.css("display")&&!this.miniWindow)if(t=!!t,null==e||"mousemove"==e.type||"mouseenter"==e.type)"hidden"==this.controlUI.css("visibility")&&this.controlUI.css("visibility","visible"),"0px"==this.controlUI.css("bottom")?this.hideInter<0?this.showControlAnimation(t):(clearTimeout(this.hideInter),this.hideInter=-1,this.showControlAnimation(t)):(this.controlVisible(!0),this.showControlAnimation(t));else if("click"==e.type){if((0,l.$)(".context-menu").length>0)return;this.playBtnHandler(d.playStatus.PAUSE==d.playerInfo.status?d.playStatus.PLAYING:d.playStatus.PAUSE)}else e.type}},{key:"showCXMenu",value:function(e){e.preventDefault();var t=e.clientX,i=e.clientY;(0,l.$)(".context-menu").length||(0,l.$)(document.body).append(h.contextMenuHtml),(0,l.$)(".context-menu").css({left:t,top:i}),document.body.addEventListener("click",function t(){(0,l.$)(".context-menu").length&&((0,l.$)(".context-menu").remove(),e.stopPropagation(),e.preventDefault()),document.body.removeEventListener("click",t,!1)},!1)}},{key:"controlVisible",value:function(e){var t="0px"==this.controlUI.css("bottom"),i="none"!=this.leftTipBtn.css("display")&&this.leftTipBtn.children(".tips-content").html();e?t||(this.controlUI.removeClass("fadehide").addClass("fadeshow"),i&&this.leftTipBtn.removeClass("vip-movedown").addClass("vip-moveup")):t&&(this.controlUI.removeClass("fadeshow").addClass("fadehide"),i&&this.leftTipBtn.removeClass("vip-moveup").addClass("vip-movedown"))}},{key:"showControlAnimation",value:function(e){var t=this;this.hideInter>-1&&(clearTimeout(this.hideInter),this.hideInter=-1),e||(this.hideInter=setTimeout(function(){t.clearAnimation()},5e3))}},{key:"clearAnimation",value:function(){clearTimeout(this.hideInter),this.hideInter=-1,this.playBtnStatus!==d.playStatus.PAUSE&&this.controlVisible(!1)}},{key:"openApp",value:function(){try{var e=location.origin+"/mgs/website/prd/download.html";window.open(e)}catch(e){}}},{key:"tipHandler",value:function(e){(0,l.$)(e.target).hasClass("tips-close-btn")?(0,l.$)(e.currentTarget).remove():this.leftTipContent.children(".vip").length&&this.openVip()}},{key:"openVip",value:function(e){e&&e.stopPropagation(),e&&(0,l.$)(e.target).hasClass("tips-close-btn")?(0,l.$)(e.currentTarget).remove():(this.dispatchEvent(f.H5ComponentEvent.OPEN_VIP),this.sendBip({dt:"act",data:{type:"openVip"}}))}},{key:"openMzhan",value:function(){var e=location.origin+"/mgs/website/prd/index.html";window.location.href=e}},{key:"onFadeHandler",value:function(e){if(this.initProgress&&d.playerInfo.playType!=d.playType.LIVE){var t="0px"==this.controlUI.css("bottom"),i=e.type;"fadeout"!=e.animationName||"animationend"!=i&&"webkitAnimationEnd"!=i?"fadein"!=e.animationName||"animationstart"!=i&&"webkitAnimationStart"!=i||t||this.progressBtn.removeClass("none"):t||this.progressBtn.addClass("none")}}},{key:"keyDownHandler",value:function(e){if(32==e.keyCode&&this.isSpaceKeyUsed&&this.playBtnHandler(d.playStatus.PAUSE==d.playerInfo.status?d.playStatus.PLAYING:d.playStatus.PAUSE),38==e.keyCode||40==e.keyCode){d.playerInfo.status!=d.playStatus.END&&e.preventDefault();var t=d.playerInfo.volume,i=t%5;38==e.keyCode&&(t+=0!=i?5-i:5)>100&&(t=100),40==e.keyCode&&(t-=0!=i?i:5)<0&&(t=0),this.seekVolume(t)}if((37==e.keyCode||39==e.keyCode)&&(e.preventDefault(),this.isSpaceKeyUsed&&this.initProgress)){var n,r=d.playerInfo.posi;if(d.playerInfo.playType!=d.playType.VOD&&d.playerInfo.playType!=d.playType.HUIKAN)return;0,n=d.playerInfo.duration,10,0;try{37==e.keyCode?(r-=10)<0&&(r=0):39==e.keyCode&&(r+=10)>n&&(r=n),this.seekTime(r/n)}catch(e){}}}},{key:"addListenerScreenChange",value:function(){this.zoomBtn.find("i");var e=this,t=function(t){if(!e.checkFull()){var i=e.zoomBtn.find("i");i.removeClass("zoom-in").addClass("zoom-out"),i.attr("title","鍏ㄥ睆")}};this.container[0].addEventListener("fullscreenchange",t),document.addEventListener("mozfullscreenchange",t),this.container[0].addEventListener("webkitfullscreenchange",t),this.container[0].addEventListener("MSFullscreenChange",t)}},{key:"showMiniControl",value:function(e){d.playerInfo.status!=d.playStatus.END?e?(this.miniWindow=!0,this.togglePlayBtn(d.playerInfo.status),this.controlUI.css("visibility","hidden")):(this.miniWindow=!1,this.togglePlayBtn(d.playerInfo.status),this.showControl()):this.miniWindow=!1}},{key:"checkFull",value:function(){return!!(document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen)}},{key:"nextVideo",value:function(){d.playerInfo.start||(this.initProgress=!1,this.init())}},{key:"showEnd",value:function(){d.playerInfo.switchVideo||(this.tipsUI.hide(),this.controlVisible(!1)),this.recoUI.hide(),this.initProgress=!1}},{key:"showError",value:function(e){var t=0,i="";if(e){if(t=parseInt(e.code),d.playerInfo.errorObj.cid==d.playerInfo.cid&&601==d.playerInfo.errorObj.errorID)return;d.playerInfo.errorObj={cid:d.playerInfo.cid,errorID:t},i=e.msg||""}var n="refresh-btn",r=i||"鑺傜洰鍑洪敊浜唦",a="鍒锋柊鑺傜洰",o=null,s=!0;switch(t){case 401:case 411:case 403:case 501:n="open-app",r="鍥犵増鏉冮檺鍒讹紝璇锋壂鐮佸墠寰€鎵嬫満APP瑙傜湅瀹屾暣鍐呭",a="涓嬭浇鍜挄瑙嗛APP",s=!1;break;case 409:n="open-vip-btn",r="璇ュ唴瀹逛负浠樿垂鍐呭锛岃寮€閫氫細鍛樿鐪�",a="寮€閫氫細鍛�",o="vip-icon",s=!1;break;case 400:case 410:case 404:n="other-btn",r="鐪熸姳姝夛紝鎮ㄨ鎵剧殑鑺傜洰濂藉儚澶辫釜浜�",a="鐪嬬湅鍏朵粬鑺傜洰";break;case 412:n="open-vip-btn",r="璇曠湅宸茬粡缁撴潫浜嗗摝锛屽紑閫氫細鍛樿鐪嬪畬鏁村唴瀹�",a="闄愭椂娲诲姩  浼樻儬寮€閫歏IP浼氬憳",o="vip-icon",s=!1;break;case 2e3:n="refresh-btn",r="鐪熷按灏紝濂藉儚鍑轰簡鐐归棶棰橈紝鍒锋柊鍚庡啀璇曡瘯鐪嬪摝锝�",a="绔嬪嵆鍒锋柊";break;case 2001:n="open-app",r="褰撳墠鍐呭闇€瑕佺敤鍒告挱鏀撅紝璇峰墠寰€APP瑙傜湅瀹屾暣鍐呭",a="涓嬭浇鍜挄瑙嗛APP",s=!1;break;case 3005:n="open-app",r="鎮ㄤ娇鐢ㄧ殑娴忚鍣ㄧ増鏈繃浣庯紝璇峰墠寰€瀹㈡埛绔鐪嬪畬鏁村唴瀹�",a="涓嬭浇鍜挄瑙嗛瀹㈡埛绔�",s=!1;break;case 601:n="open-app",a="鐪嬬湅鍏朵粬鑺傜洰",s=!1}this.setErrorUI({id:t,className:n,des:r,btnText:a,iconClass:o,showErrorID:s}),v.default.postMessage(g.ExternalEvent.VIDEO_ERROR,e)}},{key:"setErrorUI",value:function(e){if(e.id){this.tipsUI.hide(),this.controlVisible(!1),this.endUI.show(),this.errorUI.show(),this.recoUI.hide(),this.openVipUI.hide();var t=e.id,i=e.className,n=e.des,r=e.btnText,a=(e.iconClass,this.errorUI.find(".text")),o=this.errorUI.find(".btns").children("div");a.text(n),o.removeClass().addClass(i),o.children("span").text(r),!0===e.showErrorID?(this.errorCodeUI.show(),this.errorCodeUI.children("span").text(t)):this.errorCodeUI.hide();var s=this.errorUI.find(".bg"),l=this.errorUI.find(".download-img"),u=this.errorUI.find(".btns");"open-app"==i?(s&&s.show(),l&&l.show(),u&&u.hide()):(s&&s.hide(),l&&l.hide(),u&&u.show())}}},{key:"sendBip",value:function(e){this.dispatchEvent(f.H5ComponentEvent.VIDEO_BIP,e)}},{key:"showSpeedUI",value:function(e){if(this.speedBox.hasClass("disabled")&&this.speedBox.removeClass("disabled"),e.speed){var t=this.speedBox.find(".item-speed");this.speedBox.find(".txt"),t.removeClass("cur");for(var i=null,n=0;n<t.length;n++)i=t[n],(0,l.$)(i).attr("data-val")==e.speed&&(0,l.$)(i).addClass("cur")}e.rSpeed&&this.speedBox.find(".txt").text(e.rSpeed+"x")}},{key:"setReco",value:function(e){if(!e||!e.length)return this.endUI.show(),this.recoUI.show(),void this.recoUI.children(".reco-content").children(".reco-subtitle").hide();this.endUI.show(),this.recoUI.show();var t=this.recoUI.children(".reco-content").children(".reco-list");if(t.html(""),this.container.width()>500?(t.addClass("big"),e.length>6&&(e=e.splice(0,6))):(t.addClass("small"),e.length>2&&(e=e.splice(0,2))),e)for(var i="",n="",r="",a="/",o="",s=0;s<e.length;s++)n=e[s].h5pics.lowResolutionH,r=e[s].name,(o=e[s].action.params.contentID)&&(a=location.origin+"/mgs/website/prd/detail.html?cid="+o),i='<li class="reco-item"><a href='+a+' class="item-act"><img src='+n+' class="reco-item-img"><span class="reco-item-name">'+r+"</span></a></li>",t.append(i)}}]),t}(u.default);t.default=T},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.miniWindowControl=t.contextMenuHtml=t.endHtml=t.tipsHtml=t.controlHtml=t.videoHtml=void 0;var n=i(6);t.videoHtml='<div class="video-wrapper"><video id="m-player" class="m-player" x5-playsinline="" playsinline="" webkit-playsinline="" x-webkit-airplay="allow" preload="true">鎮ㄧ殑娴忚鍣ㄤ笉鏀寔HTML5锛屾棤娉曡鐪嬫垜浠彁渚涚殑瑙嗛锛佸缓璁娇鐢ㄩ珮鐗堟湰娴忚鍣ㄨ鐪嬶紝璋㈣阿锛�</video></div>',t.controlHtml='<div class="control-wrapper"><div class="progress-control"><div class="progress-control-list"><div class="progress-control-load"></div><div class="progress-control-play"></div><div class="progress-control-btn"><i class="btn"></i></div></div></div><div class="left-control"><div class="control-btn play-btn"><i class="btn-bg play"></i></div><div class="control-btn next-btn"><i class="btn-bg next" title="涓嬩竴闆�"></i></div><div class="control-btn loop-btn"><i class="btn-bg loop-not" title="寮€濮嬪惊鐜挱鏀�"></i></div><div class="control-btn time-txt"><span class="txt cur-time ">00:00</span><span class="txt">/</span><span class="txt end-time">100:00</span></div></div><div class="live-btns none"><div class="icon">鐩存挱</div><div class="live-time">11:00</div></div><div class="right-control"><div class="zoom-btn"><i class="btn-bg zoom-out" title="鍏ㄥ睆"></i></div><div class="page-zoom-btn"><i class="btn-bg page-zoom-out" title="缃戦〉鍏ㄥ睆"></i></div><div class="volume-box"><div class="volume-btn"><i class="btn-bg volume" title="闊抽噺"></i></div><div class="volume-content none"><div class="volume-control"><div class="volume-slider"><div class="slider-btn"><i class="btn"></i></div><div class="volume-current"></div></div></div></div></div><div class="speed-box disabled"><div class="txt-btn speed"><i class="txt">鍊嶉€�</i></div><div class="speed-content none"><ul class="ul-speed"><li class="item-speed" data-val="0.5">0.5x</li><li class="item-speed" data-val="1.0">1.0x</li><li class="item-speed" data-val="1.25">1.25x</li><li class="item-speed" data-val="1.5">1.5x</li><li class="item-speed" data-val="2.0">2.0x</li></ul></div></div><div class="ratetype-box disabled"><div class="txt-btn ratetype"><i class="txt">楂樻竻</i></div><div class="ratetype-content none"><ul class="ul-rt"><li class="item-rt" data-val="4">钃濆厜 1080p</li><li class="item-rt" data-val="3">瓒呮竻 720p</li><li class="item-rt cur" data-val="2">楂樻竻 480p</li><li class="item-rt" data-val="1">鏍囨竻 270p</li></ul></div></div><div class="barrage-btn none"><i class="btn-bg barrage-off"></i></div></div></div>',t.tipsHtml='<div class="player-tips"><div class="player-tips-loading"><div class="p-loading"><div class="icon"><div class="icon_bg"></div><div class="icon_hight"></div></div></div></div><div class="player-start-loading"><div class="p-loading"><i class="start-loading"></i></div></div><div class="smallwindow-btn none"><i class="smallwindow-icon"></i><span>灏忕獥鎾斁</span></div><div class="kandan-btn none"><i class="kandan-icon"></i><span>鍔犲叆鐪嬪崟</span></div><div class="left-tips none"><div class="tips-close-btn" title="鍏抽棴"></div><div class="tips-content"></div></div></div>',t.endHtml='<div class="end-wrapper none"><div class="error-wrapper none"><div class="error-content"><div class="bg"></div><div class="text">鐪熷按灏紝濂藉儚鍑轰簡鐐归棶棰橈紝鍒锋柊璇曡瘯鐪媬</div><div class="btns"><div class="refresh-btn"><i class="vip-icon none"></i><span>绔嬪嵆鍒锋柊</span></div></div><div class="download-img"></div></div><div class="error-id">鎻愮ず:<span>1032</span></div></div><div class="reco-wrapper none"><div class="replay">閲嶆挱</div><div class="reco-content"><div class="reco-title">鎮ㄨ鐪嬬殑瑙嗛宸叉挱鏀惧畬姣�</div><div class="reco-subtitle"><div class="title-l-r-line"><div class="r-line"></div><div class="r-title">鐑棬鎺ㄨ崘</div></div></div><ul class="reco-list"></ul></div></div><div class="open-vip none"><div class="vip-content"><div class="title">璇曠湅缁撴潫锛屽紑閫歏IP浼氬憳鍏嶈垂鐪�</div><div class="content"><div class="icon"><i class="vip-icon"></i><span class="sub-title">闄愭椂娲诲姩  浼樻儬寮€閫歏IP浼氬憳</span></div><div class = "qr-code"><i class="ma"></i><div class="txt">鏀粯瀹濇壂鐮佸揩閫熷紑閫氫細鍛�</div></div></div></div></div></div>',t.contextMenuHtml='<div class="context-menu"><div class="txt">Build HTML5Player '+n.H5Common.version+'</div><div class="txt">Powered by 鍜挄瑙嗛 </div></div>',t.miniWindowControl='<div class="mini-control none"><div class="control-btn"><div class="play-btn"><i class="btn-bg play"></i></div></div></div>'},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dragDrop=function(e,t,i){var n=0,r=0,a=!1,o=null,s=i,l=t&&t.mouseDownHandler,u=t&&t.mouseMoveHandler,d=t&&t.mouseUpHandler,f=function e(t){switch(t.type){case"mousedown":o=t.target,setTimeout(function(){a=!0},200),a=!0,n=t.clientX-o.offsetLeft,r=t.clientY-o.offsetTop,document.addEventListener("mousemove",e,!1),document.addEventListener("mouseup",e,!1),l&&l.call(s,t);break;case"mousemove":if(!0===a){var i=t.clientY-r,f=t.clientX-n;u&&u.call(s,t,i,f)}break;case"mouseup":d&&d.call(s,t,i,f),document.removeEventListener("mousemove",e,!1),document.removeEventListener("mouseup",e,!1),a=!1,o=null}};return{register:function(){e.addEventListener("mousedown",f,!1)},remove:function(){e.removeEventListener("mousedown",f,!1)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=g(i(2)),r=g(i(0)),a=g(i(1)),o=g(i(3)),s=g(i(4)),l=g(i(8)),u=g(i(183)),d=i(19),f=i(16),c=g(i(65)),h=g(i(17)),p=i(18),v=g(i(7)),y=i(13);function g(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(e){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"onRegister",value:function(){v.default.debug("娉ㄥ唽 pcVideoComponent"),this.setViewComponent(new u.default),this.viewComponent.addEventListener(d.H5ComponentEvent.WEB_PLAY,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_UPDATE,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_STATE,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_WAITING,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.PLAY_ERROR,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_ERROR,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.HIDE_UI,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_BIP,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.SHOW_SPEED_UI,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.SET_MUTE,this.onVideoHandler,this),this.viewComponent.addEventListener(d.H5ComponentEvent.VIDEO_SHOW_RECO,this.onVideoHandler,this),this.viewComponent.init()}},{key:"handleEvent",value:function(e,t){this.viewComponent}},{key:"listNotificationInterests",value:function(){return[f.H5Notification.PLAY_SUCCESS,f.H5Notification.SKIN_START_PLAY,f.H5Notification.EXTERNAL_NOTICATION,f.H5Notification.SKIN_CHANGE_PLAY_STATUS,f.H5Notification.SKIN_SEEK,f.H5Notification.SKIN_FULLSCREEN,f.H5Notification.SKIN_CHANGE_RATETYPE,f.H5Notification.SKIN_CHANGE_SPEED,f.H5Notification.SKIN_CHANGE_VOLUME,f.H5Notification.SKIN_REPLAY,f.H5Notification.SKIN_MUTED]}},{key:"handleNotification",value:function(e){var t=e.getBody();switch(v.default.debug("<<<<"+e.getName()+",<<<<<"+t),e.getName()){case f.H5Notification.PLAY_SUCCESS:this.viewComponent.setPlayData(t),y.playerInfo.next?this.sendNotification(f.H5Notification.VIDEO_NEXT):this.sendNotification(f.H5Notification.VIDEO_SHOW_START_PLAY_BTN),h.default.postMessage(p.ExternalEvent.VIDEO_STATUS,p.playerStatusType.VIDEO_READY);break;case f.H5Notification.SKIN_START_PLAY:this.viewComponent.playVideo();break;case f.H5Notification.EXTERNAL_NOTICATION:var i=e.getType();this.externalHandler(i,t);break;case f.H5Notification.SKIN_CHANGE_PLAY_STATUS:this.viewComponent.changePlayStatus(t.status);break;case f.H5Notification.SKIN_SEEK:this.viewComponent.seekVideo(t.time);break;case f.H5Notification.SKIN_FULLSCREEN:this.viewComponent.fullscreen({type:"webkitbeginfullscreen"});break;case f.H5Notification.SKIN_CHANGE_RATETYPE:console.log("璁剧疆鍒嗚鲸鐜�",t),this.viewComponent.switchVideo(t);break;case f.H5Notification.SKIN_CHANGE_SPEED:console.log("璁剧疆閫熷害",t),this.viewComponent.speed=t;break;case f.H5Notification.SKIN_CHANGE_VOLUME:console.log("璁剧疆闊抽噺",t),this.viewComponent.volume=t;break;case f.H5Notification.SKIN_REPLAY:console.log("replay--"),this.viewComponent.playVideo();break;case f.H5Notification.SKIN_MUTED:console.log("muted--"),this.viewComponent.setMuted(t.bl)}}},{key:"onVideoHandler",value:function(e){var t=e.data;switch(e.type){case d.H5ComponentEvent.WEB_PLAY:this.facade.retrieveProxy(c.default.NAME).loadData();break;case d.H5ComponentEvent.VIDEO_UPDATE:this.sendNotification(f.H5Notification.VIDEO_UPDATE,t);break;case d.H5ComponentEvent.VIDEO_STATE:this.sendNotification(f.H5Notification.VIDEO_STATE,t);break;case d.H5ComponentEvent.VIDEO_WAITING:this.sendNotification(f.H5Notification.VIDEO_WAITING,t);break;case d.H5ComponentEvent.PLAY_ERROR:this.sendNotification(f.H5Notification.PLAY_ERROR,t);break;case d.H5ComponentEvent.VIDEO_ERROR:this.sendNotification(f.H5Notification.VIDEO_ERROR,t);break;case d.H5ComponentEvent.HIDE_UI:this.sendNotification(f.H5Notification.VIDEO_HIDE_UI,t);break;case d.H5ComponentEvent.VIDEO_BIP:h.default.postMessage(p.ExternalEvent.VIDEO_BIP,t);break;case d.H5ComponentEvent.SHOW_SPEED_UI:this.sendNotification(f.H5Notification.VIDEO_SHOW_SPEED_UI,t);break;case d.H5ComponentEvent.SET_MUTE:this.sendNotification(f.H5Notification.VIDEO_SET_MUTE,t);break;case d.H5ComponentEvent.VIDEO_SHOW_RECO:this.sendNotification(f.H5Notification.VIDEO_SHOW_RECO,t)}}},{key:"externalHandler",value:function(e,t){switch(v.default.debug("澶栭儴璋冪敤鎺ュ彛"+e+","+t),e){case f.ExternalApiType.VIDEO_VOLUME:this.viewComponent.volume=t.volume||.5;break;case f.ExternalApiType.VIDEO_SWITCH:this.viewComponent.switchVideo(t.rateType);break;case f.ExternalApiType.VIDEO_FULLSCREEN:this.viewComponent.appleFullScreen();break;case f.ExternalApiType.VIDEO_PLAY:this.viewComponent.playVideo(t.id)}}},{key:"onRemove",value:function(){this.setViewComponent(null)}}]),t}(l.default.Mediator);m.NAME="pc_video_mediator",t.default=m},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=_(i(2)),r=_(i(0)),a=_(i(1)),o=_(i(3)),s=_(i(4)),l=_(i(34)),u=i(19),d=i(6),f=i(32),c=i(13),h=i(27),p=_(i(7)),v=_(i(33)),y=_(i(17)),g=i(18),m=i(69),E=i(184);function _(e){return e&&e.__esModule?e:{default:e}}var T=function(e){function t(e){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"init",value:function(){this.player=(0,f.$)(d.H5Common.container).find(".m-player"),this.modPlayer=(0,f.$)(d.H5Common.container).find(".mod-player"),this.initError=!1,this.player.length||(p.default.debug("video鏍囩涓嶅瓨鍦�"),this.initError=!0),this.scale=160/90,this.initError||(this.dispatchEvent(u.H5ComponentEvent.WEB_PLAY),this.video=this.player[0],this.video.removeAttribute("controls"),this.videoWH={ow:d.H5Common.ow,oh:Math.round(9*d.H5Common.ow/16)},this.resize(),this.initObserver(),this.preWatchTime=0,c.playerInfo.autoplay=!0,c.playerInfo.switchVideo=!1)}},{key:"setPlayData",value:function(e){if(e&&e.url){this.showPay=!1,this.playData=e,this.canplay=!1,this.watchTime=0,this.watchInter=-1,(0,f.$)(this.video).show(),c.playerInfo.rateType=e.rateType,c.playerInfo.status=c.playStatus.PAUSE,c.playerInfo.url=this.replaceUrl(e.url);var t=this.video.playbackRate;if(t){var i=v.default.remeberSpeed();i&&(this.video.playbackRate=t=i),c.playerInfo.playbackRate=t,this.video.url||this.dispatchEvent(u.H5ComponentEvent.SHOW_SPEED_UI,{status:c.playerInfo.playbackRate,speed:t,rSpeed:i})}var n=this;if(c.playType.VOD==c.playerInfo.playType){var r=v.default.remeberPosi(c.playerInfo.cid);r&&(d.H5Common.pay&&!h.userInfo.isVip&&r>360||(c.playerInfo.posi=r))}if(c.playerInfo.url.indexOf(".m3u8")>0)if(Hls.isSupported()){var a="debug"===v.default.getQueryString("player"),o=new Hls({debug:a});window.location.href.indexOf("fangdao")>-1&&(c.playerInfo.url="http://testvod.migucloud.com/live/zjrtest0508/index.m3u8"),o.loadSource(c.playerInfo.url),o.attachMedia(this.video),o.on(Hls.Events.MANIFEST_PARSED,function(){n.initPlay()})}else this.dispatchEvent(u.H5ComponentEvent.VIDEO_ERROR,{code:3005,msg:"涓嬭浇app瑙傜湅"});else this.video.src=c.playerInfo.url=e.url,this.initPlay()}else p.default.debug("鑾峰彇鎾斁鍦板潃涓虹┖")}},{key:"initPlay",value:function(){var e=this,t=this.video.play();(0,E.env)(),t&&t.then(function(){c.playerInfo.autoplay||e.video.pause(),e.video.muted||(e.setMuted(!1),e.dispatchEvent(u.H5ComponentEvent.SET_MUTE,{bl:!1}),e.remeberAll())}).catch(function(t){c.playerInfo.autoplay?(e.setMuted(!0),e.video.play(),e.dispatchEvent(u.H5ComponentEvent.SET_MUTE,{bl:!0}),e.remeberAll()):e.video.pause()})}},{key:"remeberAll",value:function(){if(c.playType.VOD==c.playerInfo.playType){var e=v.default.remeberPosi(c.playerInfo.cid);e&&(d.H5Common.pay&&!h.userInfo.isVip&&e>360||this.seekVideo(e))}this.video.playbackRate=c.playerInfo.playbackRate}},{key:"replaceUrl",value:function(e){var t="";return c.playerInfo.playType==c.playType.LIVE||c.playerInfo.playType==c.playType.HUIKAN?(t="h5live.gslb.cmvideo.cn",e.indexOf("gslbmgsplive.miguvideo.com")>-1&&(t="gslbmgsplive.miguvideo.com"),e.replace(t,"live.hcs.cmvideo.cn:8088")):(t="h5vod.gslb.cmvideo.cn",e.indexOf("gslbmgspvod.miguvideo.com")>-1&&(t="gslbmgspvod.miguvideo.com"),e.replace(t,"vod.hcs.cmvideo.cn:8088"))}},{key:"initPlayerInfo",value:function(){c.playerInfo.posi=0,c.playerInfo.buffered=0,c.playerInfo.start=!1,c.playerInfo.end=!1,c.playerInfo.switchVideo=!1}},{key:"playVideo",value:function(e){e?(this.video.pause(),this.initPlayerInfo(),c.playerInfo.cid=e,c.playerInfo.next=!0,(0,m.createClientID)(),this.dispatchEvent(u.H5ComponentEvent.WEB_PLAY)):c.playerInfo.status==c.playStatus.PAUSE?this.video.play():c.playerInfo.status==c.playStatus.END&&((0,m.createClientID)(),this.video.currentTime=0,this.showPay=!1,this.video.play())}},{key:"stopVideo",value:function(){c.playerInfo.status=c.playStatus.END,c.playerInfo.end=!0,c.playerInfo.posi=0,c.playerInfo.buffered=0,this.preWatchTime=0,c.playerInfo.start=!1,this.watchTime=0,this.watchInter>-1&&(window.clearInterval(this.watchInter),this.watchInter=-1),this.dispatchEvent(u.H5ComponentEvent.VIDEO_STATE,{status:c.playerInfo.status})}},{key:"changePlayStatus",value:function(e){e==c.playStatus.PAUSE?this.video.pause():this.video.play()}},{key:"switchVideo",value:function(e){p.default.debug("褰撳墠鐮佹祦<<<"+c.playerInfo.rateType+",闇€鍒囨崲鐨勭爜娴�<<"+e);var t=d.H5Common.playData.urlInfos[e];if(e!=c.playerInfo.rateType){var i=0;c.playerInfo.status!=c.playStatus.END&&(i=this.video.currentTime),t?(c.playerInfo.switchVideo=!0,this.stopVideo(),(0,m.createClientID)(),this.setPlayData(t),this.preWatchTime=i,this.playVideo(),this.dispatchEvent(u.H5ComponentEvent.HIDE_UI)):p.default.debug("<<<<<<闇€鍒囨崲鐨勭爜娴佹棤瀵瑰簲鐨勫湴鍧€淇℃伅")}else c.playerInfo.status==c.playStatus.END&&((0,m.createClientID)(),this.playVideo(),this.dispatchEvent(u.H5ComponentEvent.HIDE_UI))}},{key:"resize",value:function(){this.scale=this.videoWH.oh/this.videoWH.ow}},{key:"changeSpeed",value:function(){}},{key:"initObserver",value:function(){var e=this;this.player.on("loadstart",function(t){return e.loadStart(t)}),this.player.on("loadedmetadata loadeddata durationchange",function(t){return e.loadData(t)}),this.player.on("canplaythrough",function(t){return e.canplaythrough(t)}),this.player.on("seeking waiting  stalled",function(t){return e.waiting(t)}),this.player.on("timeupdate",v.default.throttle(function(t){e.timeupdate(t)},1e3)),this.player.on("ended",function(t){return e.ended(t)}),this.player.on("pause",function(t){return e.pause(t)}),this.player.on("playing",function(t){return e.playing(t)}),this.player.on("abort error",function(t){return e.error(t)})}},{key:"loadStart",value:function(e){p.default.debug("褰撳墠鎺ユ敹浜嬩欢 ==>> ",e.type)}},{key:"loadData",value:function(e){p.default.debug("褰撳墠鎺ユ敹浜嬩欢 ==>> ",e.type),"loadedmetadata"==e.type&&(this.videoWH={width:this.video.videoWidth,height:this.video.videoHeight},this.resize()),this.getDuration()}},{key:"getDuration",value:function(){var e=this.video.duration;isNaN(e)||e==Number.POSITIVE_INFINITY?p.default.debug("褰撳墠duration ==>> "+e+",閰嶇疆鏂囦欢鐨刣uration="+c.playerInfo.duration):(c.playerInfo.duration=this.video.duration,p.default.debug("褰撳墠duration ==>> "+e+",閰嶇疆鏂囦欢鐨刣uration="+c.playerInfo.duration))}},{key:"canplaythrough",value:function(e){p.default.debug("褰撳墠鎺ユ敹浜嬩欢canplaythrough ==>> ",e.type),this.canplay||(this.canplay=!0,this.preWatchTime>0&&(this.video.currentTime=this.preWatchTime,p.default.debug("this.video.currentTime ==>> ",this.preWatchTime)))}},{key:"waiting",value:function(e){p.default.debug("褰撳墠鎺ユ敹浜嬩欢 ==>> ",e.type),"seeking"!=e.type&&"waiting"!=e.type||this.dispatchEvent(u.H5ComponentEvent.VIDEO_WAITING)}},{key:"timeupdate",value:function(e){var t=this;if(c.playerInfo.status!=c.playStatus.END||0==this.video.currentTime){c.playerInfo.posi=this.video.currentTime;var i=-1,n=0;try{n=this.video.buffered.end(0)}catch(e){}if(c.playerInfo.buffered!==n&&(i=n,c.playerInfo.buffered=n),this.watchInter<0&&(this.sendSDBip(),this.watchInter=setInterval(function(){var e=c.playerInfo.status==c.playStatus.PLAYING?d.H5Common.heartDuration:0,i={dt:"online",data:{wt:{watchTime:1e3*t.watchTime,duration:Math.floor(1e3*c.playerInfo.duration),curTime:Math.floor(1e3*c.playerInfo.posi),heartDuration:e}}};c.playerInfo.playType==c.playType.VOD&&v.default.remeberPosi(c.playerInfo.cid,c.playerInfo.posi),t.sendBip(i)},d.H5Common.heartDuration)),this.watchTime++,d.H5Common.pay&&!h.userInfo.isVip&&c.playerInfo.posi>c.playerInfo.shikantime){if(this.showPay)return;return this.video.pause(),c.playerInfo.playType==c.playType.VOD&&v.default.remeberPosi(c.playerInfo.cid,-1),this.stopVideo(),this.showPay=!0,this.dispatchEvent(u.H5ComponentEvent.VIDEO_ERROR,{code:412,msg:"寮€閫氫細鍛�"}),void y.default.postMessage(g.ExternalEvent.VIDEO_STATUS,g.playerStatusType.VIDEO_END)}var r={};if(c.playerInfo.playType==c.playType.VOD)r.start=0,r.end=c.playerInfo.duration||0,r.posi=c.playerInfo.posi,c.playerInfo.duration-c.playerInfo.posi<15&&(this.abnormal=!0);else if(c.playerInfo.playType==c.playType.HUIKAN)r.start=c.playerInfo.sTime/1e3,r.end=c.playerInfo.eTime/1e3,r.posi=c.playerInfo.posi,c.playerInfo.duration-c.playerInfo.posi<15&&(this.abnormal=!0);else{var a=d.H5Common.timestamp;r.live=a+1e3*c.playerInfo.posi}r.buffered=i,this.dispatchEvent(u.H5ComponentEvent.VIDEO_UPDATE,r)}}},{key:"ended",value:function(e){p.default.debug("褰撳墠鎺ユ敹浜嬩欢 ==>> ",e.type),c.playerInfo.playType==c.playType.VOD&&v.default.remeberPosi(c.playerInfo.cid,-1),this.stopVideo(),this.dispatchEvent(u.H5ComponentEvent.VIDEO_SHOW_RECO),y.default.postMessage(g.ExternalEvent.VIDEO_STATUS,g.playerStatusType.VIDEO_END)}},{key:"pause",value:function(e){if(p.default.debug("褰撳墠鎺ユ敹浜嬩欢 ==>> ",e.type),c.playerInfo.status!==c.playStatus.END){if(c.playerInfo.status=c.playStatus.PAUSE,!c.playerInfo.start)return;this.dispatchEvent(u.H5ComponentEvent.VIDEO_STATE,{status:c.playerInfo.status}),y.default.postMessage(g.ExternalEvent.VIDEO_STATUS,g.playerStatusType.VIDEO_PAUSE)}}},{key:"playing",value:function(e){c.playerInfo.start||(c.playerInfo.start=!0),p.default.debug("褰撳墠鎺ユ敹浜嬩欢 ==>> ",e.type),c.playerInfo.status=c.playStatus.PLAYING,this.dispatchEvent(u.H5ComponentEvent.VIDEO_STATE,{status:c.playerInfo.status}),y.default.postMessage(g.ExternalEvent.VIDEO_STATUS,g.playerStatusType.VIDEO_PLAYING)}},{key:"error",value:function(e){if(p.default.debug("video璇锋眰鍑洪敊 >>>>>>",e.type),"error"==e.type&&(this.stopVideo(),this.video.error&&this.video.error.code)){var t={};switch(t.code=this.video.error.code,t.msg="video鎾斁鍑洪敊",t.code){case 1:t.msg="鍙栧洖杩囩▼琚敤鎴蜂腑姝�";break;case 2:t.msg="涓嬭浇鍑洪敊";break;case 3:t.msg="瑙ｇ爜閿欒";break;case 4:t.msg="涓嶆敮鎸侀煶棰�/瑙嗛"}t.code=d.H5Common.callCode.video[Number(t.code)],this.dispatchEvent(u.H5ComponentEvent.VIDEO_ERROR,t)}}},{key:"seekVideo",value:function(e){e<=c.playerInfo.duration&&(this.video.currentTime=e,this.sendBip({dt:"act",data:{type:"seek"}}))}},{key:"sendSDBip",value:function(){var e={dt:"sd",data:{cid:c.playerInfo.cid,sessionID:d.H5Common.clientID,rateType:c.playerInfo.rateType}};p.default.debug("鎶ユ枃sd<<<<",e),this.sendBip(e)}},{key:"sendBip",value:function(e){this.dispatchEvent(u.H5ComponentEvent.VIDEO_BIP,e)}},{key:"setMuted",value:function(e){this.video.muted=e}},{key:"volume",set:function(e){e>100?e=100:e<0&&(e=0),c.playerInfo.volume=e,this.video.volume=e/100}},{key:"speed",set:function(e){c.playerInfo.playbackRate=e,this.video.playbackRate=e,v.default.remeberSpeed(e)}}]),t}(l.default);t.default=T},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.env=function(){var e=navigator.userAgent,t={browser:{},os:{},phone:{},mobile:!1};(e=e.toLowerCase()).indexOf("mobile")>-1&&(t.mobile=!0);var i=void 0,n=void 0,r={android_1:/android[\s\/]([\d\.]+)/i,android_2:/android/i,android_3:/MIDP-/i,ipod_1:/iPod\stouch;\sCPU\siPhone\sos\s([\d_]+)/i,ipod_100:/iPod.*os\s?([\d_\.]+)/i,iphone:/iPhone;\sCPU\siPhone\sos\s([\d_]+)/i,iphone_100:/iPhone.*os\s?([\d_\.]+)/i,ipad_1:/ipad;\scpu\sos\s([\d_]+)/i,ipad_2:/ipad([\d]+)?/i,windows:/windows\snt\s([\d\.]+)/i,mac:/Macintosh.*mac\sos\sx\s([\d_\.]+)/i,linux:/Linux/i};for(var a in r)if(i=r[a].exec(e)){n=a.replace(/_\d+/,""),t.os[n]=!0,t.os.name=n,i[1]&&(t.os.version=i[1].replace(/_/g,"."));break}(t.os.iphone||t.os.ipad||t.os.ipod)&&(t.os.ios=!0);var o,s,l={wechat:/MicroMessenger\/([\d\.]+)/i,ipadqq:/IPadQQ\/([\d\.]+)/i,mqq:/qq\/([\d\.]+)/i,qzone:/QZONEJSSDK\/([\d\.]+)/i,mqqbrowser:/mqqbrowser\/([\d\.]+)/i,qqbrowser:/[^m]QQBrowser\/([\d\.]+)/i,x5:/tbs\/(\d+)/i,uc:/UCBrowser\/([\d\.]+)/i,safari_1:/Version\/(([\d\.]+))\sSafari\/[\d\.]+/i,safari_2:/Safari\/([\d\.]+)/i,firefox:/Firefox\/([\d\.]+)/i,opera:/OPR\/([\d\.]+)/i,ie_1:/MSIE\s([\d\.]+)/i,ie_2:/(trident\/\d\.\d)/i,ie_3:/(Edge)\/\d+\.\d+/i,weibo:/weibo__([\d\.]+)/i,qqnewsAd:/TADChid\/([\d\.]+)/i,qqnews:/qqnews\/([\d\.]+)/i,qqlive_1:/QQLiveBrowser\/([\d\.]+)/i,qqlive_2:/QQLiveHDBrowser\/([\d\.]+)/i,kuaibao:/qnreading\/([\d\.]+)/i,liebao:/LieBaoFast\/([\d\.]+)/i,douban:/com\.douban\.frodo\/([\d\.]+)/i,miuibrowser:/MiuiBrowser/i,baidu:/baiduboxapp/i,browser360:/360browser/i,oppobrowser:/OppoBrowser/i,chrome_1:/CriOS\/([\d\.]+)/i,chrome_2:/Chrome\/([\d\.]+)/i,qqdownloader:/qqdownloader\/([\d\.]+)/i};function u(e){var t=e.version.split(".");e.major=parseInt(e.version,10),t.length>1&&(e.minor=parseInt(t[1],10)),t.length>2&&(e.build=parseInt(t[2],10))}for(var d in l)if(o=l[d].exec(e)){if(s=d.replace(/_\d+/,""),t.browser[s])return;t.browser[s]={version:o[1]},u(t.browser[s])}t.os.android&&t.browser.safari&&delete t.browser.safari,t.browser.chrome&&t.browser.safari&&delete t.browser.safari,t.browser.ie&&t.browser.ie.version&&t.browser.ie.version.indexOf("trident")>-1&&(t.browser.ie.version.indexOf("6.0")>-1?t.browser.ie.version="10":t.browser.ie.version.indexOf("5.0")>-1?t.browser.ie.version="9":t.browser.ie.version.indexOf("4.0")>-1?t.browser.ie.version="8":t.browser.ie.version="11");var f,c={ipod:/iPod/i,ipad:/iPad/i,iphone:/iPhone/i,huawei_1:/HUAWEI([\w_-]+)/i,huawei_2:/(CHM-\w+)/i,huawei_3:/(HonorChe)/i,huawei_4:/HONORPLK/i,huawei_5:/(Che\d+-CL\d+)/i,huawei_6:/(H\d+-L\d+)/i,huawei_100:/HUAWEI/i,xiaomi_1:/(HM\sNOTE)/i,xiaomi_2:/(HM\s\w+)/i,xiaomi_3:/(MI\s\w+)/i,xiaomi_4:/(MI-ONE\sPlus)/i,xiaomi_5:/(M1)\sBuild/i,xiaomi_6:/(HM\d+)/i,xiaomi_7:/Xiaomi[\s_]?([\w_]+)/i,samsung_1:/(GT-\w+)/i,samsung_2:/(SCH-\w+)/i,samsung_3:/(SM-\w+)/i,vivo:/vivo\s(\w+)/i,oneplus:/ONEPLUS-([a-z0-9]+)/i,lenovo_1:/Lenovo[\s-]?([\w-]+)/i,lenovo_100:/Lenovo/i,zte_1:/ZTE\s?(\w+)?/i,zte_2:/ZTE/i,coolpad_1:/Coolpad\s(\w+)/i,coolpad_100:/Coolpad/i,oppo_1:/OPPO\s?(\w+)/i,oppo_2:/(R7Plus|R8007|R801|R831S|R8205)/i,oppo_100:/OPPO/i,meizu_1:/(MX\d+)/i,meizu_2:/(m\d+\snote)\sBuild/i,htc_1:/HTC\s?(\w+)/i,htc_100:/HTC/i,tcl:/TCL\s(\w+)/i,lephone:/lephone\s(\w+)/i,lg:/LG[\s-]?(\w+)/i,galaxy:/(galaxy\d+)/,hisense_1:/Hisense/i,hisense_2:/HS-(\w+)/i,philips:/Philips\s?(\w+)?/i,"閲戠珛":/(GN\w+)\sBuild/i,sonny:/sonny/i,"澶╄":/K-Touch/i};for(var h in c)if(f=c[h].exec(e)){t.phone.name=h.replace(/_\d+/,""),f[1]&&(t.phone.version=f[1].replace(/^[_-]/gi,""));break}return t.browser&&(t.mobile=!0),t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(i(2)),r=f(i(0)),a=f(i(1)),o=f(i(3)),s=f(i(4)),l=f(i(8)),u=f(i(186)),d=(i(19),i(16));function f(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"onRegister",value:function(){this.setViewComponent(new u.default)}},{key:"handleEvent",value:function(e,t){this.viewComponent}},{key:"listNotificationInterests",value:function(){return[d.H5Notification.ADS_STATUS,d.H5Notification.ADV_EVENT]}},{key:"handleNotification",value:function(e){}},{key:"onRemove",value:function(){this.setViewComponent(null)}}]),t}(l.default.Mediator);c.NAME="pc_adv_mediator",t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(i(2)),r=s(i(0)),a=s(i(3)),o=s(i(4));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){return(0,r.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,o.default)(t,e),t}(s(i(34)).default);t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(i(22)),r=u(i(101)),a=u(i(0)),o=u(i(1)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(102)),l=u(i(194));function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(){var t;(0,a.default)(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=(t={},(0,r.default)(t,e.ElementaryStreamTypes.AUDIO,!1),(0,r.default)(t,e.ElementaryStreamTypes.VIDEO,!1),t)}return(0,o.default)(e,[{key:"addElementaryStream",value:function(e){this._elementaryStreams[e]=!0}},{key:"hasElementaryStream",value:function(e){return!0===this._elementaryStreams[e]}},{key:"createInitializationVector",value:function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,t){var i=e;return e&&e.method&&e.uri&&!e.iv&&((i=new l.default).method=e.method,i.baseuri=e.baseuri,i.reluri=e.reluri,i.iv=this.createInitializationVector(t)),i}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=s.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var e=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var i=this.lastByteRangeEndOffset;e[0]=i||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0],this._byteRange=e}return e}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}},{key:"endProgramDateTime",get:function(){if(!(0,n.default)(this.programDateTime))return null;var e=(0,n.default)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}],[{key:"ElementaryStreamTypes",get:function(){return{AUDIO:"audio",VIDEO:"video"}}}]),e}();t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(i(0)),r=f(i(1)),a=f(i(229)),o=f(i(230)),s=f(i(231)),l=i(21),u=i(9),d=f(i(11));function f(e){return e&&e.__esModule?e:{default:e}}var c=(0,i(99).getSelfScope)(),h=function(){function e(t,i){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).removePKCS7Padding,a=void 0===r||r;if((0,n.default)(this,e),this.logEnabled=!0,this.observer=t,this.config=i,this.removePKCS7Padding=a,a)try{var o=c.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}return(0,r.default)(e,[{key:"isSync",value:function(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function(e,t,i,n){var r=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(u.logger.log("JS AES decrypt"),this.logEnabled=!1);var l=this.decryptor;l||(this.decryptor=l=new s.default),l.expandKey(t),n(l.decrypt(e,0,i,this.removePKCS7Padding))}else{this.logEnabled&&(u.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var d=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new o.default(d,t)),this.fastAesKey.expandKey().then(function(o){new a.default(d,i).decrypt(e,o).catch(function(a){r.onWebCryptoError(a,e,t,i,n)}).then(function(e){n(e)})}).catch(function(a){r.onWebCryptoError(a,e,t,i,n)})}}},{key:"onWebCryptoError",value:function(e,t,i,n,r){this.config.enableSoftwareAES?(u.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,i,n,r)):(u.logger.error("decrypting error : "+e.message),this.observer.trigger(d.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}},{key:"destroy",value:function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)}}]),e}();t.default=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMediaSource=function(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=i(22))&&n.__esModule?n:{default:n};t.addGroupId=function(e,t,i){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(i);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(i)}},t.updatePTS=o,t.updateFragPTSDTS=s,t.mergeDetails=function(e,t){var i=Math.max(e.startSN,t.startSN)-t.startSN,n=Math.min(e.endSN,t.endSN)-t.startSN,o=t.startSN-e.startSN,l=e.fragments,u=t.fragments,d=0,f=void 0;if(t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment),n<i)t.PTSKnown=!1;else{for(var c=i;c<=n;c++){var h=l[o+c],p=u[c];p&&h&&(d=h.cc-p.cc,(0,r.default)(h.startPTS)&&(p.start=p.startPTS=h.startPTS,p.endPTS=h.endPTS,p.duration=h.duration,p.backtracked=h.backtracked,p.dropped=h.dropped,f=p))}if(d)for(a.logger.log("discontinuity sliding from playlist, take drift into account"),c=0;c<u.length;c++)u[c].cc+=d;if(f)s(t,f,f.startPTS,f.endPTS,f.startDTS,f.endDTS);else if(o>=0&&o<l.length){var v=l[o].start;for(c=0;c<u.length;c++)u[c].start+=v}t.PTSKnown=e.PTSKnown}};var a=i(9);function o(e,t,i){var n=e[t],o=e[i],s=o.startPTS;(0,r.default)(s)?i>t?(n.duration=s-n.start,n.duration<0&&a.logger.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(o.duration=n.start-s,o.duration<0&&a.logger.warn("negative duration computed for frag "+o.sn+",level "+o.level+", there should be some duration drift between playlist and fragment!")):o.start=i>t?n.start+n.duration:Math.max(n.start-o.duration,0)}function s(e,t,i,n,a,s){var l=i;if((0,r.default)(t.startPTS)){var u=Math.abs(t.startPTS-i);(0,r.default)(t.deltaPTS)?t.deltaPTS=Math.max(u,t.deltaPTS):t.deltaPTS=u,l=Math.max(i,t.startPTS),i=Math.min(i,t.startPTS),n=Math.max(n,t.endPTS),a=Math.min(a,t.startDTS),s=Math.max(s,t.endDTS)}var d=i-t.start;t.start=t.startPTS=i,t.maxStartPTS=l,t.endPTS=n,t.startDTS=a,t.endDTS=s,t.duration=n-i;var f=t.sn;if(!e||f<e.startSN||f>e.endSN)return 0;var c,h=void 0,p=void 0;for(c=f-e.startSN,(h=e.fragments)[c]=t,p=c;p>0;p--)o(h,p,p-1);for(p=c;p<h.length-1;p++)o(h,p,p+1);return e.PTSKnown=!0,d}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(i(2)),r=l(i(0)),a=l(i(1)),o=l(i(3)),s=l(i(4));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){var i;(0,r.default)(this,t);for(var a=arguments.length,s=Array(a>1?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];var u=(0,o.default)(this,(i=t.__proto__||(0,n.default)(t)).call.apply(i,[this,e].concat(s)));return u._tickInterval=null,u._tickTimer=null,u._tickCallCount=0,u._boundTick=u.tick.bind(u),u}return(0,s.default)(t,e),(0,a.default)(t,[{key:"onHandlerDestroying",value:function(){this.clearNextTick(),this.clearInterval()}},{key:"hasInterval",value:function(){return!!this._tickInterval}},{key:"hasNextTick",value:function(){return!!this._tickTimer}},{key:"setInterval",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,e),!0)})},{key:"clearInterval",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)})},{key:"clearNextTick",value:function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)}},{key:"tick",value:function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)}},{key:"doTick",value:function(){}}]),t}(l(i(29)).default);t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=y(i(22)),r=y(i(2)),a=y(i(0)),o=y(i(1)),s=y(i(3)),l=y(i(72)),u=y(i(4)),d=y(i(11)),f=y(i(29)),c=i(21),h=i(9),p=y(i(193)),v=y(i(219));function y(e){return e&&e.__esModule?e:{default:e}}var g=window.performance,m={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},E={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},_=function(e){function t(e){(0,a.default)(this,t);var i=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,d.default.MANIFEST_LOADING,d.default.LEVEL_LOADING,d.default.AUDIO_TRACK_LOADING,d.default.SUBTITLE_TRACK_LOADING));return i.loaders={},i}return(0,u.default)(t,e),(0,o.default)(t,[{key:"createInternalLoader",value:function(e){var t=this.hls.config,i=t.pLoader,n=t.loader,r=new(i||n)(t);return e.loader=r,this.loaders[e.type]=r,r}},{key:"getInternalLoader",value:function(e){return this.loaders[e.type]}},{key:"resetInternalLoader",value:function(e){this.loaders[e]&&delete this.loaders[e]}},{key:"destroyInternalLoaders",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}},{key:"destroy",value:function(){this.destroyInternalLoaders(),(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"destroy",this).call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,{type:m.MANIFEST,level:0,id:null})}},{key:"onLevelLoading",value:function(e){this.load(e.url,{type:m.LEVEL,level:e.level,id:e.id})}},{key:"onAudioTrackLoading",value:function(e){this.load(e.url,{type:m.AUDIO_TRACK,level:null,id:e.id})}},{key:"onSubtitleTrackLoading",value:function(e){this.load(e.url,{type:m.SUBTITLE_TRACK,level:null,id:e.id})}},{key:"load",value:function(e,t){var i=this.hls.config;h.logger.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var n=this.getInternalLoader(t);if(n){var r=n.context;if(r&&r.url===e)return h.logger.trace("playlist request ongoing"),!1;h.logger.warn("aborting previous loader for type: "+t.type),n.abort()}var a=void 0,o=void 0,s=void 0,l=void 0;switch(t.type){case m.MANIFEST:a=i.manifestLoadingMaxRetry,o=i.manifestLoadingTimeOut,s=i.manifestLoadingRetryDelay,l=i.manifestLoadingMaxRetryTimeout;break;case m.LEVEL:a=0,o=i.levelLoadingTimeOut;break;default:a=i.levelLoadingMaxRetry,o=i.levelLoadingTimeOut,s=i.levelLoadingRetryDelay,l=i.levelLoadingMaxRetryTimeout}n=this.createInternalLoader(t),t.url=e,t.responseType=t.responseType||"";var u={timeout:o,maxRetry:a,retryDelay:s,maxRetryDelay:l},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return h.logger.debug("Calling internal loader delegate for URL: "+e),n.load(t,u,d),!0}},{key:"loadsuccess",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i.isSidxRequest)return this._handleSidxRequest(e,i),void this._handlePlaylistLoaded(e,t,i,n);this.resetInternalLoader(i.type);var r=e.data;t.tload=g.now(),0===r.indexOf("#EXTM3U")?r.indexOf("#EXTINF:")>0||r.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,i,n):this._handleMasterPlaylist(e,t,i,n):this._handleManifestParsingError(e,i,"no EXTM3U delimiter",n)}},{key:"loaderror",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,i,!1,e)}},{key:"loadtimeout",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,i,!0)}},{key:"_handleMasterPlaylist",value:function(e,i,n,r){var a=this.hls,o=e.data,s=t.getResponseUrl(e,n),l=v.default.parseMasterPlaylist(o,s);if(l.length){var u=l.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),f=v.default.parseMasterPlaylistMedia(o,s,"AUDIO",u),c=v.default.parseMasterPlaylistMedia(o,s,"SUBTITLES");if(f.length){var p=!1;f.forEach(function(e){e.url||(p=!0)}),!1===p&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(h.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),f.unshift({type:"main",name:"main"}))}a.trigger(d.default.MANIFEST_LOADED,{levels:l,audioTracks:f,subtitles:c,url:s,stats:i,networkDetails:r})}else this._handleManifestParsingError(e,n,"no level found in manifest",r)}},{key:"_handleTrackOrLevelPlaylist",value:function(e,i,r,a){var o=this.hls,s=r.id,l=r.level,u=r.type,f=t.getResponseUrl(e,r),c=(0,n.default)(s)?s:0,h=(0,n.default)(l)?l:c,p=t.mapContextToLevelType(r),y=v.default.parseLevelPlaylist(e.data,f,h,p,c);if(y.tload=i.tload,u===m.MANIFEST){var E={url:f,details:y};o.trigger(d.default.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:f,stats:i,networkDetails:a})}if(i.tparsed=g.now(),y.needSidxRanges){var _=y.initSegment.url;this.load(_,{isSidxRequest:!0,type:u,level:l,levelDetails:y,id:s,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else r.levelDetails=y,this._handlePlaylistLoaded(e,i,r,a)}},{key:"_handleSidxRequest",value:function(e,t){var i=p.default.parseSegmentIndex(new Uint8Array(e.data));if(i){var n=i.references,r=t.levelDetails;n.forEach(function(e,t){var i=e.info,n=r.fragments[t];0===n.byteRange.length&&(n.rawByteRange=String(1+i.end-i.start)+"@"+String(i.start))}),r.initSegment.rawByteRange=String(i.moovEndOffset)+"@0"}}},{key:"_handleManifestParsingError",value:function(e,t,i,n){this.hls.trigger(d.default.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:i,networkDetails:n})}},{key:"_handleNetworkError",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;h.logger.info("A network error occured while loading a "+e.type+"-type playlist");var r=void 0,a=void 0,o=this.getInternalLoader(e);switch(e.type){case m.MANIFEST:r=i?c.ErrorDetails.MANIFEST_LOAD_TIMEOUT:c.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case m.LEVEL:r=i?c.ErrorDetails.LEVEL_LOAD_TIMEOUT:c.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case m.AUDIO_TRACK:r=i?c.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;default:a=!1}o&&(o.abort(),this.resetInternalLoader(e.type));var s={type:c.ErrorTypes.NETWORK_ERROR,details:r,fatal:a,url:o.url,loader:o,context:e,networkDetails:t};n&&(s.response=n),this.hls.trigger(d.default.ERROR,s)}},{key:"_handlePlaylistLoaded",value:function(e,i,n,r){var a=n.type,o=n.level,s=n.id,l=n.levelDetails;if(l.targetduration)if(t.canHaveQualityLevels(n.type))this.hls.trigger(d.default.LEVEL_LOADED,{details:l,level:o||0,id:s||0,stats:i,networkDetails:r});else switch(a){case m.AUDIO_TRACK:this.hls.trigger(d.default.AUDIO_TRACK_LOADED,{details:l,id:s,stats:i,networkDetails:r});break;case m.SUBTITLE_TRACK:this.hls.trigger(d.default.SUBTITLE_TRACK_LOADED,{details:l,id:s,stats:i,networkDetails:r})}else this._handleManifestParsingError(e,n,"invalid target duration",r)}}],[{key:"canHaveQualityLevels",value:function(e){return e!==m.AUDIO_TRACK&&e!==m.SUBTITLE_TRACK}},{key:"mapContextToLevelType",value:function(e){switch(e.type){case m.AUDIO_TRACK:return E.AUDIO;case m.SUBTITLE_TRACK:return E.SUBTITLE;default:return E.MAIN}}},{key:"getResponseUrl",value:function(e,t){var i=e.url;return void 0!==i&&0!==i.indexOf("data:")||(i=t.url),i}},{key:"ContextType",get:function(){return m}},{key:"LevelType",get:function(){return E}}]),t}(f.default);t.default=_},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(i(0)),r=s(i(1)),a=i(9),o=s(i(11));function s(e){return e&&e.__esModule?e:{default:e}}var l=Math.pow(2,32)-1,u=function(){function e(t,i){(0,n.default)(this,e),this.observer=t,this.remuxer=i}return(0,r.default)(e,[{key:"resetTimeStamp",value:function(e){this.initPTS=e}},{key:"resetInitSegment",value:function(t,i,n,r){if(t&&t.byteLength){var a=this.initData=e.parseInitSegment(t);null==i&&(i="mp4a.40.5"),null==n&&(n="avc1.42e01e");var s={};a.audio&&a.video?s.audiovideo={container:"video/mp4",codec:i+","+n,initSegment:r?t:null}:(a.audio&&(s.audio={container:"audio/mp4",codec:i,initSegment:r?t:null}),a.video&&(s.video={container:"video/mp4",codec:n,initSegment:r?t:null})),this.observer.trigger(o.default.FRAG_PARSING_INIT_SEGMENT,{tracks:s})}else i&&(this.audioCodec=i),n&&(this.videoCodec=n)}},{key:"append",value:function(t,i,n,r){var a=this.initData;a||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),a=this.initData);var s,l=this.initPTS;if(void 0===l){var u=e.getStartDTS(a,t);this.initPTS=l=u-i,this.observer.trigger(o.default.INIT_PTS_FOUND,{initPTS:l})}e.offsetStartDTS(a,t,l),s=e.getStartDTS(a,t),this.remuxer.remux(a.audio,a.video,null,null,s,n,r,t)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0}},{key:"bin2str",value:function(e){return String.fromCharCode.apply(null,e)}},{key:"readUint16",value:function(e,t){e.data&&(t+=e.start,e=e.data);var i=e[t]<<8|e[t+1];return i<0?65536+i:i}},{key:"readUint32",value:function(e,t){e.data&&(t+=e.start,e=e.data);var i=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return i<0?4294967296+i:i}},{key:"writeUint32",value:function(e,t,i){e.data&&(t+=e.start,e=e.data),e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i}},{key:"findBox",value:function(t,i){var n=[],r=void 0,a=void 0,o=void 0,s=void 0,l=void 0,u=void 0;if(t.data?(l=t.start,o=t.end,t=t.data):(l=0,o=t.byteLength),!i.length)return null;for(r=l;r<o;)u=(a=e.readUint32(t,r))>1?r+a:o,e.bin2str(t.subarray(r+4,r+8))===i[0]&&(1===i.length?n.push({data:t,start:r+8,end:u}):(s=e.findBox({data:t,start:r+8,end:u},i.slice(1))).length&&(n=n.concat(s))),r=u;return n}},{key:"parseSegmentIndex",value:function(t){var i=e.findBox(t,["moov"])[0],n=i?i.end:null,r=0,a=e.findBox(t,["sidx"]),o=void 0;if(!a||!a[0])return null;o=[];var s=(a=a[0]).data[0];r=0===s?8:16;var l=e.readUint32(a,r);r+=4,r+=0===s?8:16,r+=2;var u=a.end+0,d=e.readUint16(a,r);r+=2;for(var f=0;f<d;f++){var c=r,h=e.readUint32(a,c);c+=4;var p=2147483647&h;if(1==(2147483648&h)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var v=e.readUint32(a,c);c+=4,o.push({referenceSize:p,subsegmentDuration:v,info:{duration:v/l,start:u,end:u+p-1}}),u+=p,r=c+=4}return{earliestPresentationTime:0,timescale:l,version:s,referencesCount:d,references:o,moovEndOffset:n}}},{key:"parseInitSegment",value:function(t){var i=[];return e.findBox(t,["moov","trak"]).forEach(function(t){var n=e.findBox(t,["tkhd"])[0];if(n){var r=n.data[n.start],o=0===r?12:20,s=e.readUint32(n,o),l=e.findBox(t,["mdia","mdhd"])[0];if(l){o=0===(r=l.data[l.start])?12:20;var u=e.readUint32(l,o),d=e.findBox(t,["mdia","hdlr"])[0];if(d){var f={soun:"audio",vide:"video"}[e.bin2str(d.data.subarray(d.start+8,d.start+12))];if(f){var c=e.findBox(t,["mdia","minf","stbl","stsd"]);if(c.length){c=c[0];var h=e.bin2str(c.data.subarray(c.start+12,c.start+16));a.logger.log("MP4Demuxer:"+f+":"+h+" found")}i[s]={timescale:u,type:f},i[f]={timescale:u,id:s}}}}}}),i}},{key:"getStartDTS",value:function(t,i){var n,r,a=void 0;return a=e.findBox(i,["moof","traf"]),n=[].concat.apply([],a.map(function(i){return e.findBox(i,["tfhd"]).map(function(n){var r,a;return r=e.readUint32(n,4),a=t[r].timescale||9e4,e.findBox(i,["tfdt"]).map(function(t){var i,n=void 0;return i=t.data[t.start],n=e.readUint32(t,4),1===i&&(n*=Math.pow(2,32),n+=e.readUint32(t,8)),n})[0]/a})})),r=Math.min.apply(null,n),isFinite(r)?r:0}},{key:"offsetStartDTS",value:function(t,i,n){e.findBox(i,["moof","traf"]).map(function(i){return e.findBox(i,["tfhd"]).map(function(r){var a=e.readUint32(r,4),o=t[a].timescale||9e4;e.findBox(i,["tfdt"]).map(function(t){var i=t.data[t.start],r=e.readUint32(t,4);if(0===i)e.writeUint32(t,4,r-n*o);else{r*=Math.pow(2,32),r+=e.readUint32(t,8),r-=n*o,r=Math.max(r,0);var a=Math.floor(r/(l+1)),s=Math.floor(r%(l+1));e.writeUint32(t,4,a),e.writeUint32(t,8,s)}})})})}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(0)),r=o(i(1)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(102));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){(0,n.default)(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return(0,r.default)(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};t.isCodecType=function(e,t){var i=n[t];return!!i&&!0===i[e.slice(0,4)]},t.isCodecSupportedInMp4=function(e,t){return window.MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=v(i(22)),r=v(i(68)),a=v(i(0)),o=v(i(1)),s=(i(197),function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(228))),l=v(i(11)),u=v(i(198)),d=i(9),f=i(21),c=i(189),h=i(99),p=i(201);function v(e){return e&&e.__esModule?e:{default:e}}var y=(0,h.getSelfScope)(),g=(0,c.getMediaSource)(),m=function(){function e(t,i){var n=this;(0,a.default)(this,e),this.hls=t,this.id=i;var o=this.observer=new p.Observer,c=t.config,h=function(e,i){(i=i||{}).frag=n.frag,i.id=n.id,t.trigger(e,i)};o.on(l.default.FRAG_DECRYPTED,h),o.on(l.default.FRAG_PARSING_INIT_SEGMENT,h),o.on(l.default.FRAG_PARSING_DATA,h),o.on(l.default.FRAG_PARSED,h),o.on(l.default.ERROR,h),o.on(l.default.FRAG_PARSING_METADATA,h),o.on(l.default.FRAG_PARSING_USERDATA,h),o.on(l.default.INIT_PTS_FOUND,h);var v={mp4:g.isTypeSupported("video/mp4"),mpeg:g.isTypeSupported("audio/mpeg"),mp3:g.isTypeSupported('audio/mp4; codecs="mp3"')},m=navigator.vendor;if(c.enableWorker&&"undefined"!=typeof Worker){d.logger.log("demuxing in webworker");var E=void 0;try{E=this.w=s(242),this.onwmsg=this.onWorkerMessage.bind(this),E.addEventListener("message",this.onwmsg),E.onerror=function(e){t.trigger(l.default.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},E.postMessage({cmd:"init",typeSupported:v,vendor:m,id:i,config:(0,r.default)(c)})}catch(e){d.logger.warn("Error in worker:",e),d.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),E&&y.URL.revokeObjectURL(E.objectURL),this.demuxer=new u.default(o,v,c,m),this.w=void 0}}else this.demuxer=new u.default(o,v,c,m)}return(0,o.default)(e,[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var i=this.observer;i&&(i.removeAllListeners(),this.observer=null)}},{key:"push",value:function(e,t,i,r,a,o,s,l){var u=this.w,f=(0,n.default)(a.startPTS)?a.startPTS:a.start,c=a.decryptdata,h=this.frag,p=!(h&&a.cc===h.cc),v=!(h&&a.level===h.level),y=h&&a.sn===h.sn+1,g=!v&&y;if(p&&d.logger.log(this.id+":discontinuity detected"),v&&d.logger.log(this.id+":switch detected"),this.frag=a,u)u.postMessage({cmd:"demux",data:e,decryptdata:c,initSegment:t,audioCodec:i,videoCodec:r,timeOffset:f,discontinuity:p,trackSwitch:v,contiguous:g,duration:o,accurateTimeOffset:s,defaultInitPTS:l},e instanceof ArrayBuffer?[e]:[]);else{var m=this.demuxer;m&&m.push(e,c,t,i,r,f,p,v,g,o,s,l)}}},{key:"onWorkerMessage",value:function(e){var t=e.data,i=this.hls;switch(t.event){case"init":y.URL.revokeObjectURL(this.w.objectURL);break;case l.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}}}]),e}();t.default=m},function(e,t,i){"use strict";var n,r="object"==typeof Reflect?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};n=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var l=10;function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,i,n){var r,a,o,s;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),o=a[t]),void 0===o)o=a[t]=i,++e._eventsCount;else if("function"==typeof o?o=a[t]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),(r=u(e))>0&&o.length>r&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,s=l,console&&console.warn&&console.warn(s)}return e}function f(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,e))}.bind(n);return r.listener=i,n.wrapFn=r,r}function c(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):p(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function p(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var l=r[e];if(void 0===l)return!1;if("function"==typeof l)a(l,this,t);else{var u=l.length,d=p(l,u);for(i=0;i<u;++i)a(d[i],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var i,n,r,a,o;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){o=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,a=Object.keys(i);for(n=0;n<a.length;++n)"removeListener"!==(r=a[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return c(this,e,!0)},s.prototype.rawListeners=function(e){return c(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},s.prototype.listenerCount=h,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=y(i(0)),r=y(i(1)),a=y(i(11)),o=i(21),s=y(i(188)),l=y(i(232)),u=y(i(193)),d=y(i(233)),f=y(i(236)),c=y(i(237)),h=y(i(240)),p=i(99),v=i(9);function y(e){return e&&e.__esModule?e:{default:e}}var g=(0,p.getSelfScope)(),m=void 0;try{m=g.performance.now.bind(g.performance)}catch(e){v.logger.debug("Unable to use Performance API on this environment"),m=g.Date.now}var E=function(){function e(t,i,r,a){(0,n.default)(this,e),this.observer=t,this.typeSupported=i,this.config=r,this.vendor=a}return(0,r.default)(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,t,i,n,r,o,l,u,d,f,c,h){var p=this;if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var v=this.decrypter;null==v&&(v=this.decrypter=new s.default(this.observer,this.config));var y=m();v.decrypt(e,t.key.buffer,t.iv.buffer,function(e){var s=m();p.observer.trigger(a.default.FRAG_DECRYPTED,{stats:{tstart:y,tdecrypt:s}}),p.pushDecrypted(new Uint8Array(e),t,new Uint8Array(i),n,r,o,l,u,d,f,c,h)})}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(i),n,r,o,l,u,d,f,c,h)}},{key:"pushDecrypted",value:function(e,t,i,n,r,s,p,v,y,g,m,E){var _=this.demuxer;if(!_||(p||v)&&!this.probe(e)){for(var T=this.observer,S=this.typeSupported,I=this.config,k=[{demux:d.default,remux:c.default},{demux:u.default,remux:h.default},{demux:l.default,remux:c.default},{demux:f.default,remux:c.default}],b=0,A=k.length;b<A;b++){var w=k[b],D=w.demux.probe;if(D(e)){var C=this.remuxer=new w.remux(T,I,S,this.vendor);_=new w.demux(T,C,I,S),this.probe=D;break}}if(!_)return void T.trigger(a.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=_}var R=this.remuxer;(p||v)&&(_.resetInitSegment(i,n,r,g),R.resetInitSegment()),p&&(_.resetTimeStamp(E),R.resetTimeStamp(E)),"function"==typeof _.setDecryptData&&_.setDecryptData(t),_.append(e,s,y,m)}}]),e}();t.default=E},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAudioConfig=s,t.isHeaderPattern=l,t.getHeaderLength=u,t.getFullFrameLength=d,t.isHeader=function(e,t){return!!(t+1<e.length&&l(e,t))},t.probe=function(e,t){if(t+1<e.length&&l(e,t)){var i=u(e,t);t+5<e.length&&(i=d(e,t));var n=t+i;if(n===e.length||n+1<e.length&&l(e,n))return!0}return!1},t.initTrackConfig=function(e,t,i,n,a){if(!e.samplerate){var o=s(t,i,n,a);e.config=o.config,e.samplerate=o.samplerate,e.channelCount=o.channelCount,e.codec=o.codec,e.manifestCodec=o.manifestCodec,r.logger.log("parsed codec:"+e.codec+",rate:"+o.samplerate+",nb channel:"+o.channelCount)}},t.getFrameDuration=f,t.parseFrameHeader=c,t.appendFrame=function(e,t,i,n,r){var a=c(t,i,n,r,f(e.samplerate));if(a){var o=a.stamp,s=a.headerLength,l=a.frameLength,u={unit:t.subarray(i+s,i+s+l),pts:o,dts:o};return e.samples.push(u),e.len+=l,{sample:u,length:l+s}}};var n,r=i(9),a=i(21),o=(n=i(11))&&n.__esModule?n:{default:n};function s(e,t,i,n){var s,l=void 0,u=void 0,d=void 0,f=void 0,c=navigator.userAgent.toLowerCase(),h=n,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(l=1+((192&t[i+2])>>>6),!((s=(60&t[i+2])>>>2)>p.length-1))return d=(1&t[i+2])<<2,d|=(192&t[i+3])>>>6,r.logger.log("manifest codec:"+n+",ADTS data:type:"+l+",sampleingIndex:"+s+"["+p[s]+"Hz],channelConfig:"+d),/firefox/i.test(c)?s>=6?(l=5,f=new Array(4),u=s-3):(l=2,f=new Array(2),u=s):-1!==c.indexOf("android")?(l=2,f=new Array(2),u=s):(l=5,f=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&s>=6?u=s-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(s>=6&&1===d||/vivaldi/i.test(c))||!n&&1===d)&&(l=2,f=new Array(2)),u=s)),f[0]=l<<3,f[0]|=(14&s)>>1,f[1]|=(1&s)<<7,f[1]|=d<<3,5===l&&(f[1]|=(14&u)>>1,f[2]=(1&u)<<7,f[2]|=8,f[3]=0),{config:f,samplerate:p[s],channelCount:d,codec:"mp4a.40."+l,manifestCodec:h};e.trigger(o.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+s})}function l(e,t){return 255===e[t]&&240==(246&e[t+1])}function u(e,t){return 1&e[t+1]?7:9}function d(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function f(e){return 9216e4/e}function c(e,t,i,n,r){var a,o=void 0,s=e.length;if(a=u(e,t),o=d(e,t),(o-=a)>0&&t+a+o<=s)return{headerLength:a,frameLength:o,stamp:i+n*r}}i(99)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,i,n,r){if(!(i+24>t.length)){var a=this.parseHeader(t,i);if(a&&i+a.frameLength<=t.length){var o=n+r*(9e4*a.samplesPerFrame/a.sampleRate),s={unit:t.subarray(i,i+a.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(s),e.len+=a.frameLength,{sample:s,length:a.frameLength}}}},parseHeader:function(e,t){var i=e[t+1]>>3&3,r=e[t+1]>>1&3,a=e[t+2]>>4&15,o=e[t+2]>>2&3,s=e[t+2]>>1&1;if(1!==i&&0!==a&&15!==a&&3!==o){var l=3===i?3-r:3===r?3:4,u=1e3*n.BitratesMap[14*l+a-1],d=3===i?0:2===i?1:2,f=n.SamplingRateMap[3*d+o],c=e[t+3]>>6==3?1:2,h=n.SamplesCoefficients[i][r],p=n.BytesInSlot[r],v=8*h*p;return{sampleRate:f,channelCount:c,frameLength:parseInt(h*u/f+s,10)*p,samplesPerFrame:v}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var i=this.parseHeader(e,t),n=4;i&&i.frameLength&&(n=i.frameLength);var r=t+n;if(r===e.length||r+1<e.length&&this.isHeaderPattern(e,r))return!0}return!1}};t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Observer=void 0;var n=u(i(2)),r=u(i(0)),a=u(i(1)),o=u(i(3)),s=u(i(4)),l=i(241);function u(e){return e&&e.__esModule?e:{default:e}}t.Observer=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"trigger",value:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.emit.apply(this,[e,e].concat(i))}}]),t}(l.EventEmitter)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={toString:function(e){for(var t="",i=e.length,n=0;n<i;n++)t+="["+e.start(n).toFixed(3)+","+e.end(n).toFixed(3)+"]";return t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(22));t.findFirstFragWithCC=s,t.findFragWithCC=function(e,t){return r.default.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})},t.shouldAlignOnDiscontinuities=l,t.findDiscontinuousReferenceFrag=u,t.adjustPts=d,t.alignStream=function(e,t,i){f(e,i,t),!i.PTSKnown&&t&&c(i,t.details)},t.alignDiscontinuities=f,t.alignPDT=c;var r=o(i(103)),a=i(9);function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var i=null,n=0;n<e.length;n+=1){var r=e[n];if(r&&r.cc===t){i=r;break}}return i}function l(e,t,i){var n=!1;return t&&t.details&&i&&(i.endCC>i.startCC||e&&e.cc<i.startCC)&&(n=!0),n}function u(e,t){var i=e.fragments,n=t.fragments;if(n.length&&i.length){var r=s(i,n[0].cc);if(r&&(!r||r.startPTS))return r;a.logger.log("No frag in previous level to align on")}else a.logger.log("No fragments to align")}function d(e,t){t.fragments.forEach(function(t){if(t){var i=t.start+e;t.start=t.startPTS=i,t.endPTS=i+t.duration}}),t.PTSKnown=!0}function f(e,t,i){if(l(e,i,t)){var n=u(i.details,t);n&&(a.logger.log("Adjusting PTS using last level due to CC increase within current level"),d(n.start,t))}}function c(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var i=t.fragments[0].programDateTime,r=(e.fragments[0].programDateTime-i)/1e3+t.fragments[0].start;(0,n.default)(r)&&(a.logger.log("adjusting PTS using programDateTime delta, sliding:"+r.toFixed(3)),d(r,e))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(22));t.findFragmentByPDT=function(e,t,i){if(!Array.isArray(e)||!e.length||!(0,n.default)(t))return null;if(t<e[0].programDateTime)return null;if(t>=e[e.length-1].endProgramDateTime)return null;i=i||0;for(var r=0;r<e.length;++r){var a=e[r];if(s(t,i,a))return a}return null},t.findFragmentByPTS=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=e?t[e.sn-t[0].sn+1]:null;return a&&!o(i,n,a)?a:r.default.search(t,o.bind(null,i,n))},t.fragmentWithinToleranceTest=o,t.pdtWithinToleranceTest=s;var r=a(i(103));function a(e){return e&&e.__esModule?e:{default:e}}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments[2],n=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-n<=e?1:i.start-n>e&&i.start?-1:0}function s(e,t,i){var n=1e3*Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.endProgramDateTime-n>e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;var n=h(i(22)),r=h(i(2)),a=h(i(0)),o=h(i(1)),s=h(i(3)),l=h(i(4)),u=h(i(191)),d=i(100),f=i(73),c=i(9);function h(e){return e&&e.__esModule?e:{default:e}}var p=t.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},v=function(e){function t(){return(0,a.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,l.default)(t,e),(0,o.default)(t,[{key:"doTick",value:function(){}},{key:"_streamEnded",value:function(e,t){var i=this.fragCurrent,n=this.fragmentTracker;if(!t.live&&i&&!i.backtracked&&i.sn===t.endSN&&!e.nextStart){var r=n.getState(i);return r===d.FragmentState.PARTIAL||r===d.FragmentState.OK}return!1}},{key:"onMediaSeeking",value:function(){var e=this.config,t=this.media,i=this.mediaBuffer,r=this.state,a=t?t.currentTime:null,o=f.BufferHelper.bufferInfo(i||t,a,this.config.maxBufferHole);if((0,n.default)(a)&&c.logger.log("media seeking to "+a.toFixed(3)),r===p.FRAG_LOADING){var s=this.fragCurrent;if(0===o.len&&s){var l=e.maxFragLookUpTolerance,u=s.start-l,d=s.start+s.duration+l;a<u||a>d?(s.loader&&(c.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),s.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=p.IDLE):c.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else r===p.ENDED&&(0===o.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=p.IDLE);t&&(this.lastCurrentTime=a),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=a),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}}]),t}(u.default);t.default=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendAddTrackEvent=function(e,t){var i=null;try{i=new window.Event("addtrack")}catch(e){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)},t.clearCurrentCues=function(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fixLineBreaks=void 0;var n=a(i(49)),r=a(i(258));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};function s(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new o,this.regionList=[]}function l(){this.values=(0,n.default)(null)}function u(e,t,i,n){var r=n?e.split(n):[e];for(var a in r)if("string"==typeof r[a]){var o=r[a].split(i);2===o.length&&t(o[0],o[1])}}l.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,i){for(var n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var d=new r.default(0,0,0),f="middle"===d.align?"middle":"center";function c(e,t,i){var n=e;function r(){var t=function(e){function t(e,t,i,n){return 3600*(0|e)+60*(0|t)+(0|i)+(0|n)/1e3}var i=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?t(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?t(i[1],i[2],0,i[4]):t(0,i[1],i[2],i[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=r(),a(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.substr(3),a(),t.endTime=r(),a(),function(e,t){var n=new l;u(e,function(e,t){switch(e){case"region":for(var r=i.length-1;r>=0;r--)if(i[r].id===t){n.set(e,i[r].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":var a=t.split(","),o=a[0];n.integer(e,o),n.percent(e,o)&&n.set("snapToLines",!1),n.alt(e,o,["auto"]),2===a.length&&n.alt("lineAlign",a[1],["start",f,"end"]);break;case"position":a=t.split(","),n.percent(e,a[0]),2===a.length&&n.alt("positionAlign",a[1],["start",f,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",f,"end","left","right"])}},/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");var r=n.get("line","auto");"auto"===r&&-1===d.line&&(r=-1),t.line=r,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",f);var a=n.get("position","auto");"auto"===a&&50===d.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function h(e){return e.replace(/<br(?: \/)?>/gi,"\n")}s.prototype={parse:function(e){var t=this;function i(){var e=t.buffer,i=0;for(e=h(e);i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;var n=e.substr(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.substr(i),n}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n=void 0;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var a=(n=i()).match(/^(茂禄驴)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var o=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:n=i(),t.state){case"HEADER":/:/.test(n)?u(n,function(e,t){},/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new r.default(0,0,""),t.state="CUE",-1===n.indexOf("--\x3e")){t.cue.id=n;continue}case"CUE":try{c(n,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=-1!==n.indexOf("--\x3e");if(!n||s&&(o=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID");continue}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}},t.fixLineBreaks=h,t.default=s},,,,function(e,t,i){e.exports=i(212)},function(e,t,i){"use strict";var n=u(i(2)),r=u(i(0)),a=u(i(3)),o=u(i(4)),s=u(i(213));i(267);var l=u(i(132));function u(e){return e&&e.__esModule?e:{default:e}}window.Hls=s.default;var d=function(e){function t(e){return(0,r.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,o.default)(t,e),t}(l.default);window.PcPlayer=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=S(i(2)),r=S(i(0)),a=S(i(3)),o=S(i(1)),s=S(i(4)),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(102)),u=i(21),d=S(i(192)),f=S(i(225)),c=S(i(226)),h=i(100),p=S(i(227)),v=S(i(244)),y=S(i(245)),g=i(246),m=i(9),E=i(247),_=S(i(11)),T=i(201);function S(e){return e&&e.__esModule?e:{default:e}}window.__VERSION__="1.0.0";var I=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.default)(this,t);var i=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).call(this)),o=t.DefaultConfig;if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var s in o)s in e||(e[s]=o[s]);if(void 0!==e.liveMaxLatencyDurationCount&&e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(e.liveMaxLatencyDuration<=e.liveSyncDuration||void 0===e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,m.enableLogs)(e.debug),i.config=e,i._autoLevelCapping=-1;var l=i.abrController=new e.abrController(i),u=new e.bufferController(i),g=new e.capLevelController(i),E=new e.fpsController(i),_=new d.default(i),T=new f.default(i),S=new c.default(i),I=new y.default(i),k=i.levelController=new v.default(i),b=new h.FragmentTracker(i),A=[k,i.streamController=new p.default(i,b)],w=e.audioStreamController;w&&A.push(new w(i,b)),i.networkControllers=A;var D=[_,T,S,l,u,g,E,I,b];if(w=e.audioTrackController){var C=new w(i);i.audioTrackController=C,D.push(C)}if(w=e.subtitleTrackController){var R=new w(i);i.subtitleTrackController=R,D.push(R)}if(w=e.emeController){var O=new w(i);i.emeController=O,D.push(O)}return(w=e.subtitleStreamController)&&D.push(new w(i,b)),(w=e.timelineController)&&D.push(new w(i)),i.coreComponents=D,i}return(0,s.default)(t,e),(0,o.default)(t,null,[{key:"isSupported",value:function(){return(0,g.isSupported)()}},{key:"version",get:function(){return __VERSION__}},{key:"Events",get:function(){return _.default}},{key:"ErrorTypes",get:function(){return u.ErrorTypes}},{key:"ErrorDetails",get:function(){return u.ErrorDetails}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:E.hlsDefaultConfig},set:function(e){t.defaultConfig=e}}]),(0,o.default)(t,[{key:"destroy",value:function(){m.logger.log("destroy"),this.trigger(_.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function(e){m.logger.log("attachMedia"),this.media=e,this.trigger(_.default.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){m.logger.log("detachMedia"),this.trigger(_.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){e=l.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),m.logger.log("loadSource:"+e),this.url=e,this.trigger(_.default.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;m.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})}},{key:"stopLoad",value:function(){m.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})}},{key:"swapAudioCodec",value:function(){m.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){m.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){m.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){m.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){m.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){m.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){m.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){m.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,i=e?e.length:0,n=0;n<i;n++)if((e[n].realBitrate?Math.max(e[n].realBitrate,e[n].bitrate):e[n].bitrate)>t)return n;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),t}(T.Observer);t.default=I},function(e,t,i){i(215),e.exports=i(5).Number.isFinite},function(e,t,i){var n=i(14),r=i(10).isFinite;n(n.S,"Number",{isFinite:function(e){return"number"==typeof e&&r(e)}})},function(e,t,i){e.exports={default:i(217),__esModule:!0}},function(e,t,i){i(218);var n=i(5).Object;e.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)}},function(e,t,i){var n=i(28),r=i(71).f;i(70)("getOwnPropertyDescriptor",function(){return function(e,t){return r(n(e),t)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=h(i(22)),r=h(i(0)),a=h(i(1)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(102)),s=h(i(187)),l=h(i(220)),u=h(i(194)),d=h(i(221)),f=i(9),c=i(195);function h(e){return e&&e.__esModule?e:{default:e}}var p=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,v=/#EXT-X-MEDIA:(.*)/g,y=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),g=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,m=/\.(mp4|m4s|m4v|m4a)$/i,E=function(){function e(){(0,r.default)(this,e)}return(0,a.default)(e,null,[{key:"findGroup",value:function(e,t){if(!e)return null;for(var i=null,n=0;n<e.length;n++){var r=e[n];r.id===t&&(i=r)}return i}},{key:"convertAVC1ToAVCOTI",value:function(e){var t=void 0,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift()).toString(16),t+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):t=e,t}},{key:"resolve",value:function(e,t){return o.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function(t,i){var n=[],r=void 0;function a(e,t){["video","audio"].forEach(function(i){var n=e.filter(function(e){return(0,c.isCodecType)(e,i)});if(n.length){var r=n.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});t[i+"Codec"]=r.length>0?r[0]:n[0],e=e.filter(function(e){return-1===n.indexOf(e)})}}),t.unknownCodecs=e}for(p.lastIndex=0;null!=(r=p.exec(t));){var o={},s=o.attrs=new d.default(r[1]);o.url=e.resolve(r[2],i);var l=s.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),o.bitrate=s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),o.name=s.NAME,a([].concat((s.CODECS||"").split(/[ ,]+/)),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=e.convertAVC1ToAVCOTI(o.videoCodec)),n.push(o)}return n}},{key:"parseMasterPlaylistMedia",value:function(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=void 0,o=[],s=0;for(v.lastIndex=0;null!==(a=v.exec(t));){var l={},u=new d.default(a[1]);if(u.TYPE===n){if(l.groupId=u["GROUP-ID"],l.name=u.NAME,l.type=n,l.default="YES"===u.DEFAULT,l.autoselect="YES"===u.AUTOSELECT,l.forced="YES"===u.FORCED,u.URI&&(l.url=e.resolve(u.URI,i)),l.lang=u.LANGUAGE,l.name||(l.name=l.lang),r.length){var f=e.findGroup(r,l.groupId);l.audioCodec=f?f.codec:r[0].codec}l.id=s++,o.push(l)}}return o}},{key:"parseLevelPlaylist",value:function(e,t,i,r,a){var o=0,c=0,h=new l.default(t),p=new u.default,v=0,E=null,T=new s.default,S=void 0,I=void 0,k=null;for(y.lastIndex=0;null!==(S=y.exec(e));){var b=S[1];if(b){T.duration=parseFloat(b);var A=(" "+S[2]).slice(1);T.title=A||null,T.tagList.push(A?["INF",b,A]:["INF",b])}else if(S[3]){if((0,n.default)(T.duration)){var w=o++;T.type=r,T.start=c,T.levelkey=p,T.sn=w,T.level=i,T.cc=v,T.urlId=a,T.baseurl=t,T.relurl=(" "+S[3]).slice(1),_(T,E),h.fragments.push(T),E=T,c+=T.duration,T=new s.default}}else if(S[4]){if(T.rawByteRange=(" "+S[4]).slice(1),E){var D=E.byteRangeEndOffset;D&&(T.lastByteRangeEndOffset=D)}}else if(S[5])T.rawProgramDateTime=(" "+S[5]).slice(1),T.tagList.push(["PROGRAM-DATE-TIME",T.rawProgramDateTime]),null===k&&(k=h.fragments.length);else{for(S=S[0].match(g),I=1;I<S.length&&void 0===S[I];I++);var C=(" "+S[I+1]).slice(1),R=(" "+S[I+2]).slice(1);switch(S[I]){case"#":T.tagList.push(R?[C,R]:[C]);break;case"PLAYLIST-TYPE":h.type=C.toUpperCase();break;case"MEDIA-SEQUENCE":o=h.startSN=parseInt(C);break;case"TARGETDURATION":h.targetduration=parseFloat(C);break;case"VERSION":h.version=parseInt(C);break;case"EXTM3U":break;case"ENDLIST":h.live=!1;break;case"DIS":v++,T.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":v=parseInt(C);break;case"KEY":var O=C,L=new d.default(O),P=L.enumeratedString("METHOD"),M=L.URI,N=L.hexadecimalInteger("IV");P&&(p=new u.default,M&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(P)>=0&&(p.method=P,p.baseuri=t,p.reluri=M,p.key=null,p.iv=N));break;case"START":var x=C,U=new d.default(x).decimalFloatingPoint("TIME-OFFSET");(0,n.default)(U)&&(h.startTimeOffset=U);break;case"MAP":var H=new d.default(C);T.relurl=H.URI,T.rawByteRange=H.BYTERANGE,T.baseurl=t,T.level=i,T.type=r,T.sn="initSegment",h.initSegment=T,(T=new s.default).rawProgramDateTime=h.initSegment.rawProgramDateTime;break;default:f.logger.warn("line parsed but not handled: "+S)}}}return(T=E)&&!T.relurl&&(h.fragments.pop(),c-=T.duration),h.totalduration=c,h.averagetargetduration=c/h.fragments.length,h.endSN=o-1,h.startCC=h.fragments[0]?h.fragments[0].cc:0,h.endCC=v,!h.initSegment&&h.fragments.length&&h.fragments.every(function(e){return m.test(e.relurl)})&&(f.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(T=new s.default).relurl=h.fragments[0].relurl,T.baseurl=t,T.level=i,T.type=r,T.sn="initSegment",h.initSegment=T,h.needSidxRanges=!0),k&&function(e,t){for(var i=e[t],n=t-1;n>=0;n--){var r=e[n];r.programDateTime=i.programDateTime-1e3*r.duration,i=r}}(h.fragments,k),h}}]),e}();function _(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),(0,n.default)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}t.default=E},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(22)),r=o(i(0)),a=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,r.default)(this,e),this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=t,this.version=null}return(0,a.default)(e,[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!(0,n.default)(this.fragments[0].programDateTime))}}]),e}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(222)),r=o(i(0)),a=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=/^(\d+)x(\d+)$/,l=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,u=function(){function e(t){for(var i in(0,r.default)(this,e),"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(i)&&(this[i]=t[i])}return(0,a.default)(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>n.default?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>n.default?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=s.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t=void 0,i={};for(l.lastIndex=0;null!==(t=l.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[t[1]]=n}return i}}]),e}();t.default=u},function(e,t,i){e.exports={default:i(223),__esModule:!0}},function(e,t,i){i(224),e.exports=9007199254740991},function(e,t,i){var n=i(14);n(n.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=p(i(22)),r=p(i(2)),a=p(i(0)),o=p(i(1)),s=p(i(3)),l=p(i(72)),u=p(i(4)),d=p(i(11)),f=p(i(29)),c=i(21),h=i(9);function p(e){return e&&e.__esModule?e:{default:e}}var v=function(e){function t(e){(0,a.default)(this,t);var i=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,d.default.FRAG_LOADING));return i.loaders={},i}return(0,u.default)(t,e),(0,o.default)(t,[{key:"destroy",value:function(){var e=this.loaders;for(var i in e){var n=e[i];n&&n.destroy()}this.loaders={},(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"destroy",this).call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag,i=t.type,r=this.loaders,a=this.hls.config,o=a.fLoader,s=a.loader;t.loaded=0;var l=r[i];l&&(h.logger.warn("abort previous fragment loader for type: "+i),l.abort()),l=r[i]=t.loader=a.fLoader?new o(a):new s(a);var u,d,f=void 0;f={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var c=t.byteRangeStartOffset,p=t.byteRangeEndOffset;(0,n.default)(c)&&(0,n.default)(p)&&(f.rangeStart=c,f.rangeEnd=p),u={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},l.load(f,u,d)}},{key:"loadsuccess",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=e.data,a=i.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(d.default.FRAG_LOADED,{payload:r,frag:a,stats:t,networkDetails:n})}},{key:"loaderror",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=t.frag,r=n.loader;r&&r.abort(),this.loaders[n.type]=void 0,this.hls.trigger(d.default.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:i})}},{key:"loadtimeout",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=t.frag,r=n.loader;r&&r.abort(),this.loaders[n.type]=void 0,this.hls.trigger(d.default.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:i})}},{key:"loadprogress",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=t.frag;r.loaded=e.loaded,this.hls.trigger(d.default.FRAG_LOAD_PROGRESS,{frag:r,stats:e,networkDetails:n})}}]),t}(f.default);t.default=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(i(2)),r=c(i(0)),a=c(i(1)),o=c(i(3)),s=c(i(4)),l=c(i(11)),u=c(i(29)),d=i(21),f=i(9);function c(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(e){(0,r.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e,l.default.KEY_LOADING));return i.loaders={},i.decryptkey=null,i.decrypturl=null,i}return(0,s.default)(t,e),(0,a.default)(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},u.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var t=e.frag,i=t.type,n=this.loaders[i],r=t.decryptdata,a=r.uri;if(a!==this.decrypturl||null===this.decryptkey){var o,s,u,d=this.hls.config;n&&(f.logger.warn("abort previous key loader for type:"+i),n.abort()),t.loader=this.loaders[i]=new d.loader(d),this.decrypturl=a,this.decryptkey=null,o={url:a,frag:t,responseType:"arraybuffer"},s={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:d.fragLoadingRetryDelay,maxRetryDelay:d.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(o,s,u)}else this.decryptkey&&(r.key=this.decryptkey,this.hls.trigger(l.default.KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(e,t,i){var n=i.frag;this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=void 0,this.loaders[n.type]=void 0,this.hls.trigger(l.default.KEY_LOADED,{frag:n})}},{key:"loaderror",value:function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:e})}},{key:"loadtimeout",value:function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})}}]),t}(u.default);t.default=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=b(i(22)),r=b(i(2)),a=b(i(0)),o=b(i(1)),s=b(i(3)),l=b(i(72)),u=b(i(4)),d=b(i(103)),f=i(73),c=b(i(196)),h=b(i(11)),p=i(100),v=b(i(187)),y=b(i(192)),g=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(190)),m=b(i(202)),E=i(21),_=i(9),T=i(203),S=i(204),I=b(i(243)),k=i(205);function b(e){return e&&e.__esModule?e:{default:e}}var A=function(e){function t(e,i){(0,a.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.MANIFEST_LOADING,h.default.MANIFEST_PARSED,h.default.LEVEL_LOADED,h.default.KEY_LOADED,h.default.FRAG_LOADED,h.default.FRAG_LOAD_EMERGENCY_ABORTED,h.default.FRAG_PARSING_INIT_SEGMENT,h.default.FRAG_PARSING_DATA,h.default.FRAG_PARSED,h.default.ERROR,h.default.AUDIO_TRACK_SWITCHING,h.default.AUDIO_TRACK_SWITCHED,h.default.BUFFER_CREATED,h.default.BUFFER_APPENDED,h.default.BUFFER_FLUSHED));return n.fragmentTracker=i,n.config=e.config,n.audioCodecSwap=!1,n._state=k.State.STOPPED,n.stallReported=!1,n.gapController=null,n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"onHandlerDestroying",value:function(){this.stopLoad(),(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"onHandlerDestroying",this).call(this)}},{key:"onHandlerDestroyed",value:function(){this.state=k.State.STOPPED,this.fragmentTracker=null,(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"onHandlerDestroyed",this).call(this)}},{key:"startLoad",value:function(e){if(this.levels){var t=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var n=i.startLevel;-1===n&&(n=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=n,this.loadedmetadata=!1}t>0&&-1===e&&(_.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=k.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=k.State.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.clearInterval(),this.state=k.State.STOPPED,this.forceStartLoad=!1}},{key:"doTick",value:function(){switch(this.state){case k.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case k.State.IDLE:this._doTickIdle();break;case k.State.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=k.State.IDLE);break;case k.State.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),i=this.retryDate;(!i||t>=i||this.media&&this.media.seeking)&&(_.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=k.State.IDLE);break;case k.State.ERROR:case k.State.STOPPED:case k.State.FRAG_LOADING:case k.State.PARSING:case k.State.PARSED:case k.State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var e=this.hls,t=e.config,i=this.media;if(void 0!==this.levelLastLoaded&&(i||!this.startFragRequested&&t.startFragPrefetch)){var n;n=this.loadedmetadata?i.currentTime:this.nextLoadPosition;var r=e.nextLoadLevel,a=this.levels[r];if(a){var o=a.bitrate,s=void 0;s=o?Math.max(8*t.maxBufferSize/o,t.maxBufferLength):t.maxBufferLength,s=Math.min(s,t.maxMaxBufferLength);var l=f.BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,n,t.maxBufferHole),u=l.len;if(!(u>=s)){_.logger.trace("buffer length of "+u.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=r;var d=a.details;if(!d||d.live&&this.levelLastLoaded!==r)this.state=k.State.WAITING_LEVEL;else{if(this._streamEnded(l,d)){var c={};return this.altAudio&&(c.type="video"),this.hls.trigger(h.default.BUFFER_EOS,c),void(this.state=k.State.ENDED)}this._fetchPayloadOrEos(n,l,d)}}}}}},{key:"_fetchPayloadOrEos",value:function(e,t,i){var n=this.fragPrevious,r=this.level,a=i.fragments,o=a.length;if(0!==o){var s=a[0].start,l=a[o-1].start+a[o-1].duration,u=t.end,d=void 0;if(i.initSegment&&!i.initSegment.data)d=i.initSegment;else if(i.live){var f=this.config.initialLiveManifestSize;if(o<f)return void _.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+f);if(null===(d=this._ensureFragmentAtLivePoint(i,u,s,l,n,a,o)))return}else u<s&&(d=a[0]);d||(d=this._findFragment(s,n,o,a,u,l,i)),d&&(d.encrypted?(_.logger.log("Loading key for "+d.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+r),this._loadKey(d)):(_.logger.log("Loading "+d.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+r+", currentTime:"+e.toFixed(3)+",bufferEnd:"+u.toFixed(3)),this._loadFragment(d)))}}},{key:"_ensureFragmentAtLivePoint",value:function(e,t,i,n,r,a,o){var s=this.hls.config,l=this.media,u=void 0,f=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(i-s.maxFragLookUpTolerance,n-f)){var c=this.liveSyncPosition=this.computeLivePosition(i,e);_.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+c.toFixed(3)),t=c,l&&l.readyState&&l.duration>c&&(l.currentTime=c),this.nextLoadPosition=c}if(e.PTSKnown&&t>n&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(r)if(e.hasProgramDateTime)_.logger.log("live playlist, switching playlist, load frag with same PDT: "+r.programDateTime),u=(0,S.findFragmentByPDT)(a,r.endProgramDateTime,s.maxFragLookUpTolerance);else{var h=r.sn+1;if(h>=e.startSN&&h<=e.endSN){var p=a[h-e.startSN];r.cc===p.cc&&(u=p,_.logger.log("live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=d.default.search(a,function(e){return r.cc-e.cc}))&&_.logger.log("live playlist, switching playlist, load frag with same CC: "+u.sn)}u||(u=a[Math.min(o-1,Math.round(o/2))],_.logger.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))}return u}},{key:"_findFragment",value:function(e,t,i,n,r,a,o){var s=this.hls.config,l=void 0;if(r<a){var u=r>a-s.maxFragLookUpTolerance?0:s.maxFragLookUpTolerance;l=(0,S.findFragmentByPTS)(t,n,r,u)}else l=n[i-1];if(l){var d=l.sn-o.startSN,f=t&&l.level===t.level,c=n[d-1],h=n[d+1];if(t&&l.sn===t.sn)if(f&&!l.backtracked)if(l.sn<o.endSN){var p=t.deltaPTS;p&&p>s.maxBufferHole&&t.dropped&&d?(l=c,_.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(l=h,_.logger.log("SN just loaded, load next one: "+l.sn,l))}else l=null;else l.backtracked&&(h&&h.backtracked?(_.logger.warn("Already backtracked from fragment "+h.sn+", will not backtrack to fragment "+l.sn+". Loading fragment "+h.sn),l=h):(_.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),l.dropped=0,c?(l=c).backtracked=!0:d&&(l=null)))}return l}},{key:"_loadKey",value:function(e){this.state=k.State.KEY_LOADING,this.hls.trigger(h.default.KEY_LOADING,{frag:e})}},{key:"_loadFragment",value:function(e){var t=this.fragmentTracker.getState(e);this.fragCurrent=e,this.startFragRequested=!0,(0,n.default)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||t===p.FragmentState.NOT_LOADED||t===p.FragmentState.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(h.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new c.default(this.hls,"main")),this.state=k.State.FRAG_LOADING):t===p.FragmentState.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)}},{key:"getBufferedFrag",value:function(e){return this.fragmentTracker.getBufferedFrag(e,y.default.LevelType.MAIN)}},{key:"followingBufferedFrag",value:function(e){return e?this.getBufferedFrag(e.endPTS+.5):null}},{key:"_checkFragmentChanged",value:function(){var e=void 0,t=void 0,i=this.media;if(i&&i.readyState&&!1===i.seeking&&((t=i.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),f.BufferHelper.isBuffered(i,t)?e=this.getBufferedFrag(t):f.BufferHelper.isBuffered(i,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var n=e;if(n!==this.fragPlaying){this.hls.trigger(h.default.FRAG_CHANGED,{frag:n});var r=n.level;this.fragPlaying&&this.fragPlaying.level===r||this.hls.trigger(h.default.LEVEL_SWITCHED,{level:r}),this.fragPlaying=n}}}},{key:"immediateLevelSwitch",value:function(){if(_.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,f.BufferHelper.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var e=this.media;if(e&&e.readyState){var t,i=void 0,n=void 0;if((t=this.getBufferedFrag(e.currentTime))&&t.startPTS>1&&this.flushMainBuffer(0,t.startPTS-1),e.paused)i=0;else{var r=this.hls.nextLoadLevel,a=this.levels[r],o=this.fragLastKbps;i=o&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*o)+1:0}if((n=this.getBufferedFrag(e.currentTime+i))&&(n=this.followingBufferedFrag(n))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(n.maxStartPTS,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(e,t){this.state=k.State.BUFFER_FLUSHING;var i={startOffset:e,endOffset:t};this.altAudio&&(i.type="video"),this.hls.trigger(h.default.BUFFER_FLUSHING,i)}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition),this.gapController=new I.default(i,t,this.fragmentTracker,this.hls)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(_.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeked",value:function(){var e=this.media,t=e?e.currentTime:void 0;(0,n.default)(t)&&_.logger.log("media seeked to "+t.toFixed(3)),this.tick()}},{key:"onManifestLoading",value:function(){_.logger.log("trigger BUFFER_RESET"),this.hls.trigger(h.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(e){var t=!1,i=!1,n=void 0;e.levels.forEach(function(e){(n=e.audioCodec)&&(-1!==n.indexOf("mp4a.40.2")&&(t=!0),-1!==n.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=t&&i,this.audioCodecSwitch&&_.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;var r=this.config;(r.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(r.startPosition)}},{key:"onLevelLoaded",value:function(e){var t=e.details,i=e.level,r=this.levels[this.levelLastLoaded],a=this.levels[i],o=t.totalduration,s=0;if(_.logger.log("level "+i+" loaded ["+t.startSN+","+t.endSN+"],duration:"+o),t.live){var l=a.details;l&&t.fragments.length>0?(g.mergeDetails(l,t),s=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(s,l),t.PTSKnown&&(0,n.default)(s)?_.logger.log("live playlist sliding:"+s.toFixed(3)):(_.logger.log("live playlist - outdated PTS, unknown sliding"),(0,T.alignStream)(this.fragPrevious,r,t))):(_.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,(0,T.alignStream)(this.fragPrevious,r,t))}else t.PTSKnown=!1;if(a.details=t,this.levelLastLoaded=i,this.hls.trigger(h.default.LEVEL_UPDATED,{details:t,level:i}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var u=t.startTimeOffset;(0,n.default)(u)?(u<0&&(_.logger.log("negative start time offset "+u+", count from end of last fragment"),u=s+o+u),_.logger.log("start time offset found in playlist, adjust startPosition to "+u),this.startPosition=u):t.live?(this.startPosition=this.computeLivePosition(s,t),_.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===k.State.WAITING_LEVEL&&(this.state=k.State.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===k.State.KEY_LOADING&&(this.state=k.State.IDLE,this.tick())}},{key:"fangDao",value:function(e){if(e&&e.payload&&-1!=window.location.href.indexOf("fangdao")){e.payload=new Uint8Array(e.payload);for(var t=null,i=0;i<e.payload.length;i++)t=e.payload[i],e.payload[i]=39^t}}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,i=this.hls,n=this.levels,r=this.media,a=e.frag;if(this.fangDao(e),this.state===k.State.FRAG_LOADING&&t&&"main"===a.type&&a.level===t.level&&a.sn===t.sn){var o=e.stats,s=n[t.level],l=s.details;if(this.bitrateTest=!1,this.stats=o,_.logger.log("Loaded "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level),a.bitrateTest&&i.nextLoadLevel)this.state=k.State.IDLE,this.startFragRequested=!1,o.tparsed=o.tbuffered=window.performance.now(),i.trigger(h.default.FRAG_BUFFERED,{stats:o,frag:t,id:"main"}),this.tick();else if("initSegment"===a.sn)this.state=k.State.IDLE,o.tparsed=o.tbuffered=window.performance.now(),l.initSegment.data=e.payload,i.trigger(h.default.FRAG_BUFFERED,{stats:o,frag:t,id:"main"}),this.tick();else{_.logger.log("Parsing "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level+", cc "+t.cc),this.state=k.State.PARSING,this.pendingBuffering=!0,this.appended=!1,a.bitrateTest&&(a.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:a}));var u=!(r&&r.seeking)&&(l.PTSKnown||!l.live),d=l.initSegment?l.initSegment.data:[],f=this._getAudioCodec(s);(this.demuxer=this.demuxer||new c.default(this.hls,"main")).push(e.payload,d,f,s.videoCodec,t,l.totalduration,u)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent,i=e.frag;if(t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===k.State.PARSING){var n=e.tracks,r=void 0,a=void 0;if(n.audio&&this.altAudio&&delete n.audio,a=n.audio){var o=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();o&&this.audioCodecSwap&&(_.logger.log("swapping playlist audio codec"),o=-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===s.indexOf("firefox")&&(o="mp4a.40.5"),-1!==s.indexOf("android")&&"audio/mpeg"!==a.container&&(o="mp4a.40.2",_.logger.log("Android: force audio codec to "+o)),a.levelCodec=o,a.id=e.id}for(r in(a=n.video)&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=e.id),this.hls.trigger(h.default.BUFFER_CODECS,n),n){a=n[r],_.logger.log("main track:"+r+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var l=a.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h.default.BUFFER_APPENDING,{type:r,data:l,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(e){var t=this,i=this.fragCurrent,r=e.frag;if(i&&"main"===e.id&&r.sn===i.sn&&r.level===i.level&&("audio"!==e.type||!this.altAudio)&&this.state===k.State.PARSING){var a=this.levels[this.level],o=i;if((0,n.default)(e.endPTS)||(e.endPTS=e.startPTS+i.duration,e.endDTS=e.startDTS+i.duration),!0===e.hasAudio&&o.addElementaryStream(v.default.ElementaryStreamTypes.AUDIO),!0===e.hasVideo&&o.addElementaryStream(v.default.ElementaryStreamTypes.VIDEO),_.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(o.dropped=e.dropped,o.dropped)if(o.backtracked)_.logger.warn("Already backtracked on this fragment, appending with the gap",o.sn);else{var s=a.details;if(!s||o.sn!==s.startSN)return _.logger.warn("missing video frame(s), backtracking fragment",o.sn),this.fragmentTracker.removeFragment(o),o.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=k.State.IDLE,this.fragPrevious=o,void this.tick();_.logger.warn("missing video frame(s) on first frag, appending with gap",o.sn)}else o.backtracked=!1;var l=g.updateFragPTSDTS(a.details,o,e.startPTS,e.endPTS,e.startDTS,e.endDTS),u=this.hls;u.trigger(h.default.LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:l,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(i){i&&i.length&&t.state===k.State.PARSING&&(t.appended=!0,t.pendingBuffering=!0,u.trigger(h.default.BUFFER_APPENDING,{type:e.type,data:i,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent,i=e.frag;t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===k.State.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=k.State.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url,i=e.id;if(!t){if(this.mediaBuffer!==this.media){_.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n.loader&&(_.logger.log("switching to main audio track, cancel main fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=k.State.IDLE}var r=this.hls;r.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),r.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:i}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(e){var t=e.id,i=!!this.hls.audioTracks[t].url;if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(_.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i,this.tick()}},{key:"onBufferCreated",value:function(e){var t=e.tracks,i=void 0,n=void 0,r=!1;for(var a in t){var o=t[a];"main"===o.id?(n=a,i=o,"video"===a&&(this.videoBuffer=t[a].buffer)):r=!0}r&&i?(_.logger.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(e){if("main"===e.parent){var t=this.state;t!==k.State.PARSING&&t!==k.State.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==k.State.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;_.logger.log("main buffered : "+m.default.toString(t.buffered)),this.fragPrevious=e;var i=this.stats;i.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(h.default.FRAG_BUFFERED,{stats:i,frag:e,id:"main"}),this.state=k.State.IDLE}this.tick()}}},{key:"onError",value:function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var i=!!this.media&&f.BufferHelper.isBuffered(this.media,this.media.currentTime)&&f.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var n=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);_.logger.warn("mediaController: frag loading failed, retry in "+n+" ms"),this.retryDate=window.performance.now()+n,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=k.State.FRAG_LOADING_WAITING_RETRY}else _.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=k.State.ERROR;break;case E.ErrorDetails.LEVEL_LOAD_ERROR:case E.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==k.State.ERROR&&(e.fatal?(this.state=k.State.ERROR,_.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==k.State.WAITING_LEVEL||(this.state=k.State.IDLE));break;case E.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==k.State.PARSING&&this.state!==k.State.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=k.State.IDLE):(_.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,_.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)}},{key:"_checkBuffer",value:function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=k.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(v.default.ElementaryStreamTypes.VIDEO,e.buffered),this.state=k.State.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(e,t){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-i)}},{key:"_seekToStartPos",value:function(){var e=this.media,t=e.currentTime,i=e.seeking?t:this.startPosition;t!==i&&(_.logger.log("target start position not buffered, seek to buffered.start(0) "+i+" from current time "+t+" "),e.currentTime=i)}},{key:"_getAudioCodec",value:function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(_.logger.log("swapping playlist audio codec"),t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,_.logger.log("main stream:"+t+"->"+e),this.hls.trigger(h.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(b(k).default);t.default=A},function(e,t,i){function n(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var n=i(i.s=ENTRY_MODULE);return n.default||n}var r="[\\.|\\-|\\+|\\w|/|@]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+r+").*?\\)";function o(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,n){var s={};s[n]=[];var l=t.toString(),u=l.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return s;for(var d,f=u[1],c=new RegExp("(\\\\n|\\W)"+o(f)+a,"g");d=c.exec(l);)"dll-reference"!==d[3]&&s[n].push(d[3]);for(c=new RegExp("\\("+o(f)+'\\("(dll-reference\\s('+r+'))"\\)\\)'+a,"g");d=c.exec(l);)e[d[2]]||(s[n].push(d[1]),e[d[2]]=i(d[1]).m),s[d[2]]=s[d[2]]||[],s[d[2]].push(d[4]);for(var h,p=Object.keys(s),v=0;v<p.length;v++)for(var y=0;y<s[p[v]].length;y++)h=s[p[v]][y],isNaN(1*h)||(s[p[v]][y]=1*s[p[v]][y]);return s}function l(e){return Object.keys(e).reduce(function(t,i){return t||e[i].length>0},!1)}e.exports=function(e,t){t=t||{};var r={main:i.m},a=t.all?{main:Object.keys(r.main)}:function(e,t){for(var i={main:[t]},n={main:[]},r={main:{}};l(i);)for(var a=Object.keys(i),o=0;o<a.length;o++){var u=a[o],d=i[u].pop();if(r[u]=r[u]||{},!r[u][d]&&e[u][d]){r[u][d]=!0,n[u]=n[u]||[],n[u].push(d);for(var f=s(e,e[u][d],u),c=Object.keys(f),h=0;h<c.length;h++)i[c[h]]=i[c[h]]||[],i[c[h]]=i[c[h]].concat(f[c[h]])}}return n}(r,e),o="";Object.keys(a).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;a[e][t];)t++;a[e].push(t),r[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",o=o+"var "+e+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a[e].map(function(t){return JSON.stringify(t)+": "+r[e][t].toString()}).join(",")+"});\n"}),o=o+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a.main.map(function(e){return JSON.stringify(e)+": "+r.main[e].toString()}).join(",")+"}))(self);";var u=new window.Blob([o],{type:"text/javascript"});if(t.bare)return u;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),f=new window.Worker(d);return f.objectURL=d,f}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(0)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(t,i){(0,n.default)(this,e),this.subtle=t,this.aesIV=i}return(0,r.default)(e,[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(0)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(t,i){(0,n.default)(this,e),this.subtle=t,this.key=i}return(0,r.default)(e,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(0)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=e.byteLength,i=t&&new DataView(e).getUint8(t-1);return i?e.slice(0,t-i):e}t.removePadding=o;var s=function(){function e(){(0,n.default)(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return(0,r.default)(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),i=new Uint32Array(4),n=0;n<4;n++)i[n]=t.getUint32(4*n);return i}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,i=this.subMix,n=i[0],r=i[1],a=i[2],o=i[3],s=this.invSubMix,l=s[0],u=s[1],d=s[2],f=s[3],c=new Uint32Array(256),h=0,p=0,v=0;for(v=0;v<256;v++)c[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var y=p^p<<1^p<<2^p<<3^p<<4;y=y>>>8^255&y^99,e[h]=y,t[y]=h;var g=c[h],m=c[g],E=c[m],_=257*c[y]^16843008*y;n[h]=_<<24|_>>>8,r[h]=_<<16|_>>>16,a[h]=_<<8|_>>>24,o[h]=_,_=16843009*E^65537*m^257*g^16843008*h,l[y]=_<<24|_>>>8,u[y]=_<<16|_>>>16,d[y]=_<<8|_>>>24,f[y]=_,h?(h=g^c[c[c[E^g]]],p^=c[c[p]]):h=p=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),i=!0,n=0;n<t.length&&i;)i=t[n]===this.key[n],n++;if(!i){this.key=t;var r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);var a=this.ksRows=4*(r+6+1),o=void 0,s=void 0,l=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),d=this.sBox,f=this.rcon,c=this.invSubMix,h=c[0],p=c[1],v=c[2],y=c[3],g=void 0,m=void 0;for(o=0;o<a;o++)o<r?g=l[o]=t[o]:(m=g,o%r==0?(m=d[(m=m<<8|m>>>24)>>>24]<<24|d[m>>>16&255]<<16|d[m>>>8&255]<<8|d[255&m],m^=f[o/r|0]<<24):r>6&&o%r==4&&(m=d[m>>>24]<<24|d[m>>>16&255]<<16|d[m>>>8&255]<<8|d[255&m]),l[o]=g=(l[o-r]^m)>>>0);for(s=0;s<a;s++)o=a-s,m=3&s?l[o]:l[o-4],u[s]=s<4||o<=4?m:h[d[m>>>24]]^p[d[m>>>16&255]]^v[d[m>>>8&255]]^y[d[255&m]],u[s]=u[s]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,i,n){for(var r=this.keySize+6,a=this.invKeySchedule,s=this.invSBox,l=this.invSubMix,u=l[0],d=l[1],f=l[2],c=l[3],h=this.uint8ArrayToUint32Array_(i),p=h[0],v=h[1],y=h[2],g=h[3],m=new Int32Array(e),E=new Int32Array(m.length),_=void 0,T=void 0,S=void 0,I=void 0,k=void 0,b=void 0,A=void 0,w=void 0,D=void 0,C=void 0,R=void 0,O=void 0,L=void 0,P=void 0,M=this.networkToHostOrderSwap;t<m.length;){for(D=M(m[t]),C=M(m[t+1]),R=M(m[t+2]),O=M(m[t+3]),k=D^a[0],b=O^a[1],A=R^a[2],w=C^a[3],L=4,P=1;P<r;P++)_=u[k>>>24]^d[b>>16&255]^f[A>>8&255]^c[255&w]^a[L],T=u[b>>>24]^d[A>>16&255]^f[w>>8&255]^c[255&k]^a[L+1],S=u[A>>>24]^d[w>>16&255]^f[k>>8&255]^c[255&b]^a[L+2],I=u[w>>>24]^d[k>>16&255]^f[b>>8&255]^c[255&A]^a[L+3],k=_,b=T,A=S,w=I,L+=4;_=s[k>>>24]<<24^s[b>>16&255]<<16^s[A>>8&255]<<8^s[255&w]^a[L],T=s[b>>>24]<<24^s[A>>16&255]<<16^s[w>>8&255]<<8^s[255&k]^a[L+1],S=s[A>>>24]<<24^s[w>>16&255]<<16^s[k>>8&255]<<8^s[255&b]^a[L+2],I=s[w>>>24]<<24^s[k>>16&255]<<16^s[b>>8&255]<<8^s[255&A]^a[L+3],L+=3,E[t]=M(_^p),E[t+1]=M(I^v),E[t+2]=M(S^y),E[t+3]=M(T^g),p=D,v=C,y=R,g=O,t+=4}return n?o(E.buffer):E.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),e}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(i(22)),r=u(i(0)),a=u(i(1)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(199)),s=i(9),l=u(i(104));function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t,i,n){(0,r.default)(this,e),this.observer=t,this.config=n,this.remuxer=i}return(0,a.default)(e,[{key:"resetInitSegment",value:function(e,t,i,n){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(e,t,i,r){for(var a=this._audioTrack,u=l.default.getID3Data(e,0)||[],d=l.default.getTimeStamp(u),f=(0,n.default)(d)?90*d:9e4*t,c=0,h=f,p=e.length,v=u.length,y=[{pts:h,dts:h,data:u}];v<p-1;)if(o.isHeader(e,v)&&v+5<p){o.initTrackConfig(a,this.observer,e,v,a.manifestCodec);var g=o.appendFrame(a,e,v,f,c);if(!g){s.logger.log("Unable to parse AAC frame");break}v+=g.length,h=g.sample.pts,c++}else l.default.isHeader(e,v)?(u=l.default.getID3Data(e,v),y.push({pts:h,dts:h,data:u}),v+=u.length):v++;this.remuxer.remux(a,{samples:[]},{samples:y,inputTimeScale:9e4},{samples:[]},t,i,r)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){if(!e)return!1;for(var t=(l.default.getID3Data(e,0)||[]).length,i=e.length;t<i;t++)if(o.probe(e,t))return s.logger.log("ADTS sync word found !"),!0;return!1}}]),e}();t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(i(0)),r=c(i(1)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(199)),o=c(i(200)),s=c(i(11)),l=c(i(234)),u=c(i(235)),d=i(9),f=i(21);function c(e){return e&&e.__esModule?e:{default:e}}var h={video:1,audio:2,id3:3,text:4},p=function(){function e(t,i,r,a){(0,n.default)(this,e),this.observer=t,this.config=r,this.typeSupported=a,this.remuxer=i,this.sampleAes=null}return(0,r.default)(e,[{key:"setDecryptData",value:function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new u.default(this.observer,this.config,e,this.discardEPB):this.sampleAes=null}},{key:"resetInitSegment",value:function(t,i,n,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",r),this._audioTrack=e.createTrack("audio",r),this._id3Track=e.createTrack("id3",r),this._txtTrack=e.createTrack("text",r),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=i,this.videoCodec=n,this._duration=r}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(t,i,n,r){var a=void 0,o=t.length,l=void 0,u=void 0,c=void 0,h=void 0,p=!1;this.contiguous=n;var v=this.pmtParsed,y=this._avcTrack,g=this._audioTrack,m=this._id3Track,E=y.pid,_=g.pid,T=m.pid,S=this._pmtId,I=y.pesData,k=g.pesData,b=m.pesData,A=this._parsePAT,w=this._parsePMT,D=this._parsePES,C=this._parseAVCPES.bind(this),R=this._parseAACPES.bind(this),O=this._parseMPEGPES.bind(this),L=this._parseID3PES.bind(this),P=e._syncOffset(t);for(o-=(o+P)%188,a=P;a<o;a+=188)if(71===t[a]){if(l=!!(64&t[a+1]),u=((31&t[a+1])<<8)+t[a+2],(48&t[a+3])>>4>1){if((c=a+5+t[a+4])===a+188)continue}else c=a+4;switch(u){case E:l&&(I&&(h=D(I))&&void 0!==h.pts&&C(h,!1),I={data:[],size:0}),I&&(I.data.push(t.subarray(c,a+188)),I.size+=a+188-c);break;case _:l&&(k&&(h=D(k))&&void 0!==h.pts&&(g.isAAC?R(h):O(h)),k={data:[],size:0}),k&&(k.data.push(t.subarray(c,a+188)),k.size+=a+188-c);break;case T:l&&(b&&(h=D(b))&&void 0!==h.pts&&L(h),b={data:[],size:0}),b&&(b.data.push(t.subarray(c,a+188)),b.size+=a+188-c);break;case 0:l&&(c+=t[c]+1),S=this._pmtId=A(t,c);break;case S:l&&(c+=t[c]+1);var M=w(t,c,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(E=M.avc)>0&&(y.pid=E),(_=M.audio)>0&&(g.pid=_,g.isAAC=M.isAAC),(T=M.id3)>0&&(m.pid=T),p&&!v&&(d.logger.log("reparse from beginning"),p=!1,a=P-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(s.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});I&&(h=D(I))&&void 0!==h.pts?(C(h,!0),y.pesData=null):y.pesData=I,k&&(h=D(k))&&void 0!==h.pts?(g.isAAC?R(h):O(h),g.pesData=null):(k&&k.size&&d.logger.log("last AAC PES packet truncated,might overlap between fragments"),g.pesData=k),b&&(h=D(b))&&void 0!==h.pts?(L(h),m.pesData=null):m.pesData=b,null==this.sampleAes?this.remuxer.remux(g,y,m,this._txtTrack,i,n,r):this.decryptAndRemux(g,y,m,this._txtTrack,i,n,r)}},{key:"decryptAndRemux",value:function(e,t,i,n,r,a,o){if(e.samples&&e.isAAC){var s=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){s.decryptAndRemuxAvc(e,t,i,n,r,a,o)})}else this.decryptAndRemuxAvc(e,t,i,n,r,a,o)}},{key:"decryptAndRemuxAvc",value:function(e,t,i,n,r,a,o){if(t.samples){var s=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){s.remuxer.remux(e,t,i,n,r,a,o)})}else this.remuxer.remux(e,t,i,n,r,a,o)}},{key:"destroy",value:function(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){return(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t,i,n){var r,a=void 0,o={audio:-1,avc:-1,id3:-1,isAAC:!0};for(r=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<r;){switch(a=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!n){d.logger.log("unkown stream type:"+e[t]);break}case 15:-1===o.audio&&(o.audio=a);break;case 21:-1===o.id3&&(o.id3=a);break;case 219:if(!n){d.logger.log("unkown stream type:"+e[t]);break}case 27:-1===o.avc&&(o.avc=a);break;case 3:case 4:i?-1===o.audio&&(o.audio=a,o.isAAC=!1):d.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:d.logger.warn("HEVC stream type found, not supported for now");break;default:d.logger.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return o}},{key:"_parsePES",value:function(e){var t=0,i=void 0,n=void 0,r=void 0,a=void 0,o=void 0,s=void 0,l=void 0,u=void 0,f=e.data;if(!e||0===e.size)return null;for(;f[0].length<19&&f.length>1;){var c=new Uint8Array(f[0].length+f[1].length);c.set(f[0]),c.set(f[1],f[0].length),f[0]=c,f.splice(1,1)}if(1===((i=f[0])[0]<<16)+(i[1]<<8)+i[2]){if((r=(i[4]<<8)+i[5])&&r>e.size-6)return null;192&(n=i[7])&&((s=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2)>4294967295&&(s-=8589934592),64&n?((l=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2)>4294967295&&(l-=8589934592),s-l>54e5&&(d.logger.warn(Math.round((s-l)/9e4)+"s delta between PTS and DTS, align them"),s=l)):l=s),u=(a=i[8])+9,e.size-=u,o=new Uint8Array(e.size);for(var h=0,p=f.length;h<p;h++){var v=(i=f[h]).byteLength;if(u){if(u>v){u-=v;continue}i=i.subarray(u),v-=u,u=0}o.set(i,t),t+=v}return r&&(r-=a+3),{data:o,pts:s,dts:l,len:r}}return null}},{key:"pushAccesUnit",value:function(e,t){if(e.units.length&&e.frame){var i=t.samples,n=i.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(n||this.contiguous)?(e.id=n,i.push(e)):t.dropped++}e.debug.length&&d.logger.log(e.pts+"/"+e.dts+":"+e.debug)}},{key:"_parseAVCPES",value:function(e,t){var i=this,n=this._avcTrack,r=this._parseAVCNALu(e.data),a=void 0,o=this.avcSample,s=void 0,u=!1,d=void 0,f=this.pushAccesUnit.bind(this),c=function(e,t,i,n){return{key:e,pts:t,dts:i,units:[],debug:n}};e.data=null,o&&r.length&&!n.audFound&&(f(o,n),o=this.avcSample=c(!1,e.pts,e.dts,"")),r.forEach(function(t){switch(t.type){case 1:s=!0,o||(o=i.avcSample=c(!0,e.pts,e.dts,"")),o.frame=!0;var r=t.data;if(u&&r.length>4){var h=new l.default(r).readSliceType();2!==h&&4!==h&&7!==h&&9!==h||(o.key=!0)}break;case 5:s=!0,o||(o=i.avcSample=c(!0,e.pts,e.dts,"")),o.key=!0,o.frame=!0;break;case 6:s=!0,(a=new l.default(i.discardEPB(t.data))).readUByte();for(var p=0,v=0,y=!1,g=0;!y&&a.bytesAvailable>1;){p=0;do{p+=g=a.readUByte()}while(255===g);v=0;do{v+=g=a.readUByte()}while(255===g);if(4===p&&0!==a.bytesAvailable){if(y=!0,181===a.readUByte()&&49===a.readUShort()&&1195456820===a.readUInt()&&3===a.readUByte()){var m=a.readUByte(),E=31&m,_=[m,a.readUByte()];for(d=0;d<E;d++)_.push(a.readUByte()),_.push(a.readUByte()),_.push(a.readUByte());i._insertSampleInOrder(i._txtTrack.samples,{type:3,pts:e.pts,bytes:_})}}else if(v<a.bytesAvailable)for(d=0;d<v;d++)a.readUByte()}break;case 7:if(s=!0,u=!0,!n.sps){var T=(a=new l.default(t.data)).readSPS();n.width=T.width,n.height=T.height,n.pixelRatio=T.pixelRatio,n.sps=[t.data],n.duration=i._duration;var S=t.data.subarray(1,4),I="avc1.";for(d=0;d<3;d++){var k=S[d].toString(16);k.length<2&&(k="0"+k),I+=k}n.codec=I}break;case 8:s=!0,n.pps||(n.pps=[t.data]);break;case 9:s=!1,n.audFound=!0,o&&f(o,n),o=i.avcSample=c(!1,e.pts,e.dts,"");break;case 12:s=!1;break;default:s=!1,o&&(o.debug+="unknown NAL "+t.type+" ")}o&&s&&o.units.push(t)}),t&&o&&(f(o,n),this.avcSample=null)}},{key:"_insertSampleInOrder",value:function(e,t){var i=e.length;if(i>0){if(t.pts>=e[i-1].pts)e.push(t);else for(var n=i-1;n>=0;n--)if(t.pts<e[n].pts){e.splice(n,0,t);break}}else e.push(t)}},{key:"_getLastNalUnit",value:function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.length){var i=this._avcTrack.samples;e=i[i.length-1]}if(e){var n=e.units;t=n[n.length-1]}return t}},{key:"_parseAVCNALu",value:function(e){var t=0,i=e.byteLength,n=void 0,r=void 0,a=this._avcTrack,o=a.naluState||0,s=o,l=[],u=void 0,d=-1,f=void 0;for(-1===o&&(d=0,f=31&e[0],o=0,t=1);t<i;)if(n=e[t++],o)if(1!==o)if(n)if(1===n){if(d>=0)u={data:e.subarray(d,t-o-1),type:f},l.push(u);else{var c=this._getLastNalUnit();if(c&&(s&&t<=4-s&&c.state&&(c.data=c.data.subarray(0,c.data.byteLength-s)),(r=t-o-1)>0)){var h=new Uint8Array(c.data.byteLength+r);h.set(c.data,0),h.set(e.subarray(0,r),c.data.byteLength),c.data=h}}t<i?(d=t,f=31&e[t],o=0):o=-1}else o=0;else o=3;else o=n?0:2;else o=n?0:1;if(d>=0&&o>=0&&(u={data:e.subarray(d,i),type:f,state:o},l.push(u)),0===l.length){var p=this._getLastNalUnit();if(p){var v=new Uint8Array(p.data.byteLength+e.byteLength);v.set(p.data,0),v.set(e,p.data.byteLength),p.data=v}}return a.naluState=o,l}},{key:"discardEPB",value:function(e){for(var t,i=e.byteLength,n=[],r=1,a=void 0;r<i-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return e;t=i-n.length,a=new Uint8Array(t);var o=0;for(r=0;r<t;o++,r++)o===n[0]&&(o++,n.shift()),a[r]=e[o];return a}},{key:"_parseAACPES",value:function(e){var t,i,n=this._audioTrack,r=e.data,o=e.pts,l=this.aacOverFlow,u=this.aacLastPTS,c=void 0,h=void 0,p=void 0;if(l){var v=new Uint8Array(l.byteLength+r.byteLength);v.set(l,0),v.set(r,l.byteLength),r=v}for(h=0,i=r.length;h<i-1&&!a.isHeader(r,h);h++);if(h){var y=void 0,g=void 0;if(h<i-1?(y="AAC PES did not start with ADTS header,offset:"+h,g=!1):(y="no ADTS header found in AAC PES",g=!0),d.logger.warn("parsing error:"+y),this.observer.trigger(s.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:g,reason:y}),g)return}if(a.initTrackConfig(n,this.observer,r,h,this.audioCodec),c=0,t=a.getFrameDuration(n.samplerate),l&&u){var m=u+t;Math.abs(m-o)>1&&(d.logger.log("AAC: align PTS for overlapping frames by "+Math.round((m-o)/90)),o=m)}for(;h<i;)if(a.isHeader(r,h)&&h+5<i){var E=a.appendFrame(n,r,h,o,c);if(!E)break;h+=E.length,p=E.sample.pts,c++}else h++;l=h<i?r.subarray(h,i):null,this.aacOverFlow=l,this.aacLastPTS=p}},{key:"_parseMPEGPES",value:function(e){for(var t=e.data,i=t.length,n=0,r=0,a=e.pts;r<i;)if(o.default.isHeader(t,r)){var s=o.default.appendFrame(this._audioTrack,t,r,a,n);if(!s)break;r+=s.length,n++}else r++}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(t){var i=e._syncOffset(t);return!(i<0||(i&&d.logger.warn("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),0))}},{key:"_syncOffset",value:function(e){for(var t=Math.min(1e3,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1}},{key:"createTrack",value:function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:h[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}}}]),e}();t.default=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(0)),r=o(i(1)),a=i(9);function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,n.default)(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return(0,r.default)(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,i=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");n.set(e.subarray(i,i+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}},{key:"skipBits",value:function(e){var t=void 0;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;return e>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?i<<t|this.readBits(t):i}},{key:"skipLZ",value:function(){var e=void 0;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t=8,i=8,n=void 0;for(n=0;n<e;n++)0!==i&&(i=(t+this.readEG()+256)%256),t=0===i?t:i}},{key:"readSPS",value:function(){var e,t,i,n,r=0,a=0,o=0,s=0,l=void 0,u=void 0,d=void 0,f=this.readUByte.bind(this),c=this.readBits.bind(this),h=this.readUEG.bind(this),p=this.readBoolean.bind(this),v=this.skipBits.bind(this),y=this.skipEG.bind(this),g=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);if(f(),e=f(),c(5),v(3),f(),g(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var E=h();if(3===E&&v(1),g(),g(),v(1),p())for(u=3!==E?8:12,d=0;d<u;d++)p()&&m(d<6?16:64)}g();var _=h();if(0===_)h();else if(1===_)for(v(1),y(),y(),l=h(),d=0;d<l;d++)y();g(),v(1),t=h(),i=h(),0===(n=c(1))&&v(1),v(1),p()&&(r=h(),a=h(),o=h(),s=h());var T=[1,1];if(p()&&p())switch(f()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[f()<<8|f(),f()<<8|f()]}return{width:Math.ceil(16*(t+1)-2*r-2*a),height:(2-n)*(i+1)*16-(n?2:4)*(o+s),pixelRatio:T}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(0)),r=o(i(1)),a=o(i(188));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t,i,r,o){(0,n.default)(this,e),this.decryptdata=r,this.discardEPB=o,this.decrypter=new a.default(t,i,{removePKCS7Padding:!1})}return(0,r.default)(e,[{key:"decryptBuffer",value:function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)}},{key:"decryptAacSample",value:function(e,t,i,n){var r=e[t].unit,a=r.subarray(16,r.length-r.length%16),o=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),s=this;this.decryptBuffer(o,function(a){a=new Uint8Array(a),r.set(a,16),n||s.decryptAacSamples(e,t+1,i)})}},{key:"decryptAacSamples",value:function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(e,t,i,n),!n)return}}}},{key:"getAvcEncryptedData",value:function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t),n=0,r=32;r<=e.length-16;r+=160,n+=16)i.set(e.subarray(r,r+16),n);return i}},{key:"getAvcDecryptedUnit",value:function(e,t){t=new Uint8Array(t);for(var i=0,n=32;n<=e.length-16;n+=160,i+=16)e.set(t.subarray(i,i+16),n);return e}},{key:"decryptAvcSample",value:function(e,t,i,n,r,a){var o=this.discardEPB(r.data),s=this.getAvcEncryptedData(o),l=this;this.decryptBuffer(s.buffer,function(s){r.data=l.getAvcDecryptedUnit(o,s),a||l.decryptAvcSamples(e,t,i+1,n)})}},{key:"decryptAvcSamples",value:function(e,t,i,n){for(;;t++,i=0){if(t>=e.length)return void n();for(var r=e[t].units;!(i>=r.length);i++){var a=r[i];if(!(a.length<=48||1!==a.type&&5!==a.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(e,t,i,n,a,o),!o)return}}}}}]),e}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(i(0)),r=l(i(1)),a=l(i(104)),o=i(9),s=l(i(200));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,i,r){(0,n.default)(this,e),this.observer=t,this.config=r,this.remuxer=i}return(0,r.default)(e,[{key:"resetInitSegment",value:function(e,t,i,n){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(e,t,i,n){for(var r=a.default.getID3Data(e,0),o=a.default.getTimeStamp(r),l=o?90*o:9e4*t,u=r.length,d=e.length,f=0,c=0,h=this._audioTrack,p=[{pts:l,dts:l,data:r}];u<d;)if(s.default.isHeader(e,u)){var v=s.default.appendFrame(h,e,u,l,f);if(!v)break;u+=v.length,c=v.sample.pts,f++}else a.default.isHeader(e,u)?(r=a.default.getID3Data(e,u),p.push({pts:c,dts:c,data:r}),u+=r.length):u++;this.remuxer.remux(h,{samples:[]},{samples:p,inputTimeScale:9e4},{samples:[]},t,i,n)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var t=void 0,i=void 0,n=a.default.getID3Data(e,0);if(n&&void 0!==a.default.getTimeStamp(n))for(t=n.length,i=Math.min(e.length-1,t+100);t<i;t++)if(s.default.probe(e,t))return o.logger.log("MPEG Audio sync word found !"),!0;return!1}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(i(43)),r=f(i(0)),a=f(i(1)),o=f(i(238)),s=f(i(239)),l=f(i(11)),u=i(21),d=i(9);function f(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t,i,n,a){(0,r.default)(this,e),this.observer=t,this.config=i,this.typeSupported=n;var o=navigator.userAgent;this.isSafari=a&&a.indexOf("Apple")>-1&&o&&!o.match("CriOS"),this.ISGenerated=!1}return(0,a.default)(e,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(e){this._initPTS=this._initDTS=e}},{key:"resetInitSegment",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,i,n,r,a,o){if(this.ISGenerated||this.generateIS(e,t,r),this.ISGenerated){var s=e.samples.length,u=t.samples.length,f=r,c=r;if(s&&u){var h=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;f+=Math.max(0,h),c+=Math.max(0,-h)}if(s){e.timescale||(d.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,r));var p=this.remuxAudio(e,f,a,o);if(u){var v=void 0;p&&(v=p.endPTS-p.startPTS),t.timescale||(d.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,r)),this.remuxVideo(t,c,a,v,o)}}else if(u){var y=this.remuxVideo(t,c,a,0,o);y&&e.codec&&this.remuxEmptyAudio(e,f,a,y)}}i.samples.length&&this.remuxID3(i,r),n.samples.length&&this.remuxText(n,r),this.observer.trigger(l.default.FRAG_PARSED)}},{key:"generateIS",value:function(e,t,i){var r=this.observer,a=e.samples,o=t.samples,f=this.typeSupported,c="audio/mp4",h={},p={tracks:h},v=void 0===this._initPTS,y=void 0,g=void 0;if(v&&(y=g=1/0),e.config&&a.length&&(e.timescale=e.samplerate,d.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(f.mpeg?(c="audio/mpeg",e.codec=""):f.mp3&&(e.codec="mp3")),h.audio={container:c,codec:e.codec,initSegment:!e.isAAC&&f.mpeg?new Uint8Array:s.default.initSegment([e]),metadata:{channelCount:e.channelCount}},v&&(y=g=a[0].pts-e.inputTimeScale*i)),t.sps&&t.pps&&o.length){var m=t.inputTimeScale;t.timescale=m,h.video={container:"video/mp4",codec:t.codec,initSegment:s.default.initSegment([t]),metadata:{width:t.width,height:t.height}},v&&(y=Math.min(y,o[0].pts-m*i),g=Math.min(g,o[0].dts-m*i),this.observer.trigger(l.default.INIT_PTS_FOUND,{initPTS:y}))}(0,n.default)(h).length?(r.trigger(l.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,v&&(this._initPTS=y,this._initDTS=g)):r.trigger(l.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,i,n,r){var a,o,f,c=8,h=void 0,p=void 0,v=void 0,y=void 0,g=e.timescale,m=e.samples,E=[],_=m.length,T=this._PTSNormalize,S=this._initPTS,I=this.nextAvcDts,k=this.isSafari;if(0!==_){k&&(i|=m.length&&I&&(r&&Math.abs(t-I/g)<.1||Math.abs(m[0].pts-I-S)<g/5)),i||(I=t*g),m.forEach(function(e){e.pts=T(e.pts-S,I),e.dts=T(e.dts-S,I)}),m.sort(function(e,t){var i=e.dts-t.dts,n=e.pts-t.pts;return i||n||e.id-t.id});var b=m.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(b<0){d.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(b/90)+" ms to overcome this issue");for(var A=0;A<m.length;A++)m[A].dts+=b}var w=m[0];y=Math.max(w.dts,0),v=Math.max(w.pts,0);var D=Math.round((y-I)/90);i&&D&&(D>1?d.logger.log("AVC:"+D+" ms hole between fragments detected,filling it"):D<-1&&d.logger.log("AVC:"+-D+" ms overlapping between fragments detected"),y=I,m[0].dts=y,v=Math.max(v-D,I),m[0].pts=v,d.logger.log("Video/PTS/DTS adjusted: "+Math.round(v/90)+"/"+Math.round(y/90)+",delta:"+D+" ms")),w=m[m.length-1],f=Math.max(w.dts,0),o=Math.max(w.pts,0,f),k&&(h=Math.round((f-y)/(m.length-1)));for(var C=0,R=0,O=0;O<_;O++){for(var L=m[O],P=L.units,M=P.length,N=0,x=0;x<M;x++)N+=P[x].data.length;R+=N,C+=M,L.length=N,L.dts=k?y+O*h:Math.max(L.dts,y),L.pts=Math.max(L.pts,L.dts)}var U=R+4*C+8;try{p=new Uint8Array(U)}catch(e){return void this.observer.trigger(l.default.ERROR,{type:u.ErrorTypes.MUX_ERROR,details:u.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:U,reason:"fail allocating video mdat "+U})}var H=new DataView(p.buffer);H.setUint32(0,U),p.set(s.default.types.mdat,4);for(var F=0;F<_;F++){for(var B=m[F],V=B.units,G=0,K=void 0,j=0,Y=V.length;j<Y;j++){var W=V[j],z=W.data,q=W.data.byteLength;H.setUint32(c,q),c+=4,p.set(z,c),c+=q,G+=4+q}if(k)K=Math.max(0,h*Math.round((B.pts-B.dts)/h));else{if(F<_-1)h=m[F+1].dts-B.dts;else{var X=this.config,$=B.dts-m[F>0?F-1:F].dts;if(X.stretchShortVideoTrack){var Q=X.maxBufferHole,Z=Math.floor(Q*g),J=(n?v+n*g:this.nextAudioPts)-B.pts;J>Z?((h=J-$)<0&&(h=$),d.logger.log("It is approximately "+J/90+" ms to the next segment; using duration "+h/90+" ms for the last video frame.")):h=$}else h=$}K=Math.round(B.pts-B.dts)}E.push({size:G,duration:h,cts:K,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:B.key?2:1,isNonSync:B.key?0:1}})}this.nextAvcDts=f+h;var ee=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,E.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var te=E[0].flags;te.dependsOn=2,te.isNonSync=0}e.samples=E,a=s.default.moof(e.sequenceNumber++,y,e),e.samples=[];var ie={data1:a,data2:p,startPTS:v/g,endPTS:(o+h)/g,startDTS:y/g,endDTS:this.nextAvcDts/g,type:"video",hasAudio:!1,hasVideo:!0,nb:E.length,dropped:ee};return this.observer.trigger(l.default.FRAG_PARSING_DATA,ie),ie}}},{key:"remuxAudio",value:function(e,t,i,n){var r=e.inputTimeScale,a=e.timescale,f=r/a,c=(e.isAAC?1024:1152)*f,h=this._PTSNormalize,p=this._initPTS,v=!e.isAAC&&this.typeSupported.mpeg,y=void 0,g=void 0,m=void 0,E=void 0,_=void 0,T=void 0,S=void 0,I=e.samples,k=[],b=this.nextAudioPts;if(i|=I.length&&b&&(n&&Math.abs(t-b/r)<.1||Math.abs(I[0].pts-b-p)<20*c),I.forEach(function(e){e.pts=e.dts=h(e.pts-p,t*r)}),0!==(I=I.filter(function(e){return e.pts>=0})).length){if(i||(b=n?t*r:I[0].pts),e.isAAC)for(var A=this.config.maxAudioFramesDrift,w=0,D=b;w<I.length;){var C,R=I[w];C=R.pts-D;var O=Math.abs(1e3*C/r);if(C<=-A*c)d.logger.warn("Dropping 1 audio frame @ "+(D/r).toFixed(3)+"s due to "+Math.round(O)+" ms overlap."),I.splice(w,1),e.len-=R.unit.length;else if(C>=A*c&&O<1e4&&D){var L=Math.round(C/c);d.logger.warn("Injecting "+L+" audio frame @ "+(D/r).toFixed(3)+"s due to "+Math.round(1e3*C/r)+" ms gap.");for(var P=0;P<L;P++){var M=Math.max(D,0);(m=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(d.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),m=R.unit.subarray()),I.splice(w,0,{unit:m,pts:M,dts:M}),e.len+=m.length,D+=c,w++}R.pts=R.dts=D,D+=c,w++}else Math.abs(C),R.pts=R.dts=D,D+=c,w++}for(var N=0,x=I.length;N<x;N++){var U=I[N],H=U.unit,F=U.pts;if(void 0!==S)g.duration=Math.round((F-S)/f);else{var B=Math.round(1e3*(F-b)/r),V=0;if(i&&e.isAAC&&B){if(B>0&&B<1e4)V=Math.round((F-b)/c),d.logger.log(B+" ms hole between AAC samples detected,filling it"),V>0&&((m=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(m=H.subarray()),e.len+=V*m.length);else if(B<-12){d.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(b/r).toFixed(3)+"s/"+(F/r).toFixed(3)+"s/"+-B+"ms"),e.len-=H.byteLength;continue}F=b}if(T=F,!(e.len>0))return;var G=v?e.len:e.len+8;y=v?0:8;try{E=new Uint8Array(G)}catch(e){return void this.observer.trigger(l.default.ERROR,{type:u.ErrorTypes.MUX_ERROR,details:u.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:G,reason:"fail allocating audio mdat "+G})}v||(new DataView(E.buffer).setUint32(0,G),E.set(s.default.types.mdat,4));for(var K=0;K<V;K++)(m=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(d.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),m=H.subarray()),E.set(m,y),y+=m.byteLength,g={size:m.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},k.push(g)}E.set(H,y);var j=H.byteLength;y+=j,g={size:j,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},k.push(g),S=F}var Y=0,W=k.length;if(W>=2&&(Y=k[W-2].duration,g.duration=Y),W){this.nextAudioPts=b=S+f*Y,e.len=0,e.samples=k,_=v?new Uint8Array:s.default.moof(e.sequenceNumber++,T/f,e),e.samples=[];var z=T/r,q=b/r,X={data1:_,data2:E,startPTS:z,endPTS:q,startDTS:z,endDTS:q,type:"audio",hasAudio:!0,hasVideo:!1,nb:W};return this.observer.trigger(l.default.FRAG_PARSING_DATA,X),X}return null}}},{key:"remuxEmptyAudio",value:function(e,t,i,n){var r=e.inputTimeScale,a=r/(e.samplerate?e.samplerate:r),s=this.nextAudioPts,l=(void 0!==s?s:n.startDTS*r)+this._initDTS,u=n.endDTS*r+this._initDTS,f=1024*a,c=Math.ceil((u-l)/f),h=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(d.logger.warn("remux empty Audio"),h){for(var p=[],v=0;v<c;v++){var y=l+v*f;p.push({unit:h,pts:y,dts:y}),e.len+=h.length}e.samples=p,this.remuxAudio(e,t,i)}else d.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}},{key:"remuxID3",value:function(e){var t=e.samples.length,i=void 0,n=e.inputTimeScale,r=this._initPTS,a=this._initDTS;if(t){for(var o=0;o<t;o++)(i=e.samples[o]).pts=(i.pts-r)/n,i.dts=(i.dts-a)/n;this.observer.trigger(l.default.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]}},{key:"remuxText",value:function(e){e.samples.sort(function(e,t){return e.pts-t.pts});var t=e.samples.length,i=void 0,n=e.inputTimeScale,r=this._initPTS;if(t){for(var a=0;a<t;a++)(i=e.samples[a]).pts=(i.pts-r)/n;this.observer.trigger(l.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]}},{key:"_PTSNormalize",value:function(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}}]),e}();t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(0)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,n.default)(this,e)}return(0,r.default)(e,null,[{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(0)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var o=Math.pow(2,32)-1,s=function(){function e(){(0,n.default)(this,e)}return(0,r.default)(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t=void 0;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:n};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,o,l,o,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,r))}},{key:"box",value:function(e){for(var t=Array.prototype.slice.call(arguments,1),i=8,n=t.length,r=n,a=void 0;n--;)i+=t[n].byteLength;for((a=new Uint8Array(i))[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4),n=0,i=8;n<r;n++)a.set(t[n],i),i+=t[n].byteLength;return a}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,i){i*=t;var n=Math.floor(i/(o+1)),r=Math.floor(i%(o+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,i,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,i))}},{key:"moov",value:function(t){for(var i=t.length,n=[];i--;)n[i]=e.trak(t[i]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var i=t.length,n=[];i--;)n[i]=e.trex(t[i]);return e.box.apply(null,[e.types.mvex].concat(n))}},{key:"mvhd",value:function(t,i){i*=t;var n=Math.floor(i/(o+1)),r=Math.floor(i%(o+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)}},{key:"sdtp",value:function(t){var i=t.samples||[],n=new Uint8Array(4+i.length),r=void 0,a=void 0;for(a=0;a<i.length;a++)r=i[a].flags,n[a+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,n)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var i=[],n=[],r=void 0,a=void 0,o=void 0;for(r=0;r<t.sps.length;r++)o=(a=t.sps[r]).byteLength,i.push(o>>>8&255),i.push(255&o),i=i.concat(Array.prototype.slice.call(a));for(r=0;r<t.pps.length;r++)o=(a=t.pps[r]).byteLength,n.push(o>>>8&255),n.push(255&o),n=n.concat(Array.prototype.slice.call(a));var s=e.box(e.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(n))),l=t.width,u=t.height,d=t.pixelRatio[0],f=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,f>>24,f>>16&255,f>>8&255,255&f])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var i=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var i=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var i=t.id,n=t.duration*t.timescale,r=t.width,a=t.height,s=Math.floor(n/(o+1)),l=Math.floor(n%(o+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,i){var n=e.sdtp(t),r=t.id,a=Math.floor(i/(o+1)),s=Math.floor(i%(o+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,n.length+16+20+8+16+8+8),n)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,i){var n=t.samples||[],r=n.length,a=12+16*r,o=new Uint8Array(a),s=void 0,l=void 0,u=void 0,d=void 0,f=void 0,c=void 0;for(i+=8+a,o.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),s=0;s<r;s++)u=(l=n[s]).duration,d=l.size,f=l.flags,c=l.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,d>>>24&255,d>>>16&255,d>>>8&255,255&d,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,61440&f.degradPrio,15&f.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*s);return e.box(e.types.trun,o)}},{key:"initSegment",value:function(t){e.types||e.init();var i=e.moov(t),n=void 0;return(n=new Uint8Array(e.FTYP.byteLength+i.byteLength)).set(e.FTYP),n.set(i,e.FTYP.byteLength),n}}]),e}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(0)),r=o(i(1)),a=o(i(11));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,n.default)(this,e),this.observer=t}return(0,r.default)(e,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(){}},{key:"remux",value:function(e,t,i,n,r,o,s,l){var u=this.observer,d="";e&&(d+="audio"),t&&(d+="video"),u.trigger(a.default.FRAG_PARSING_DATA,{data1:l,startPTS:r,startDTS:r,type:d,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),u.trigger(a.default.FRAG_PARSED)}}]),e}();t.default=s},function(e,t,i){"use strict";var n=Object.prototype.hasOwnProperty,r="~";function a(){}function o(e,t,i,n,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new function(e,t,i){this.fn=e,this.context=t,this.once=i||!1}(i,n||e,a),s=r?r+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],o]:e._events[s].push(o):(e._events[s]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function l(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(r=!1)),l.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)n.call(e,t)&&i.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},l.prototype.listeners=function(e){var t=r?r+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,a=i.length,o=new Array(a);n<a;n++)o[n]=i[n].fn;return o},l.prototype.listenerCount=function(e){var t=r?r+e:e,i=this._events[t];return i?i.fn?1:i.length:0},l.prototype.emit=function(e,t,i,n,a,o){var s=r?r+e:e;if(!this._events[s])return!1;var l,u,d=this._events[s],f=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),f){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,i),!0;case 4:return d.fn.call(d.context,t,i,n),!0;case 5:return d.fn.call(d.context,t,i,n,a),!0;case 6:return d.fn.call(d.context,t,i,n,a,o),!0}for(u=1,l=new Array(f-1);u<f;u++)l[u-1]=arguments[u];d.fn.apply(d.context,l)}else{var c,h=d.length;for(u=0;u<h;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),f){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,i);break;case 4:d[u].fn.call(d[u].context,t,i,n);break;default:if(!l)for(c=1,l=new Array(f-1);c<f;c++)l[c-1]=arguments[c];d[u].fn.apply(d[u].context,l)}}return!0},l.prototype.on=function(e,t,i){return o(this,e,t,i,!1)},l.prototype.once=function(e,t,i){return o(this,e,t,i,!0)},l.prototype.removeListener=function(e,t,i,n){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||n&&!o.once||i&&o.context!==i||s(this,a);else{for(var l=0,u=[],d=o.length;l<d;l++)(o[l].fn!==t||n&&!o[l].once||i&&o[l].context!==i)&&u.push(o[l]);u.length?this._events[a]=1===u.length?u[0]:u:s(this,a)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new a,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,e.exports=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(i(198)),r=s(i(11)),a=i(9),o=i(197);function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=new o.EventEmitter;t.trigger=function(e){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];t.emit.apply(t,[e,e].concat(n))},t.off=function(e){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];t.removeListener.apply(t,[e].concat(n))};var i=function(t,i){e.postMessage({event:t,data:i})};e.addEventListener("message",function(r){var o=r.data;switch(o.cmd){case"init":var s=JSON.parse(o.config);e.demuxer=new n.default(t,o.typeSupported,s,o.vendor),(0,a.enableLogs)(s.debug),i("init",null);break;case"demux":e.demuxer.push(o.data,o.decryptdata,o.initSegment,o.audioCodec,o.videoCodec,o.timeOffset,o.discontinuity,o.trackSwitch,o.contiguous,o.duration,o.accurateTimeOffset,o.defaultInitPTS)}}),t.on(r.default.FRAG_DECRYPTED,i),t.on(r.default.FRAG_PARSING_INIT_SEGMENT,i),t.on(r.default.FRAG_PARSED,i),t.on(r.default.ERROR,i),t.on(r.default.FRAG_PARSING_METADATA,i),t.on(r.default.FRAG_PARSING_USERDATA,i),t.on(r.default.INIT_PTS_FOUND,i),t.on(r.default.FRAG_PARSING_DATA,function(t,i){var n=[],r={event:t,data:i};i.data1&&(r.data1=i.data1.buffer,n.push(i.data1.buffer),delete i.data1),i.data2&&(r.data2=i.data2.buffer,n.push(i.data2.buffer),delete i.data2),e.postMessage(r,n)})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(i(0)),r=u(i(1)),a=i(73),o=i(21),s=u(i(11)),l=i(9);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t,i,r,a){(0,n.default)(this,e),this.config=t,this.media=i,this.fragmentTracker=r,this.hls=a,this.stallReported=!1}return(0,r.default)(e,[{key:"poll",value:function(e,t){var i=this.config,n=this.media,r=n.currentTime,o=window.performance.now();if(r!==e)return this.stallReported&&(l.logger.warn("playback not stuck anymore @"+r+", after "+Math.round(o-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(n.ended||!n.buffered.length||n.readyState>2||n.seeking&&a.BufferHelper.isBuffered(n,r))){var s=o-this.stalled,u=a.BufferHelper.bufferInfo(n,r,i.maxBufferHole);this.stalled?(s>=1e3&&this._reportStall(u.len),this._tryFixBufferStall(u,s)):this.stalled=o}}},{key:"_tryFixBufferStall",value:function(e,t){var i=this.config,n=this.fragmentTracker,r=this.media.currentTime,a=n.getPartialFragment(r);a&&this._trySkipBufferHole(a),e.len>.5&&t>1e3*i.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())}},{key:"_reportStall",value:function(e){var t=this.hls,i=this.media;this.stallReported||(this.stallReported=!0,l.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer"),t.trigger(s.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))}},{key:"_trySkipBufferHole",value:function(e){for(var t=this.hls,i=this.media,n=i.currentTime,r=0,a=0;a<i.buffered.length;a++){var u=i.buffered.start(a);if(n>=r&&n<u)return i.currentTime=Math.max(u,i.currentTime+.1),l.logger.warn("skipping hole, adjusting currentTime from "+n+" to "+i.currentTime),this.stalled=null,void t.trigger(s.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+i.currentTime,frag:e});r=i.buffered.end(a)}}},{key:"_tryNudgeBuffer",value:function(){var e=this.config,t=this.hls,i=this.media,n=i.currentTime,r=(this.nudgeRetry||0)+1;if(this.nudgeRetry=r,r<e.nudgeMaxRetry){var a=n+r*e.nudgeOffset;l.logger.log("adjust currentTime from "+n+" to "+a),i.currentTime=a,t.trigger(s.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else l.logger.error("still stuck in high buffer @"+n+" after "+e.nudgeMaxRetry+", raise fatal error"),t.trigger(s.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}}]),e}();t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=v(i(35)),r=v(i(2)),a=v(i(0)),o=v(i(1)),s=v(i(3)),l=v(i(4)),u=v(i(11)),d=v(i(29)),f=i(9),c=i(21),h=i(195),p=i(190);function v(e){return e&&e.__esModule?e:{default:e}}var y=window.performance,g=void 0,m=function(e){function t(e){(0,a.default)(this,t);var i=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.FRAG_LOADED,u.default.ERROR));return i.canload=!1,i.currentLevelIndex=null,i.manualLevelIndex=-1,i.timer=null,g=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),i}return(0,l.default)(t,e),(0,o.default)(t,[{key:"onHandlerDestroying",value:function(){this.clearTimer(),this.manualLevelIndex=-1}},{key:"clearTimer",value:function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}},{key:"startLoad",value:function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t=[],i=[],n=void 0,r={},a=null,o=!1,s=!1;if(e.levels.forEach(function(e){var i=e.attrs;e.loadError=0,e.fragmentError=!1,o=o||!!e.videoCodec,s=s||!!e.audioCodec,g&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(a=r[e.bitrate])?a.url.push(e.url):(e.url=[e.url],e.urlId=0,r[e.bitrate]=e,t.push(e)),i&&(i.AUDIO&&(s=!0,(0,p.addGroupId)(a||e,"audio",i.AUDIO)),i.SUBTITLES&&(0,p.addGroupId)(a||e,"text",i.SUBTITLES))}),o&&s&&(t=t.filter(function(e){return!!e.videoCodec})),t=t.filter(function(e){var t=e.audioCodec,i=e.videoCodec;return(!t||(0,h.isCodecSupportedInMp4)(t))&&(!i||(0,h.isCodecSupportedInMp4)(i))}),e.audioTracks&&(i=e.audioTracks.filter(function(e){return!e.audioCodec||(0,h.isCodecSupportedInMp4)(e.audioCodec,"audio")})).forEach(function(e,t){e.id=t}),t.length>0){n=t[0].bitrate,t.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=t;for(var l=0;l<t.length;l++)if(t[l].bitrate===n){this._firstLevel=l,f.logger.log("manifest loaded,"+t.length+" level(s) found, first bitrate:"+n);break}this.hls.trigger(u.default.MANIFEST_PARSED,{levels:t,audioTracks:i,firstLevel:this._firstLevel,stats:e.stats,audio:s,video:o,altAudio:i.some(function(e){return!!e.url})})}else this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){var t=this._levels,i=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){f.logger.log("switching to level "+e),this.currentLevelIndex=e;var n=t[e];n.level=e,i.trigger(u.default.LEVEL_SWITCHING,n)}var r=t[e],a=r.details;if(!a||a.live){var o=r.urlId;i.trigger(u.default.LEVEL_LOADING,{url:r.url[o],level:e,id:o})}}else i.trigger(u.default.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(e.fatal)e.type===c.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t=!1,i=!1,n=void 0;switch(e.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:n=e.frag.level,i=!0;break;case c.ErrorDetails.LEVEL_LOAD_ERROR:case c.ErrorDetails.LEVEL_LOAD_TIMEOUT:n=e.context.level,t=!0;break;case c.ErrorDetails.REMUX_ALLOC_ERROR:n=e.level,t=!0}void 0!==n&&this.recoverLevel(e,n,t,i)}}},{key:"recoverLevel",value:function(e,t,i,n){var r=this,a=this.hls.config,o=e.details,s=this._levels[t],l=void 0,u=void 0,d=void 0;if(s.loadError++,s.fragmentError=n,i){if(!(this.levelRetryCount+1<=a.levelLoadingMaxRetry))return f.logger.error("level controller, cannot recover from "+o+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);u=Math.min(Math.pow(2,this.levelRetryCount)*a.levelLoadingRetryDelay,a.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return r.loadLevel()},u),e.levelRetry=!0,this.levelRetryCount++,f.logger.warn("level controller, "+o+", retry in "+u+" ms, current retry count is "+this.levelRetryCount)}(i||n)&&((l=s.url.length)>1&&s.loadError<l?(s.urlId=(s.urlId+1)%l,s.details=void 0,f.logger.warn("level controller, "+o+" for level "+t+": switching to redundant URL-id "+s.urlId)):-1===this.manualLevelIndex?(d=0===t?this._levels.length-1:t-1,f.logger.warn("level controller, "+o+": switch to "+d),this.hls.nextAutoLevel=this.currentLevelIndex=d):n&&(f.logger.warn("level controller, "+o+": reload a fragment"),this.currentLevelIndex=null))}},{key:"onFragLoaded",value:function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var i=this._levels[t.level];void 0!==i&&(i.fragmentError=!1,i.loadError=0,this.levelRetryCount=0)}}},{key:"onLevelLoaded",value:function(e){var t=this,i=e.level;if(i===this.currentLevelIndex){var n=this._levels[i];n.fragmentError||(n.loadError=0,this.levelRetryCount=0);var r=e.details;if(r.live){var a=1e3*(r.averagetargetduration?r.averagetargetduration:r.targetduration),o=a,s=n.details;s&&r.endSN===s.endSN&&(o/=2,f.logger.log("same live playlist, reload twice faster")),o-=y.now()-e.stats.trequest,o=Math.max(a/2,Math.round(o)),f.logger.log("live playlist, reload in "+Math.round(o)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},o)}else this.clearTimer()}}},{key:"onAudioTrackSwitched",value:function(e){var t=this.hls.audioTracks[e.id].groupId,i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){var n=i.audioGroupIds.findIndex(function(e){return e===t});n!==i.urlId&&(i.urlId=n,this.startLoad())}}},{key:"loadLevel",value:function(){if(f.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"===(void 0===e?"undefined":(0,n.default)(e))&&e.url.length>0){var t=this.currentLevelIndex,i=e.urlId,r=e.url[i];f.logger.log("Attempt loading level index "+t+" with URL-id "+i),this.hls.trigger(u.default.LEVEL_LOADING,{url:r,level:t,id:i})}}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}(d.default);t.default=m},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(i(2)),r=c(i(0)),a=c(i(1)),o=c(i(3)),s=c(i(4)),l=c(i(11)),u=c(i(29)),d=c(i(104)),f=i(206);function c(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(e){(0,r.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.FRAG_PARSING_METADATA));return i.id3Track=void 0,i.media=void 0,i}return(0,s.default)(t,e),(0,a.default)(t,[{key:"destroy",value:function(){u.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(e){this.media=e.media,this.media}},{key:"onMediaDetaching",value:function(){(0,f.clearCurrentCues)(this.id3Track),this.id3Track=void 0,this.media=void 0}},{key:"getID3Track",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];if("metadata"===i.kind&&"id3"===i.label)return(0,f.sendAddTrackEvent)(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},{key:"onFragParsingMetadata",value:function(e){var t=e.frag,i=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,r=0;r<i.length;r++){var a=d.default.getID3Frames(i[r].data);if(a){var o=i[r].pts,s=r<i.length-1?i[r+1].pts:t.endPTS;o===s&&(s+=1e-4);for(var l=0;l<a.length;l++){var u=a[l];if(!d.default.isTimeStampFrame(u)){var f=new n(o,s,"");f.value=u,this.id3Track.addCue(f)}}}}}}]),t}(u.default);t.default=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSupported=function(){var e=(0,n.getMediaSource)(),t=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!r};var n=i(189)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hlsDefaultConfig=void 0;var n=y(i(248)),r=y(i(251)),a=y(i(252)),o=y(i(253)),s=y(i(254)),l=y(i(255)),u=y(i(256)),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(257)),f=y(i(259)),c=y(i(263)),h=i(264),p=y(i(265)),v=i(266);function y(e){return e&&e.__esModule?e:{default:e}}window.__USE_SUBTITLES__=!0,window.__USE_ALT_AUDIO__=!0,window.__USE_EME_DRM__=!0;var g=t.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:3,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:s.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:n.default,bufferController:r.default,capLevelController:a.default,fpsController:o.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:v.requestMediaKeySystemAccess};__USE_SUBTITLES__&&(g.subtitleStreamController=h.SubtitleStreamController,g.subtitleTrackController=c.default,g.timelineController=f.default,g.cueHandler=d,g.enableCEA708Captions=!0,g.enableWebVTT=!0,g.captionsTextTrack1Label="English",g.captionsTextTrack1LanguageCode="en",g.captionsTextTrack2Label="Spanish",g.captionsTextTrack2LanguageCode="es"),__USE_ALT_AUDIO__&&(g.audioStreamController=u.default,g.audioTrackController=l.default),__USE_EME_DRM__&&(g.emeController=p.default)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=v(i(22)),r=v(i(2)),a=v(i(0)),o=v(i(1)),s=v(i(3)),l=v(i(4)),u=v(i(11)),d=v(i(29)),f=i(73),c=i(21),h=i(9),p=v(i(249));function v(e){return e&&e.__esModule?e:{default:e}}var y=window.performance,g=function(e){function t(e){(0,a.default)(this,t);var i=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR));return i.lastLoadedFragLevel=0,i._nextAutoLevel=-1,i.hls=e,i.timer=null,i._bwEstimator=null,i.onCheck=i._abandonRulesCheck.bind(i),i}return(0,l.default)(t,e),(0,o.default)(t,[{key:"destroy",value:function(){this.clearTimer(),d.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var i=this.hls,n=i.config,r=t.level,a=void 0,o=void 0;i.levels[r].details.live?(a=n.abrEwmaFastLive,o=n.abrEwmaSlowLive):(a=n.abrEwmaFastVoD,o=n.abrEwmaSlowVoD),this._bwEstimator=new p.default(i,o,a,n.abrEwmaDefaultEstimate)}}},{key:"_abandonRulesCheck",value:function(){var e=this.hls,t=e.media,i=this.fragCurrent;if(i){var n=i.loader,r=e.minAutoLevel;if(!n||n.stats&&n.stats.aborted)return h.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var a=n.stats;if(t&&a&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&i.autoLevel&&i.level){var o=y.now()-a.trequest,s=Math.abs(t.playbackRate);if(o>500*i.duration/s){var l=e.levels,d=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/o),c=l[i.level],p=c.realBitrate?Math.max(c.realBitrate,c.bitrate):c.bitrate,v=a.total?a.total:Math.max(a.loaded,Math.round(i.duration*p/8)),g=t.currentTime,m=(v-a.loaded)/d,E=(f.BufferHelper.bufferInfo(t,g,e.config.maxBufferHole).end-g)/s;if(E<2*i.duration/s&&m>E){var _=void 0,T=void 0;for(T=i.level-1;T>r;T--){var S=l[T].realBitrate?Math.max(l[T].realBitrate,l[T].bitrate):l[T].bitrate;if((_=i.duration*S/(6.4*d))<E)break}_<m&&(h.logger.warn("loading too slow, abort fragment loading and switch to level "+T+":fragLoadedDelay["+T+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+_.toFixed(1)+"<"+m.toFixed(1)+":"+E.toFixed(1)),e.nextLoadLevel=T,this._bwEstimator.sample(o,a.loaded),n.abort(),this.clearTimer(),e.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:a}))}}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if("main"===t.type&&(0,n.default)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[t.level],r=(i.loaded?i.loaded.bytes:0)+e.stats.loaded,a=(i.loaded?i.loaded.duration:0)+e.frag.duration;i.loaded={bytes:r,duration:a},i.realBitrate=Math.round(8*r/a)}if(e.frag.bitrateTest){var o=e.stats;o.tparsed=o.tbuffered=o.tload,this.onFragBuffered(e)}}}},{key:"onFragBuffered",value:function(e){var t=e.stats,i=e.frag;if(!0!==t.aborted&&"main"===i.type&&(0,n.default)(i.sn)&&(!i.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;h.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(r,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(e){switch(e.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){clearInterval(this.timer),this.timer=null}},{key:"_findBestLevel",value:function(e,t,i,n,r,a,o,s,l){for(var u=r;u>=n;u--){var d=l[u];if(d){var f,c=d.details,p=c?c.totalduration/c.fragments.length:t,v=!!c&&c.live;f=u<=e?o*i:s*i;var y=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,g=y*p/f;if(h.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(f)+"/"+y+"/"+p+"/"+a+"/"+g),f>y&&(!g||v&&!this.bitrateTestDelay||g<a))return u}}return-1}},{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var i=this._nextABRAutoLevel;return-1!==e&&(i=Math.min(e,i)),i},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,i=e.levels,n=e.config,r=e.minAutoLevel,a=e.media,o=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,l=a?a.currentTime:0,u=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,c=(f.BufferHelper.bufferInfo(a,l,n.maxBufferHole).end-l)/u,p=this._findBestLevel(o,s,d,r,t,c,n.abrBandWidthFactor,n.abrBandWidthUpFactor,i);if(p>=0)return p;h.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var v=s?Math.min(s,n.maxStarvationDelay):n.maxStarvationDelay,y=n.abrBandWidthFactor,g=n.abrBandWidthUpFactor;if(0===c){var m=this.bitrateTestDelay;m&&(v=(s?Math.min(s,n.maxLoadingDelay):n.maxLoadingDelay)-m,h.logger.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),y=g=1)}return p=this._findBestLevel(o,s,d,r,t,c+v,y,g,i),Math.max(p,0)}}]),t}(d.default);t.default=g},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(0)),r=o(i(1)),a=o(i(250));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t,i,r,o){(0,n.default)(this,e),this.hls=t,this.defaultEstimate_=o,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new a.default(i),this.fast_=new a.default(r)}return(0,r.default)(e,[{key:"sample",value:function(e,t){var i=8e3*t/(e=Math.max(e,this.minDelayMs_)),n=e/1e3;this.fast_.sample(n,i),this.slow_.sample(n,i)}},{key:"canEstimate",value:function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),e}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(0)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(t){(0,n.default)(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return(0,r.default)(e,[{key:"sample",value:function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=p(i(22)),r=p(i(43)),a=p(i(2)),o=p(i(0)),s=p(i(1)),l=p(i(3)),u=p(i(4)),d=p(i(11)),f=p(i(29)),c=i(9),h=i(21);function p(e){return e&&e.__esModule?e:{default:e}}var v=(0,i(189).getMediaSource)(),y=function(e){function t(e){(0,o.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,d.default.MEDIA_ATTACHING,d.default.MEDIA_DETACHING,d.default.MANIFEST_PARSED,d.default.BUFFER_RESET,d.default.BUFFER_APPENDING,d.default.BUFFER_CODECS,d.default.BUFFER_EOS,d.default.BUFFER_FLUSHING,d.default.LEVEL_PTS_UPDATED,d.default.LEVEL_UPDATED));return i._msDuration=null,i._levelDuration=null,i._levelTargetDuration=10,i._live=null,i._objectUrl=null,i.bufferCodecEventsExpected=0,i.onsbue=i.onSBUpdateEnd.bind(i),i.onsbe=i.onSBUpdateError.bind(i),i.pendingTracks={},i.tracks={},i}return(0,u.default)(t,e),(0,s.default)(t,[{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(e){var t=e.type,i=this.tracks.audio;if("audio"===t&&i&&"audio/mpeg"===i.container){var n=this.sourceBuffer.audio;if(Math.abs(n.timestampOffset-e.start)>.1){var r=n.updating;try{n.abort()}catch(e){c.logger.warn("can not abort audio buffer: "+e)}r?this.audioTimestampOffset=e.start:(c.logger.warn("change mpeg audio timestamp offset from "+n.timestampOffset+" to "+e.start),n.timestampOffset=e.start)}}}},{key:"onManifestParsed",value:function(e){this.bufferCodecEventsExpected=e.altAudio?2:1,c.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;if(t){var i=this.mediaSource=new v;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),t.src=window.URL.createObjectURL(i),this._objectUrl=t.src}}},{key:"onMediaDetaching",value:function(){c.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){c.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):c.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(d.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){c.logger.log("media source opened"),this.hls.trigger(d.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,i=(0,r.default)(t).length;(i&&!e||2===i)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){c.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){c.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;c.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,i=this.segments.reduce(function(e,i){return i.parent===t?e+1:e},0),n={},r=this.sourceBuffer;for(var a in r)n[a]=r[a].buffered;this.hls.trigger(d.default.BUFFER_APPENDED,{parent:t,pending:i,timeRanges:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration(),0===i&&this.flushLiveBackBuffer()}},{key:"onSBUpdateError",value:function(e){c.logger.error("sourceBuffer error:",e),this.hls.trigger(d.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;for(var t in e){var i=e[t];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){var t=this;if(!(0,r.default)(this.sourceBuffer).length){(0,r.default)(e).forEach(function(i){t.pendingTracks[i]=e[i]});var i=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),i&&"open"===i.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(e){var t=this.sourceBuffer,i=this.mediaSource;for(var n in e)if(!t[n]){var r=e[n],a=r.levelCodec||r.codec,o=r.container+";codecs="+a;c.logger.log("creating sourceBuffer("+o+")");try{var s=t[n]=i.addSourceBuffer(o);s.addEventListener("updateend",this.onsbue),s.addEventListener("error",this.onsbe),this.tracks[n]={codec:a,container:r.container},r.buffer=s}catch(e){c.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(d.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:o})}}this.hls.trigger(d.default.BUFFER_CREATED,{tracks:e})}},{key:"onBufferAppending",value:function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())}},{key:"onBufferAppendFail",value:function(e){c.logger.error("sourceBuffer error:",e.event),this.hls.trigger(d.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function(e){var t=this.sourceBuffer,i=e.type;for(var n in t)i&&n!==i||t[n].ended||(t[n].ended=!0,c.logger.log(n+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var i in e){var n=e[i];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}c.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){c.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"flushLiveBackBuffer",value:function(){if(this._live){var e=this.hls.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))for(var t=this.media.currentTime,i=this.sourceBuffer,n=(0,r.default)(i),a=t-Math.max(e,this._levelTargetDuration),o=n.length-1;o>=0;o--){var s=n[o],l=i[s].buffered;l.length>0&&a>l.start(0)&&this.removeBufferRange(s,i[s],0,a)}}}},{key:"onLevelUpdated",value:function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var e,t=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var i in this.sourceBuffer)if(!0===this.sourceBuffer[i].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(c.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!(0,n.default)(e))&&(c.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,i=this.sourceBuffer;try{for(var n in i)t+=i[n].buffered.length}catch(e){c.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(d.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,t=this.segments,i=this.sourceBuffer;if((0,r.default)(i).length){if(this.media.error)return this.segments=[],void c.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(t&&t.length){var n=t.shift();try{var a=i[n.type];a?a.updating?t.unshift(n):(a.ended=!1,this.parent=n.parent,a.appendBuffer(n.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(i){c.logger.error("error while trying to append buffer:"+i.message),t.unshift(n);var o={type:h.ErrorTypes.MEDIA_ERROR,parent:n.parent};22!==i.code?(this.appendError?this.appendError++:this.appendError=1,o.details=h.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry?(c.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],o.fatal=!0,e.trigger(d.default.ERROR,o)):(o.fatal=!1,e.trigger(d.default.ERROR,o))):(this.segments=[],o.details=h.ErrorDetails.BUFFER_FULL_ERROR,o.fatal=!1,e.trigger(d.default.ERROR,o))}}}}},{key:"flushBuffer",value:function(e,t,i){var n=void 0,a=this.sourceBuffer;if((0,r.default)(a).length){if(c.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var o in a)if(!i||o===i){if((n=a[o]).ended=!1,n.updating)return c.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(o,n,e,t))return this.flushBufferCounter++,!1}}else c.logger.warn("abort flushing too many retries");c.logger.log("buffer flushed")}return!0}},{key:"removeBufferRange",value:function(e,t,i,n){try{for(var r=0;r<t.buffered.length;r++){var a=t.buffered.start(r),o=t.buffered.end(r),s=Math.max(a,i),l=Math.min(o,n);if(Math.min(l,o)-s>.5)return c.logger.log("sb remove "+e+" ["+s+","+l+"], of ["+a+","+o+"], pos:"+this.media.currentTime),t.remove(s,l),!0}}catch(e){c.logger.warn("removeBufferRange failed",e)}return!1}}]),t}(f.default);t.default=y},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(i(2)),r=u(i(0)),a=u(i(1)),o=u(i(3)),s=u(i(4)),l=u(i(11));function u(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){(0,r.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e,l.default.FPS_DROP_LEVEL_CAPPING,l.default.MEDIA_ATTACHING,l.default.MANIFEST_PARSED,l.default.BUFFER_CODECS,l.default.MEDIA_DETACHING));return i.autoLevelCapping=Number.POSITIVE_INFINITY,i.firstLevel=null,i.levels=[],i.media=null,i.restrictedLevels=[],i.timer=null,i}return(0,s.default)(t,e),(0,a.default)(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())}},{key:"onFpsDropLevelCapping",value:function(e){t.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this._startCapping()}},{key:"onBufferCodecs",value:function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this._startCapping()}},{key:"onLevelsUpdated",value:function(e){this.levels=e.levels}},{key:"onMediaDetaching",value:function(){this._stopCapping()}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(e){var i=this;if(!this.levels)return-1;var n=this.levels.filter(function(n,r){return t.isLevelAllowed(r,i.restrictedLevels)&&r<=e});return t.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}},{key:"_startCapping",value:function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"_stopCapping",value:function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)}},{key:"mediaWidth",get:function(){var e=void 0,i=this.media;return i&&(e=i.width||i.clientWidth||i.offsetWidth,e*=t.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,i=this.media;return i&&(e=i.height||i.clientHeight||i.offsetHeight,e*=t.contentScaleFactor),e}}],[{key:"isLevelAllowed",value:function(e){return-1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).indexOf(e)}},{key:"getMaxLevelByMediaSize",value:function(e,t,i){if(!e||e&&!e.length)return-1;for(var n,r,a=e.length-1,o=0;o<e.length;o+=1){var s=e[o];if((s.width>=t||s.height>=i)&&(n=s,!(r=e[o+1])||n.width!==r.width||n.height!==r.height)){a=o;break}}return a}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}]),t}(u(i(29)).default);t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(i(2)),r=f(i(0)),a=f(i(1)),o=f(i(3)),s=f(i(4)),l=f(i(11)),u=f(i(29)),d=i(9);function f(e){return e&&e.__esModule?e:{default:e}}var c=window.performance,h=function(e){function t(e){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e,l.default.MEDIA_ATTACHING))}return(0,s.default)(t,e),(0,a.default)(t,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))}},{key:"checkFPS",value:function(e,t,i){var n=c.now();if(t){if(this.lastTime){var r=n-this.lastTime,a=i-this.lastDroppedFrames,o=t-this.lastDecodedFrames,s=1e3*a/r,u=this.hls;if(u.trigger(l.default.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:i}),s>0&&a>u.config.fpsDroppedMonitoringThreshold*o){var f=u.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(-1===u.autoLevelCapping||u.autoLevelCapping>=f)&&(f-=1,u.trigger(l.default.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:u.currentLevel}),u.autoLevelCapping=f,u.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),t}(u.default);t.default=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(0)),r=o(i(1)),a=i(9);function o(e){return e&&e.__esModule?e:{default:e}}var s=window,l=s.performance,u=s.XMLHttpRequest,d=function(){function e(t){(0,n.default)(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return(0,r.default)(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(e,t,i){this.context=e,this.config=t,this.callbacks=i,this.stats={trequest:l.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e=void 0,t=this.context;e=this.loader=new u;var i=this.stats;i.tfirst=0,i.loaded=0;var n=this.xhrSetup;try{if(n)try{n(e,t.url)}catch(i){e.open("GET",t.url,!0),n(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(i){return void this.callbacks.onError({code:e.status,text:i.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"readystatechange",value:function(e){var t=e.currentTarget,i=t.readyState,n=this.stats,r=this.context,o=this.config;if(!n.aborted&&i>=2)if(window.clearTimeout(this.requestTimeout),0===n.tfirst&&(n.tfirst=Math.max(l.now(),n.trequest)),4===i){var s=t.status;if(s>=200&&s<300){n.tload=Math.max(n.tfirst,l.now());var u,d=void 0;u="arraybuffer"===r.responseType?(d=t.response).byteLength:(d=t.responseText).length,n.loaded=n.total=u;var f={url:t.responseURL,data:d};this.callbacks.onSuccess(f,n,r,t)}else n.retry>=o.maxRetry||s>=400&&s<499?(a.logger.error(s+" while loading "+r.url),this.callbacks.onError({code:s,text:t.statusText},r,t)):(a.logger.warn(s+" while loading "+r.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),n.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)}},{key:"loadtimeout",value:function(){a.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)}},{key:"loadprogress",value:function(e){var t=e.currentTarget,i=this.stats;i.loaded=e.loaded,e.lengthComputable&&(i.total=e.total);var n=this.callbacks.onProgress;n&&n(i,this.context,null,t)}}]),e}();t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=h(i(49)),r=h(i(2)),a=h(i(0)),o=h(i(1)),s=h(i(3)),l=h(i(4)),u=h(i(11)),d=h(i(191)),f=i(9),c=i(21);function h(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){(0,a.default)(this,t);var i=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.AUDIO_TRACK_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.LEVEL_LOADED,u.default.ERROR));return i._trackId=-1,i._selectDefaultTrack=!0,i.tracks=[],i.trackIdBlacklist=(0,n.default)(null),i.audioGroupId=null,i}return(0,l.default)(t,e),(0,o.default)(t,[{key:"onManifestLoading",value:function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0}},{key:"onManifestParsed",value:function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{audioTracks:t})}},{key:"onAudioTrackLoaded",value:function(e){if(e.id>=this.tracks.length)f.logger.warn("Invalid audio track id:",e.id);else{if(f.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}}},{key:"onAudioTrackSwitched",value:function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)}},{key:"onLevelLoaded",value:function(e){var t=this.hls.levels[e.level];if(t.audioGroupIds){var i=t.audioGroupIds[t.urlId];this.audioGroupId!==i&&(this.audioGroupId=i,this._selectInitialAudioTrack())}}},{key:"onError",value:function(e){e.type===c.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(f.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))}},{key:"_setAudioTrack",value:function(e){if(this._trackId===e&&this.tracks[this._trackId].details)f.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)f.logger.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];f.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var i=t.url,n=t.type,r=t.id;this.hls.trigger(u.default.AUDIO_TRACK_SWITCHING,{id:r,type:n,url:i}),this._loadTrackDetailsIfNeeded(t)}}},{key:"doTick",value:function(){this._updateTrack(this._trackId)}},{key:"_selectInitialAudioTrack",value:function(){var e=this,t=this.tracks;if(t.length){var i=this.tracks[this._trackId],n=null;if(i&&(n=i.name),this._selectDefaultTrack){var r=t.filter(function(e){return e.default});r.length?t=r:f.logger.warn("No default audio tracks defined")}var a=!1,o=function(){t.forEach(function(t){a||e.audioGroupId&&t.groupId!==e.audioGroupId||n&&n!==t.name||(e._setAudioTrack(t.id),a=!0)})};o(),a||(n=null,o()),a||(f.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}}},{key:"_needsTrackLoading",value:function(e){var t=e.details,i=e.url;return!(t&&!t.live||!i)}},{key:"_loadTrackDetailsIfNeeded",value:function(e){if(this._needsTrackLoading(e)){var t=e.url,i=e.id;f.logger.log("loading audio-track playlist for id: "+i),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{url:t,id:i})}}},{key:"_updateTrack",value:function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,f.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}}},{key:"_handleLoadError",value:function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],i=t.name,n=t.language,r=t.groupId;f.logger.warn("Loading failed on audio track id: "+e+", group-id: "+r+', name/language: "'+i+'" / "'+n+'"');for(var a=e,o=0;o<this.tracks.length;o++)if(!this.trackIdBlacklist[o]&&this.tracks[o].name===i){a=o;break}a!==e?(f.logger.log("Attempting audio-track fallback id:",a,"group-id:",this.tracks[a].groupId),this._setAudioTrack(a)):f.logger.warn('No fallback audio-track found for name/language: "'+i+'" / "'+n+'"')}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}]),t}(d.default);t.default=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=I(i(22)),r=I(i(2)),a=I(i(0)),o=I(i(1)),s=I(i(3)),l=I(i(72)),u=I(i(4)),d=I(i(103)),f=i(73),c=I(i(196)),h=I(i(11)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(190)),v=I(i(202)),y=i(21),g=i(9),m=i(203),E=i(100),_=I(i(187)),T=i(205),S=I(T);function I(e){return e&&e.__esModule?e:{default:e}}var k=window.performance,b=function(e){function t(e,i){(0,a.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.AUDIO_TRACKS_UPDATED,h.default.AUDIO_TRACK_SWITCHING,h.default.AUDIO_TRACK_LOADED,h.default.KEY_LOADED,h.default.FRAG_LOADED,h.default.FRAG_PARSING_INIT_SEGMENT,h.default.FRAG_PARSING_DATA,h.default.FRAG_PARSED,h.default.ERROR,h.default.BUFFER_RESET,h.default.BUFFER_CREATED,h.default.BUFFER_APPENDED,h.default.BUFFER_FLUSHED,h.default.INIT_PTS_FOUND));return n.fragmentTracker=i,n.config=e.config,n.audioCodecSwap=!1,n._state=T.State.STOPPED,n.initPTS=[],n.waitingFragment=null,n.videoTrackCC=null,n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"onHandlerDestroying",value:function(){this.stopLoad(),(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"onHandlerDestroying",this).call(this)}},{key:"onHandlerDestroyed",value:function(){this.state=T.State.STOPPED,this.fragmentTracker=null,(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"onHandlerDestroyed",this).call(this)}},{key:"onInitPtsFound",value:function(e){var t=e.id,i=e.frag.cc,n=e.initPTS;"main"===t&&(this.initPTS[i]=n,this.videoTrackCC=i,g.logger.log("InitPTS for cc: "+i+" found from video track: "+n),this.state===T.State.WAITING_INIT_PTS&&this.tick())}},{key:"startLoad",value:function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(g.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=T.State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=T.State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=T.State.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=T.State.STOPPED}},{key:"doTick",value:function(){var e=void 0,t=void 0,i=void 0,r=this.hls,a=r.config;switch(this.state){case T.State.ERROR:case T.State.PAUSED:case T.State.BUFFER_FLUSHING:break;case T.State.STARTING:this.state=T.State.WAITING_TRACK,this.loadedmetadata=!1;break;case T.State.IDLE:var o=this.tracks;if(!o)break;if(!this.media&&(this.startFragRequested||!a.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var s=this.mediaBuffer?this.mediaBuffer:this.media,l=this.videoBuffer?this.videoBuffer:this.media,u=f.BufferHelper.bufferInfo(s,e,a.maxBufferHole),c=f.BufferHelper.bufferInfo(l,e,a.maxBufferHole),p=u.len,v=u.end,y=this.fragPrevious,_=Math.min(a.maxBufferLength,a.maxMaxBufferLength),S=Math.max(_,c.len),I=this.audioSwitch,b=this.trackId;if((p<S||I)&&b<o.length){if(void 0===(i=o[b].details)){this.state=T.State.WAITING_TRACK;break}if(!I&&this._streamEnded(u,i))return this.hls.trigger(h.default.BUFFER_EOS,{type:"audio"}),void(this.state=T.State.ENDED);var A=i.fragments,w=A.length,D=A[0].start,C=A[w-1].start+A[w-1].duration,R=void 0;if(I)if(i.live&&!i.PTSKnown)g.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),v=0;else if(v=e,i.PTSKnown&&e<D){if(!(u.end>D||u.nextStart))return;g.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=D+.05}if(i.initSegment&&!i.initSegment.data)R=i.initSegment;else if(v<=D){if(R=A[0],null!==this.videoTrackCC&&R.cc!==this.videoTrackCC&&(R=(0,m.findFragWithCC)(A,this.videoTrackCC)),i.live&&R.loadIdx&&R.loadIdx===this.fragLoadIdx){var O=u.nextStart?u.nextStart:D;return g.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(O+.05)),void(this.media.currentTime=O+.05)}}else{var L=void 0,P=a.maxFragLookUpTolerance,M=y?A[y.sn-A[0].sn+1]:void 0,N=function(e){var t=Math.min(P,e.duration);return e.start+e.duration-t<=v?1:e.start-t>v&&e.start?-1:0};v<C?(v>C-P&&(P=0),L=M&&!N(M)?M:d.default.search(A,N)):L=A[w-1],L&&(R=L,D=L.start,y&&R.level===y.level&&R.sn===y.sn&&(R.sn<i.endSN?(R=A[R.sn+1-i.startSN],g.logger.log("SN just loaded, load next one: "+R.sn)):R=null))}R&&(R.encrypted?(g.logger.log("Loading key for "+R.sn+" of ["+i.startSN+" ,"+i.endSN+"],track "+b),this.state=T.State.KEY_LOADING,r.trigger(h.default.KEY_LOADING,{frag:R})):(g.logger.log("Loading "+R.sn+", cc: "+R.cc+" of ["+i.startSN+" ,"+i.endSN+"],track "+b+", currentTime:"+e+",bufferEnd:"+v.toFixed(3)),this.fragCurrent=R,(I||this.fragmentTracker.getState(R)===E.FragmentState.NOT_LOADED)&&(this.startFragRequested=!0,(0,n.default)(R.sn)&&(this.nextLoadPosition=R.start+R.duration),r.trigger(h.default.FRAG_LOADING,{frag:R}),this.state=T.State.FRAG_LOADING)))}break;case T.State.WAITING_TRACK:(t=this.tracks[this.trackId])&&t.details&&(this.state=T.State.IDLE);break;case T.State.FRAG_LOADING_WAITING_RETRY:var x=k.now(),U=this.retryDate,H=(s=this.media)&&s.seeking;(!U||x>=U||H)&&(g.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=T.State.IDLE);break;case T.State.WAITING_INIT_PTS:var F=this.videoTrackCC;if(void 0===this.initPTS[F])break;var B=this.waitingFragment;if(B){var V=B.frag.cc;F!==V?(t=this.tracks[this.trackId]).details&&t.details.live&&(g.logger.warn("Waiting fragment CC ("+V+") does not match video track CC ("+F+")"),this.waitingFragment=null,this.state=T.State.IDLE):(this.state=T.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=T.State.IDLE;break;case T.State.STOPPED:case T.State.FRAG_LOADING:case T.State.PARSING:case T.State.PARSED:case T.State.ENDED:}}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var i=this.config;this.tracks&&i.autoStartLoad&&this.startLoad(i.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(g.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onAudioTracksUpdated",value:function(e){g.logger.log("audio tracks updated"),this.tracks=e.audioTracks}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=T.State.PAUSED,this.waitingFragment=null,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=T.State.IDLE),this.tick()}},{key:"onAudioTrackLoaded",value:function(e){var t=e.details,i=e.id,r=this.tracks[i],a=t.totalduration,o=0;if(g.logger.log("track "+i+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live){var s=r.details;s&&t.fragments.length>0?(p.mergeDetails(s,t),o=t.fragments[0].start,t.PTSKnown?g.logger.log("live audio playlist sliding:"+o.toFixed(3)):g.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,g.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,!this.startFragRequested){if(-1===this.startPosition){var l=t.startTimeOffset;(0,n.default)(l)?(g.logger.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===T.State.WAITING_TRACK&&(this.state=T.State.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===T.State.KEY_LOADING&&(this.state=T.State.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,i=e.frag;if(this.state===T.State.FRAG_LOADING&&t&&"audio"===i.type&&i.level===t.level&&i.sn===t.sn){var n=this.tracks[this.trackId],r=n.details,a=r.totalduration,o=t.level,s=t.sn,l=t.cc,u=this.config.defaultAudioCodec||n.audioCodec||"mp4a.40.2",d=this.stats=e.stats;if("initSegment"===s)this.state=T.State.IDLE,d.tparsed=d.tbuffered=k.now(),r.initSegment.data=e.payload,this.hls.trigger(h.default.FRAG_BUFFERED,{stats:d,frag:t,id:"audio"}),this.tick();else{this.state=T.State.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new c.default(this.hls,"audio"));var f=this.initPTS[l],p=r.initSegment?r.initSegment.data:[];r.initSegment||void 0!==f?(this.pendingBuffering=!0,g.logger.log("Demuxing "+s+" of ["+r.startSN+" ,"+r.endSN+"],track "+o),this.demuxer.push(e.payload,p,u,null,t,a,!1,f)):(g.logger.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+s+" of ["+r.startSN+" ,"+r.endSN+"],track "+o),this.waitingFragment=e,this.state=T.State.WAITING_INIT_PTS)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent,i=e.frag;if(t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===T.State.PARSING){var n=e.tracks,r=void 0;if(n.video&&delete n.video,r=n.audio){r.levelCodec=r.codec,r.id=e.id,this.hls.trigger(h.default.BUFFER_CODECS,n),g.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var a=r.initSegment;if(a){var o={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[o]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h.default.BUFFER_APPENDING,o))}this.tick()}}}},{key:"onFragParsingData",value:function(e){var t=this,i=this.fragCurrent,r=e.frag;if(i&&"audio"===e.id&&"audio"===e.type&&r.sn===i.sn&&r.level===i.level&&this.state===T.State.PARSING){var a=this.trackId,o=this.tracks[a],s=this.hls;(0,n.default)(e.endPTS)||(e.endPTS=e.startPTS+i.duration,e.endDTS=e.startDTS+i.duration),i.addElementaryStream(_.default.ElementaryStreamTypes.AUDIO),g.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),p.updateFragPTSDTS(o.details,i,e.startPTS,e.endPTS);var l=this.audioSwitch,u=this.media,d=!1;if(l&&u)if(u.readyState){var f=u.currentTime;g.logger.log("switching audio track : currentTime:"+f),f>=e.startPTS&&(g.logger.log("switching audio track : flushing all audio"),this.state=T.State.BUFFER_FLUSHING,s.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),d=!0,this.audioSwitch=!1,s.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:a}))}else this.audioSwitch=!1,s.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:a});var c=this.pendingData;if(!c)return g.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void s.trigger(h.default.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&c.push({type:e.type,data:t,parent:"audio",content:"data"})}),!d&&c.length&&(c.forEach(function(e){t.state===T.State.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(h.default.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent,i=e.frag;t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===T.State.PARSING&&(this.stats.tparsed=k.now(),this.state=T.State.PARSED,this._checkAppendedParsed())}},{key:"onBufferReset",value:function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}},{key:"onBufferCreated",value:function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)}},{key:"onBufferAppended",value:function(e){if("audio"===e.parent){var t=this.state;t!==T.State.PARSING&&t!==T.State.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==T.State.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,i=this.hls;if(e){this.fragPrevious=e,t.tbuffered=k.now(),i.trigger(h.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var n=this.mediaBuffer?this.mediaBuffer:this.media;g.logger.log("audio buffered : "+v.default.toString(n.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,i.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=T.State.IDLE}this.tick()}}},{key:"onError",value:function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:var i=e.frag;if(i&&"audio"!==i.type)break;if(!e.fatal){var n=this.fragLoadError;n?n++:n=1;var r=this.config;if(n<=r.fragLoadingMaxRetry){this.fragLoadError=n;var a=Math.min(Math.pow(2,n-1)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);g.logger.warn("AudioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=k.now()+a,this.state=T.State.FRAG_LOADING_WAITING_RETRY}else g.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=T.State.ERROR}break;case y.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case y.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==T.State.ERROR&&(this.state=e.fatal?T.State.ERROR:T.State.IDLE,g.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case y.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var o=this.mediaBuffer,s=this.media.currentTime;if(o&&f.BufferHelper.isBuffered(o,s)&&f.BufferHelper.isBuffered(o,s+.5)){var l=this.config;l.maxMaxBufferLength>=l.maxBufferLength&&(l.maxMaxBufferLength/=2,g.logger.warn("AudioStreamController: reduce max buffer length to "+l.maxMaxBufferLength+"s")),this.state=T.State.IDLE}else g.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=T.State.BUFFER_FLUSHING,this.hls.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}}},{key:"onBufferFlushed",value:function(){var e=this,t=this.pendingData;t&&t.length?(g.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach(function(t){e.hls.trigger(h.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=T.State.PARSED):(this.state=T.State.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,g.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}(S.default);t.default=b},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newCue=function(e,t,i,r){for(var a=void 0,o=void 0,s=void 0,l=void 0,u=void 0,d=window.VTTCue||window.TextTrackCue,f=0;f<r.rows.length;f++)if(s=!0,l=0,u="",!(a=r.rows[f]).isEmpty()){for(var c=0;c<a.chars.length;c++)a.chars[c].uchar.match(/\s/)&&s?l++:(u+=a.chars[c].uchar,s=!1);a.cueStartTime=t,t===i&&(i+=1e-4),o=new d(t,i,(0,n.fixLineBreaks)(u.trim())),l>=16?l--:l++,navigator.userAgent.match(/Firefox\//)?o.line=f+1:o.line=f>7?f-2:f+1,o.align="left",o.position=Math.max(0,Math.min(100,l/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(o)}};var n=i(207)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e="auto",t={"":!0,lr:!0,rl:!0},i={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(e){return"string"==typeof e&&!!i[e.toLowerCase()]&&e.toLowerCase()}function r(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}function a(i,a,o){var s=this,l=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),u={};l?s=document.createElement("custom"):u.enumerable=!0,s.hasBeenReset=!1;var d="",f=!1,c=i,h=a,p=o,v=null,y="",g=!0,m="auto",E="start",_=50,T="middle",S=50,I="middle";if(Object.defineProperty(s,"id",r({},u,{get:function(){return d},set:function(e){d=""+e}})),Object.defineProperty(s,"pauseOnExit",r({},u,{get:function(){return f},set:function(e){f=!!e}})),Object.defineProperty(s,"startTime",r({},u,{get:function(){return c},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");c=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",r({},u,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",r({},u,{get:function(){return p},set:function(e){p=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",r({},u,{get:function(){return v},set:function(e){v=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",r({},u,{get:function(){return y},set:function(e){var i=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");y=i,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",r({},u,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",r({},u,{get:function(){return m},set:function(t){if("number"!=typeof t&&t!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",r({},u,{get:function(){return E},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",r({},u,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",r({},u,{get:function(){return T},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",r({},u,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",r({},u,{get:function(){return I},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");I=t,this.hasBeenReset=!0}})),s.displayState=void 0,l)return s}return a.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},a}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=g(i(22)),r=g(i(43)),a=g(i(2)),o=g(i(0)),s=g(i(1)),l=g(i(3)),u=g(i(4)),d=g(i(11)),f=g(i(29)),c=g(i(260)),h=g(i(261)),p=g(i(262)),v=i(9),y=i(206);function g(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(e){(0,o.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,d.default.MEDIA_ATTACHING,d.default.MEDIA_DETACHING,d.default.FRAG_PARSING_USERDATA,d.default.FRAG_DECRYPTED,d.default.MANIFEST_LOADING,d.default.MANIFEST_LOADED,d.default.FRAG_LOADED,d.default.LEVEL_SWITCHING,d.default.INIT_PTS_FOUND));if(i.hls=e,i.config=e.config,i.enabled=!0,i.Cues=e.config.cueHandler,i.textTracks=[],i.tracks=[],i.unparsedVttFrags=[],i.initPTS=[],i.cueRanges=[],i.captionsTracks={},i.captionsProperties={textTrack1:{label:i.config.captionsTextTrack1Label,languageCode:i.config.captionsTextTrack1LanguageCode},textTrack2:{label:i.config.captionsTextTrack2Label,languageCode:i.config.captionsTextTrack2LanguageCode}},i.config.enableCEA708Captions){var n=new h.default(i,"textTrack1"),r=new h.default(i,"textTrack2");i.cea608Parser=new c.default(0,n,r)}return i}return(0,u.default)(t,e),(0,s.default)(t,[{key:"addCues",value:function(e,t,i,n){for(var r,a,o,s,l=this.cueRanges,u=!1,d=l.length;d--;){var f=l[d],c=(r=f[0],a=f[1],o=t,s=i,Math.min(a,s)-Math.max(r,o));if(c>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],i),u=!0,c/(i-t)>.5))return}u||l.push([t,i]),this.Cues.newCue(this.captionsTracks[e],t,i,n)}},{key:"onInitPtsFound",value:function(e){var t=this;if("main"===e.id&&(this.initPTS[e.frag.cc]=e.initPTS),this.unparsedVttFrags.length){var i=this.unparsedVttFrags;this.unparsedVttFrags=[],i.forEach(function(e){t.onFragLoaded(e)})}}},{key:"getExistingTrack",value:function(e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var n=t.textTracks[i];if(n[e])return n}return null}},{key:"createCaptionsTrack",value:function(e){var t=this.captionsProperties[e],i=t.label,n=t.languageCode,r=this.captionsTracks;if(!r[e]){var a=this.getExistingTrack(e);if(a)r[e]=a,(0,y.clearCurrentCues)(r[e]),(0,y.sendAddTrackEvent)(r[e],this.media);else{var o=this.createTextTrack("captions",i,n);o&&(o[e]=!0,r[e]=o)}}}},{key:"createTextTrack",value:function(e,t,i){var n=this.media;if(n)return n.addTextTrack(e,t,i)}},{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){this.media=e.media,this._cleanTracks()}},{key:"onMediaDetaching",value:function(){var e=this.captionsTracks;(0,r.default)(e).forEach(function(t){(0,y.clearCurrentCues)(e[t]),delete e[t]})}},{key:"onManifestLoading",value:function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()}},{key:"_cleanTracks",value:function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var i=0;i<t.length;i++)(0,y.clearCurrentCues)(t[i])}}},{key:"onManifestLoaded",value:function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,n){var r=void 0;if(n<i.length){var a=[].slice.call(i).find(function(t){return function(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}(t,e)});a&&(r=a)}r||(r=t.createTextTrack("subtitles",e.name,e.lang)),e.default?r.mode=t.hls.subtitleDisplay?"showing":"hidden":r.mode="disabled",t.textTracks.push(r)})}}},{key:"onLevelSwitching",value:function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions}},{key:"onFragLoaded",value:function(e){var t=e.frag,i=e.payload;if("main"===t.type){var r=t.sn;if(r!==this.lastSn+1){var a=this.cea608Parser;a&&a.reset()}this.lastSn=r}else if("subtitle"===t.type)if(i.byteLength){if(!(0,n.default)(this.initPTS[t.cc]))return this.unparsedVttFrags.push(e),void(this.initPTS.length&&this.hls.trigger(d.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));var o=t.decryptdata;null!=o&&null!=o.key&&"AES-128"===o.method||this._parseVTTs(t,i)}else this.hls.trigger(d.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})}},{key:"_parseVTTs",value:function(e,t){var i=this.vttCCs;i[e.cc]||(i[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var n=this.textTracks,r=this.hls;p.default.parse(t,this.initPTS[e.cc],i,e.cc,function(t){var i=n[e.trackId];"disabled"!==i.mode?(t.forEach(function(e){if(!i.cues.getCueById(e.id))try{i.addCue(e)}catch(n){var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,i.addCue(t)}}),r.trigger(d.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})):r.trigger(d.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},function(t){v.logger.log("Failed to parse VTT cue: "+t),r.trigger(d.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})}},{key:"onFragDecrypted",value:function(e){var t=e.payload,i=e.frag;if("subtitle"===i.type){if(!(0,n.default)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(i,t)}}},{key:"onFragParsingUserdata",value:function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var i=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,i)}}},{key:"extractCea608Data",value:function(e){for(var t=31&e[0],i=2,n=void 0,r=void 0,a=void 0,o=[],s=0;s<t;s++)n=e[i++],r=127&e[i++],a=127&e[i++],0===r&&0===a||0!=(4&n)&&0==(3&n)&&(o.push(r),o.push(a));return o}}]),t}(f.default);t.default=m},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(68)),r=o(i(0)),a=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var s={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},l=function(e){var t=e;return s.hasOwnProperty(e)&&(t=s[e]),String.fromCharCode(t)},u=15,d=100,f={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},c={17:2,18:4,21:6,22:8,23:10,19:13,20:15},h={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},p={25:2,26:4,29:6,30:8,31:10,27:13,28:15},v=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],y={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){this.verboseFilter[e],this.verboseLevel}},g=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].toString(16));return t},m=function(){function e(t,i,n,a,o){(0,r.default)(this,e),this.foreground=t||"white",this.underline=i||!1,this.italics=n||!1,this.background=a||"black",this.flash=o||!1}return(0,a.default)(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],i=0;i<t.length;i++){var n=t[i];e.hasOwnProperty(n)&&(this[n]=e[n])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),E=function(){function e(t,i,n,a,o,s){(0,r.default)(this,e),this.uchar=t||" ",this.penState=new m(i,n,a,o,s)}return(0,a.default)(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),_=function(){function e(){(0,r.default)(this,e),this.chars=[];for(var t=0;t<d;t++)this.chars.push(new E);this.pos=0,this.currPenState=new m}return(0,a.default)(e,[{key:"equals",value:function(e){for(var t=!0,i=0;i<d;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<d;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<d;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(y.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>d&&(y.log("ERROR","Too large cursor position "+this.pos),this.pos=d)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){e>=144&&this.backSpace();var t=l(e);this.pos>=d?y.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}},{key:"clearFromPos",value:function(e){var t=void 0;for(t=e;t<d;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,i=0;i<d;i++){var n=this.chars[i].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}]),e}(),T=function(){function e(){(0,r.default)(this,e),this.rows=[];for(var t=0;t<u;t++)this.rows.push(new _);this.currRow=u-1,this.nrRollUpRows=null,this.reset()}return(0,a.default)(e,[{key:"reset",value:function(){for(var e=0;e<u;e++)this.rows[e].clear();this.currRow=u-1}},{key:"equals",value:function(e){for(var t=!0,i=0;i<u;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<u;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<u;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){this.rows[this.currRow].backSpace()}},{key:"clearToEndOfRow",value:function(){this.rows[this.currRow].clearToEndOfRow()}},{key:"insertChar",value:function(e){this.rows[this.currRow].insertChar(e)}},{key:"setPen",value:function(e){this.rows[this.currRow].setPenStyles(e)}},{key:"moveCursor",value:function(e){this.rows[this.currRow].moveCursor(e)}},{key:"setCursor",value:function(e){y.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)}},{key:"setPAC",value:function(e){y.log("INFO","pacData = "+(0,n.default)(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var i=0;i<u;i++)this.rows[i].clear();var r=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var o=a.rows[r].cueStartTime;if(o&&o<y.time)for(var s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(a.rows[r+s])}}this.currRow=t;var l=this.rows[this.currRow];if(null!==e.indent){var d=e.indent,f=Math.max(d-1,0);l.setCursor(e.indent),e.color=l.chars[f].penState.foreground}var c={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(c)}},{key:"setBkgData",value:function(e){y.log("INFO","bkgData = "+(0,n.default)(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){if(null!==this.nrRollUpRows){y.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),y.log("INFO","Rolling up")}else y.log("DEBUG","roll_up but nrRollUpRows not set yet")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],i="",n=-1,r=0;r<u;r++){var a=this.rows[r].getTextString();a&&(n=r+1,e?t.push("Row "+n+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i}},{key:"getTextAndFormat",value:function(){return this.rows}}]),e}(),S=function(){function e(t,i){(0,r.default)(this,e),this.chNr=t,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new T,this.nonDisplayedMemory=new T,this.lastOutputScreen=new T,this.currRollUpRow=this.displayedMemory.rows[u-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return(0,a.default)(e,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[u-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,y.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";y.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(y.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){y.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){y.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){y.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){y.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){y.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){y.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){y.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){y.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){y.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}},{key:"ccCR",value:function(){y.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}},{key:"ccENM",value:function(){y.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(y.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,y.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}},{key:"ccTO",value:function(e){y.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}y.log("INFO","MIDROW: "+(0,n.default)(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=y.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),e}(),I=function(){function e(t,i,n){(0,r.default)(this,e),this.field=t||1,this.outputs=[i,n],this.channels=[new S(1,i),new S(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return(0,a.default)(e,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var i=void 0,n=void 0,r=void 0,a=!1;this.lastTime=e,y.setTime(e);for(var o=0;o<t.length;o+=2)n=127&t[o],r=127&t[o+1],0!==n||0!==r?(y.log("DATA","["+g([t[o],t[o+1]])+"] -> ("+g([n,r])+")"),(i=this.parseCmd(n,r))||(i=this.parseMidrow(n,r)),i||(i=this.parsePAC(n,r)),i||(i=this.parseBackgroundAttributes(n,r)),i||(a=this.parseChars(n,r))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(a):y.log("WARNING","No channel found yet. TEXT-MODE?")),i?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,y.log("WARNING","Couldn't parse cleaned data "+g([n,r])+" orig: "+g([t[o],t[o+1]])))):this.dataCounters.padding+=2}},{key:"parseCmd",value:function(e,t){var i;if(!((20===e||28===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,y.log("DEBUG","Repeated command ("+g([e,t])+") is dropped"),!0;i=20===e||23===e?1:2;var n=this.channels[i-1];return 20===e||28===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0}},{key:"parseMidrow",value:function(e,t){var i=null;return(17===e||25===e)&&t>=32&&t<=47&&((i=17===e?1:2)!==this.currChNr?(y.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].ccMIDROW(t),y.log("DEBUG","MIDROW ("+g([e,t])+")"),!0))}},{key:"parsePAC",value:function(e,t){var i,n;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;i=e<=23?1:2,n=t>=64&&t<=95?1===i?f[e]:h[e]:1===i?c[e]:p[e];var r=this.interpretPAC(n,t);return this.channels[i-1].setPAC(r),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0}},{key:"interpretPAC",value:function(e,t){var i,n={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,n.underline=1==(1&i),i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((i-16)/2),n}},{key:"parseChars",value:function(e,t){var i=null,n=null,r=null;if(e>=25?(i=2,r=e-8):(i=1,r=e),r>=17&&r<=19){var a;a=17===r?t+80:18===r?t+112:t+144,y.log("INFO","Special char '"+l(a)+"' in channel "+i),n=[a]}else e>=32&&e<=127&&(n=0===t?[e]:[e,t]);if(n){var o=g(n);y.log("DEBUG","Char codes =  "+o.join(",")),this.lastCmdA=null,this.lastCmdB=null}return n}},{key:"parseBackgroundAttributes",value:function(e,t){var i,n=void 0,r=void 0;return((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47)&&(n={},16===e||24===e?(r=Math.floor((t-32)/2),n.background=v[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),i=e<24?1:2,this.channels[i-1].setBkgData(n),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}}]),e}();t.default=I},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(0)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(t,i){(0,n.default)(this,e),this.timelineController=t,this.trackName=i,this.startTime=null,this.endTime=null,this.screen=null}return(0,r.default)(e,[{key:"dispatchCue",value:function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)}},{key:"newCue",value:function(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(22)),r=o(i(207)),a=i(104);function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e,t,i){return e.substr(i||0,t.length)===t},l=function(e){for(var t=5381,i=e.length;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()},u={parse:function(e,t,i,o,u,d){var f=(0,a.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),c="00:00.000",h=0,p=0,v=0,y=[],g=void 0,m=!0,E=new r.default;E.oncue=function(e){var t=i[o],n=i.ccOffset;t&&t.new&&(void 0!==p?n=i.ccOffset=t.start:function(e,t,i){var n=e[o],r=e[n.prevCC];if(!r||!r.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;r&&r.new;)e.ccOffset+=n.start-r.start,n.new=!1,r=e[(n=r).prevCC];e.presentationOffset=i}(i,0,v)),v&&(n=v-i.presentationOffset),e.startTime+=n-p,e.endTime+=n-p,e.id=l(e.startTime.toString())+l(e.endTime.toString())+l(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&y.push(e)},E.onparsingerror=function(e){g=e},E.onflush=function(){g&&d?d(g):u(y)},f.forEach(function(e){if(m){if(s(e,"X-TIMESTAMP-MAP=")){m=!1,e.substr(16).split(",").forEach(function(e){s(e,"LOCAL:")?c=e.substr(6):s(e,"MPEGTS:")&&(h=parseInt(e.substr(7)))});try{h-=t=t<0?t+8589934592:t,i=c,r=parseInt(i.substr(-3)),a=parseInt(i.substr(-6,2)),o=parseInt(i.substr(-9,2)),l=i.length>9?parseInt(i.substr(0,i.indexOf(":"))):0,p=((0,n.default)(r)&&(0,n.default)(a)&&(0,n.default)(o)&&(0,n.default)(l)?(r+=1e3*a,r+=6e4*o,r+=36e5*l):-1)/1e3,v=h/9e4,-1===p&&(g=new Error("Malformed X-TIMESTAMP-MAP: "+e))}catch(t){g=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(m=!1)}var i,r,a,o,l;E.parse(e+"\n")}),E.flush()}};t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(i(2)),r=f(i(0)),a=f(i(1)),o=f(i(3)),s=f(i(4)),l=f(i(11)),u=f(i(29)),d=i(9);function f(e){return e&&e.__esModule?e:{default:e}}function c(e){for(var t=[],i=0;i<e.length;i++)"subtitles"===e[i].kind&&t.push(e[i]);return t}var h=function(e){function t(e){(0,r.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.MANIFEST_LOADING,l.default.MANIFEST_LOADED,l.default.SUBTITLE_TRACK_LOADED));return i.tracks=[],i.trackId=-1,i.media=null,i.subtitleDisplay=!0,i}return(0,s.default)(t,e),(0,a.default)(t,[{key:"_onTextTracksChanged",value:function(){if(this.media){for(var e=-1,t=c(this.media.textTracks),i=0;i<t.length;i++)if("hidden"===t[i].mode)e=i;else if("showing"===t[i].mode){e=i;break}this.subtitleTrack=e}}},{key:"destroy",value:function(){u.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(e){var t=this;this.media=e.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))}},{key:"onMediaDetaching",value:function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(e){var t=this,i=e.subtitles||[];this.tracks=i,this.trackId=-1,this.hls.trigger(l.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:i}),i.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})}},{key:"onTick",value:function(){var e=this.trackId,t=this.tracks[e];if(t){var i=t.details;i&&!i.live||(d.logger.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(l.default.SUBTITLE_TRACK_LOADING,{url:t.url,id:e}))}}},{key:"onSubtitleTrackLoaded",value:function(e){var t=this;e.id<this.tracks.length&&(d.logger.log("subtitle track "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(function(){t.onTick()},1e3*e.details.targetduration,this)),!e.details.live&&this.timer&&this._stopTimer())}},{key:"setSubtitleTrackInternal",value:function(e){var t=this.hls,i=this.tracks;if(!("number"!=typeof e||e<-1||e>=i.length)&&(this._stopTimer(),this.trackId=e,d.logger.log("switching to subtitle track "+e),t.trigger(l.default.SUBTITLE_TRACK_SWITCH,{id:e}),-1!==e)){var n=i[e],r=n.details;r&&!r.live||(d.logger.log("(re)loading playlist for subtitle track "+e),t.trigger(l.default.SUBTITLE_TRACK_LOADING,{url:n.url,id:e}))}}},{key:"_stopTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"_toggleTrackModes",value:function(e){var t=this.media,i=this.subtitleDisplay,n=this.trackId;if(t){var r=c(t.textTracks);if(-1===e)[].slice.call(r).forEach(function(e){e.mode="disabled"});else{var a=r[n];a&&(a.mode="disabled")}var o=r[e];o&&(o.mode=i?"showing":"hidden")}}},{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this.setSubtitleTrackInternal(e))}}]),t}(u.default);t.default=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubtitleStreamController=t.SubtitleStreamControllerState=void 0;var n=y(i(2)),r=y(i(0)),a=y(i(1)),o=y(i(3)),s=y(i(72)),l=y(i(4)),u=y(i(11)),d=i(9),f=y(i(188)),c=y(i(191)),h=i(73),p=i(204),v=i(100);function y(e){return e&&e.__esModule?e:{default:e}}var g=window.performance,m=t.SubtitleStreamControllerState={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"};t.SubtitleStreamController=function(e){function t(e,i){(0,r.default)(this,t);var a=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.ERROR,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.SUBTITLE_TRACKS_UPDATED,u.default.SUBTITLE_TRACK_SWITCH,u.default.SUBTITLE_TRACK_LOADED,u.default.SUBTITLE_FRAG_PROCESSED));return a.fragmentTracker=i,a.config=e.config,a.state=m.STOPPED,a.tracks=[],a.tracksBuffered=[],a.currentTrackId=-1,a.decrypter=new f.default(e,e.config),a}return(0,l.default)(t,e),(0,a.default)(t,[{key:"onHandlerDestroyed",value:function(){this.fragmentTracker=null,this.state=m.STOPPED,(0,s.default)(t.prototype.__proto__||(0,n.default)(t.prototype),"onHandlerDestroyed",this).call(this)}},{key:"onSubtitleFragProcessed",value:function(e){if(this.state=m.IDLE,e.success){var t=this.tracksBuffered[this.currentTrackId],i=e.frag;if(this.fragPrevious=i,t){for(var n=void 0,r=0;r<t.length;r++)if(i.start>=t[r].start&&i.start<=t[r].end){n=t[r];break}n?n.end=i.start+i.duration:t.push({start:i.start,end:i.start+i.duration})}}}},{key:"onMediaAttached",value:function(e){this.media=e.media,this.state=m.IDLE}},{key:"onMediaDetaching",value:function(){this.media=null,this.state=m.STOPPED}},{key:"onError",value:function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.state=m.IDLE)}},{key:"onSubtitleTracksUpdated",value:function(e){var t=this;d.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach(function(e){t.tracksBuffered[e.id]=[]})}},{key:"onSubtitleTrackSwitch",value:function(e){if(this.currentTrackId=e.id,this.tracks&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(500)}else this.clearInterval()}},{key:"onSubtitleTrackLoaded",value:function(e){var t=e.id,i=e.details;this.tracks?(this.tracks[t]&&(d.logger.log("Updating subtitle track details"),this.tracks[t].details=i),this.setInterval(500)):d.logger.warn("Can not update subtitle details, no tracks found")}},{key:"onKeyLoaded",value:function(){this.state===m.KEY_LOADING&&(this.state=m.IDLE)}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,i=e.frag.decryptdata,n=e.frag,r=this.hls;if(this.state===m.FRAG_LOADING&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&i&&i.key&&"AES-128"===i.method){var a=g.now();this.decrypter.decrypt(e.payload,i.key.buffer,i.iv.buffer,function(e){var t=g.now();r.trigger(u.default.FRAG_DECRYPTED,{frag:n,payload:e,stats:{tstart:a,tdecrypt:t}})})}}},{key:"doTick",value:function(){if(this.media)switch(this.state){case m.IDLE:var e=this.tracks,t=this.currentTrackId;if(!e||!e[t]||!e[t].details)break;var i=e[t].details,n=this.config,r=n.maxBufferHole,a=Math.min(n.maxBufferLength,n.maxMaxBufferLength),o=n.maxFragLookUpTolerance,s=h.BufferHelper.bufferedInfo(this._getBuffered(),this.media.currentTime,r),l=s.end,f=s.len,c=i.fragments,y=c.length,g=c[y-1].start+c[y-1].duration,E=void 0;f<a&&l<g?E=(0,p.findFragmentByPTS)(this.fragPrevious,c,l,o):i.hasProgramDateTime&&this.fragPrevious&&(E=(0,p.findFragmentByPDT)(c,this.fragPrevious.endProgramDateTime,o)),E&&E.encrypted?(d.logger.log("Loading key for "+E.sn),this.state=m.KEY_LOADING,this.hls.trigger(u.default.KEY_LOADING,{frag:E})):E&&this.fragmentTracker.getState(E)===v.FragmentState.NOT_LOADED&&(E.trackId=t,this.fragCurrent=E,this.state=m.FRAG_LOADING,this.hls.trigger(u.default.FRAG_LOADING,{frag:E}))}else this.state=m.IDLE}},{key:"_getBuffered",value:function(){return this.tracksBuffered[this.currentTrackId].buffered||[]}}]),t}(c.default)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(i(2)),r=c(i(0)),a=c(i(1)),o=c(i(3)),s=c(i(4)),l=c(i(29)),u=c(i(11)),d=i(21),f=i(9);function c(e){return e&&e.__esModule?e:{default:e}}var h=window.XMLHttpRequest,p="com.widevine.alpha",v=function(e){function t(e){(0,r.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e,u.default.MEDIA_ATTACHED,u.default.MANIFEST_PARSED));return i._widevineLicenseUrl=e.config.widevineLicenseUrl,i._licenseXhrSetup=e.config.licenseXhrSetup,i._emeEnabled=e.config.emeEnabled,i._requestMediaKeySystemAccess=e.config.requestMediaKeySystemAccessFunc,i._mediaKeysList=[],i._media=null,i._hasSetMediaKeys=!1,i._isMediaEncrypted=!1,i._requestLicenseFailureCount=0,i}return(0,s.default)(t,e),(0,a.default)(t,[{key:"getLicenseServerUrl",value:function(e){var t=void 0;switch(e){case p:t=this._widevineLicenseUrl;break;default:t=null}return t||(f.logger.error('No license server URL configured for key-system "'+e+'"'),this.hls.trigger(u.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),t}},{key:"_attemptKeySystemAccess",value:function(e,t,i){var n=this,r=function(e,t,i){switch(e){case p:return function(e,t,i){var n={videoCapabilities:[]};return t.forEach(function(e){n.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})}),[n]}(0,i);default:throw Error("Unknown key-system: "+e)}}(e,0,i);r?(f.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,r).then(function(t){n._onMediaKeySystemAccessObtained(e,t)}).catch(function(t){f.logger.error('Failed to obtain key-system "'+e+'" access:',t)})):f.logger.warn("Can not create config for key-system (maybe because platform is not supported):",e)}},{key:"_onMediaKeySystemAccessObtained",value:function(e,t){var i=this;f.logger.log('Access for key-system "'+e+'" obtained');var n={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(n),t.createMediaKeys().then(function(t){n.mediaKeys=t,f.logger.log('Media-keys created for key-system "'+e+'"'),i._onMediaKeysCreated()}).catch(function(e){f.logger.error("Failed to create media-keys:",e)})}},{key:"_onMediaKeysCreated",value:function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})}},{key:"_onNewMediaKeySession",value:function(e){var t=this;f.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(i){t._onKeySessionMessage(e,i.message)},!1)}},{key:"_onKeySessionMessage",value:function(e,t){f.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(t){f.logger.log("Received license data, updating key-session"),e.update(t)})}},{key:"_onMediaEncrypted",value:function(e,t){f.logger.log('Media is encrypted using "'+e+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=e,this._mediaEncryptionInitData=t,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()}},{key:"_attemptSetMediaKeys",value:function(){if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return f.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});f.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}}},{key:"_generateRequestWithPreferredKeySession",value:function(){var e=this,t=this._mediaKeysList[0];if(!t)return f.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(t.mediaKeysSessionInitialized)f.logger.warn("Key-Session already initialized but requested again");else{var i=t.mediaKeysSession;i||(f.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(u.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}));var n=this._mediaEncryptionInitDataType,r=this._mediaEncryptionInitData;f.logger.log('Generating key-session request for "'+n+'" init data type'),t.mediaKeysSessionInitialized=!0,i.generateRequest(n,r).then(function(){f.logger.debug("Key-session generation succeeded")}).catch(function(t){f.logger.error("Error generating key-session request:",t),e.hls.trigger(u.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}}},{key:"_createLicenseXhr",value:function(e,t,i){var n=new h,r=this._licenseXhrSetup;try{if(r)try{r(n,e)}catch(t){n.open("POST",e,!0),r(n,e)}n.readyState||n.open("POST",e,!0)}catch(e){return f.logger.error("Error setting up key-system license XHR",e),void this.hls.trigger(u.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return n.responseType="arraybuffer",n.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,n,e,t,i),n}},{key:"_onLicenseRequestReadyStageChange",value:function(e,t,i,n){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,f.logger.log("License request succeeded"),n(e.response);else{if(f.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount<=3){var r=3-this._requestLicenseFailureCount+1;return f.logger.warn("Retrying license request, "+r+" attempts left"),void this._requestLicense(i,n)}this.hls.trigger(u.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}}},{key:"_generateLicenseRequestChallenge",value:function(e,t){var i=void 0;return"com.microsoft.playready"===e.mediaKeySystemDomain?f.logger.error("PlayReady is not supported (yet)"):e.mediaKeySystemDomain===p?i=t:f.logger.error("Unsupported key-system:",e.mediaKeySystemDomain),i}},{key:"_requestLicense",value:function(e,t){f.logger.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(!i)return f.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var n=this.getLicenseServerUrl(i.mediaKeySystemDomain),r=this._createLicenseXhr(n,e,t);f.logger.log("Sending license request to URL: "+n),r.send(this._generateLicenseRequestChallenge(i,e))}},{key:"onMediaAttached",value:function(e){var t=this;if(this._emeEnabled){var i=e.media;this._media=i,i.addEventListener("encrypted",function(e){t._onMediaEncrypted(e.initDataType,e.initData)})}}},{key:"onManifestParsed",value:function(e){if(this._emeEnabled){var t=e.levels.map(function(e){return e.audioCodec}),i=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(p,t,i)}}},{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),t}(l.default);t.default=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;t.requestMediaKeySystemAccess=n},function(e,t,i){}]);